
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Rekall Memory Forensic Framework</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Rekall Memory Forensic Framework">

    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px;
      }
    </style>
    <link href="/css/rekall.css" rel="stylesheet">
    <link href="/css/asciidoc.css" rel="stylesheet">
    <link href="/css/treeview.css" rel="stylesheet">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></sc\
ript>
    <![endif]-->
  </head>

  <body>



   <nav class="navbar navbar-inverse navbar-fixed-top"
     role="navigation">
     <div class="container-fluid">
       <div class="navbar-header">
         <a class="navbar-brand" href="#">Rekall Memory Forensic Framework</a>
       </div>

       <div class="navbar-collapse collapse">
         <ul class="nav navbar-nav">

        <li>
          <a class="" href="/index.html">
            Home
          </a>
        </li>

        <li>
          <a class="" href="/about.html">
            About
          </a>
        </li>

        <li>
          <a class="" href="/blog.html">
            Blog
          </a>
        </li>

        <li>
          <a class="" href="/docs.html">
            Documentation
          </a>
        </li>

        <li>
          <a class="" href="/downloads.html">
            Downloads
          </a>
        </li>

        <li>
          <a class="" href="/faq.html">
            FAQ
          </a>
        </li>

         </ul>
         <form class="navbar-form navbar-right" role="search" action="/search.html">
           <div class="form-group">
             <input type="text" name="q" class="form-control" placeholder="Site Search">
           </div>
           <button type="submit" class="btn btn-default">
             <span class="glyphicon glyphicon-search"></span>
           </button>
         </form>
       </div> <!-- navbar-collapse -->
     </div> <!-- container-fluid -->
   </nav>

<div class="container-fluid">
<div class="row">
  <div class="col-md-2">
    
  </div>

  <div class="col-md-8">
    
<div id="header">
</div>
<div id="content">
<div class="paragraph"><p>Author: Johannes Stuettgen (<a href="mailto:johannes.stuettgen@gmail.com">johannes.stuettgen@gmail.com</a>)</p></div>
<div class="sect1">
<h2 id="_summary">Summary:</h2>
<div class="sectionbody">
<div class="paragraph"><p>LMAP is a binary linux memory acquisition tool that works on any kernel and
distribution without having to build anything on the target system.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_how_it_works">How it works:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Memory acquisition on Linux requires loading a kernel module. For stability
reasons, this has to be compiled on the system where it will be loaded. LMAP
avoids this requirement by bringing along a minimal memory acquisition kernel
module that doesn&#8217;t use the kernel and thus is compatible with most kernel
versions.</p></div>
<div class="paragraph"><p>To ensure compatibility and stability on the target system LMAP borrows a
compatible kernel module from the current system (it searches /lib/modules) as
a host. LMAP then injects it&#8217;s code and data into a copy of the host in memory
and loads the result into the kernel.</p></div>
<div class="paragraph"><p>The integrated kernel module is kernel-independent and works on any Linux
x86-64 system from kernel 2.6 to 3.X [2]. The usermode <em>lmap</em> binary is
statically linked to avoid libc version dependencies. You can find further
technical details in our paper published at DFRWS EU [1].</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">Usage:</h2>
<div class="sectionbody">
<div class="paragraph"><p>Copy the <em>lmap</em> binary to a Linux system where memory should be acquired.</p></div>
<div class="paragraph"><p>LMAP can dump memory directly and create an ELF coredump file using the <em>-a</em>
option. It can also load the pmem module with the <em>-l</em> option, then acquire
memory by reading from the created <em>/dev/pmem</em> device file (e.g. with <em>dd</em>).</p></div>
<div class="paragraph"><p>There are multiple other options, a complete list can be found here or by
running <em>lmap</em> without any options:</p></div>
<div class="paragraph"><p>modes of operation:
  -a dumpfile  Main use case. Find a suitable host module, use it to load pmem
               and then dump memory into an ELF core dump file.
  -l           Find a host, use it to load the acquisition module. The pmem
               module can be used by seeking and reading the file <em>/dev/pmem</em>.
  -d           Find a host and inject pmem, then dump the generated module
               to the filesystem as <em>infected_module.ko</em>.
  -f           Scan for and list suitable hosts, don&#8217;t inject or load anything.</p></div>
<div class="paragraph"><p>optional arguments:
  -o outfile   The output file for <em>-d</em> (default: infected_module.ko).
  -i inputfile Don&#8217;t inject the bundled pmem module, use this one instead.
  -h module    Don&#8217;t search for a suitable host module, use this one instead.
  -p path      Path to kernel modules to scan for hosts.
  -m           Print the systems physical memory map.
  -v           Verbose, produces detailed debug logging.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_limitations">Limitations:</h2>
<div class="sectionbody">
<div class="paragraph"><p>LMAP relies on finding a valid kernel module on the target system that serves
as a host for it&#8217;s pmem module. Not every module satisfies the requirements,
so it might be possible that no suitable host module exists on the target. In
that case you will have to compile a module (e.g. pmem) on the target itself,
or on a build system with identical kernel version and config.</p></div>
<div class="paragraph"><p>Also, some modules might be suitable hosts, but require other modules to
function. For example the <em>pg.ko</em> and <em>pt.ko</em> modules import symbols from
<em>paride.ko</em>. If LMAP fails to load it&#8217;s module and your <em>dmesg</em> output shows
missing symbols, try another host by first scanning with <em>-f</em> and then selecting
it with the <em>-h</em> option.</p></div>
<div class="paragraph"><p>Ftrace is a kernel feature that patches all kernel and module functions with
calls to certain tracing functions to enable debugging and performance
monitoring. This is partially done at compile- and run-time. LMAP should always
be built without ftrace, as it introduces symbol dependencies to ftrace and the
generated module won&#8217;t be loadable into kernels compiled without ftrace. If the
target system runs ftrace, LMAP is still able to load it&#8217;s module. However,
ftrace will complain about not being able to hook into the module. This results
in a warning in the targets kernel debug buffer:
  <em>WARNING: CPU: &#8230; at &#8230; ftrace_bug &#8230;</em>
This is normal and does not compromise lmap, the module or the acquisition
process in any way. Note that ftrace shuts down after that, so you will need to
reboot the machine if you intend to use ftrace for debugging after running LMAP.</p></div>
<div class="paragraph"><p>If you&#8217;re using the <em>build.sh</em> script to build LMAP the CMake scripts will
create a copy of your kernel headers and config in <em>build/kernel_headers</em>.
Any FTRACE options enabled in your original kernel config will be disabled there
and the pmem module will be compiled with this config to guarantee an FTRACE
free build.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_compatibility">Compatibility:</h2>
<div class="sectionbody">
<div class="paragraph"><p>The entire tool suite is only compatible with x86-64 processors and binaries.
32 Bit x86 and ARM support is still in development.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_building_from_source">Building from Source:</h2>
<div class="sectionbody">
<div class="paragraph"><p>See the README in the projects root (<em>tools/linux/lmap</em>).</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References:</h2>
<div class="sectionbody">
<div class="paragraph"><p>[1] Stüttgen, Johannes, and Michael Cohen.
  "Robust Linux Memory Acquisition with Minimal Target Impact"
  Digital Investigation 11 (2014): P112-P119.</p></div>
<div class="paragraph"><p>[2] Stüttgen, Johannes, and Michael Cohen.
  "Anti-forensic resilient memory acquisition"
  Digital Investigation 10 (2013): P105-P115.</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-11-20 17:53:08 CET
</div>
</div>
<script src="/js/asciidoc.js"></script>
  </div>
  <div class="col-md-2 sidebar">
    <img src="/img/Rekall.png" class="logo"></img>


  </div>
</div>
</div>
  <script>
   $(".activate_tooltip").tooltip();
  </script>
  </body>
</html>

