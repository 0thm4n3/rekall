<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>Anti-forensics and memory analysis.</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Anti-forensics and memory analysis.</h1>
<span id="author">Michael Cohen &lt;scudette@gmail.com&gt;</span><br />
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Recently there have been a number of talks around the place about anti-forensic
techniques. The most recent example is the Shmoocon talk by Jake Williams and
Alissa Torres:
<a href="http://www.mediafire.com/view/h7bmcscbtyaeb6r/ADD_Shmoocon.pdf">ADD&#8201;&#8212;&#8201;Complicating Memory Forensics Through Memory Disarray</a> with the tool published
here, <a href="https://code.google.com/p/attention-deficit-disorder/">Attention Deficit
Disorder (ADD)</a>, which is a proof-of-concept "evidence planting" tool.</p></div>
<div class="paragraph"><p>Before that there was a black hat talk
<a href="https://media.blackhat.com/bh-eu-12/Haruyama/bh-eu-12-Haruyama-Memory_Forensic-Slides.pdf">One-byte
Modification for Breaking Memory Forensic Analysis</a>, and even we have published
a paper on anti-forensics titled
<a href="http://www.dfrws.org/2013/proceedings/DFRWS2013-13.pdf">Anti-Forensic Resilient
Memory Acquisition</a></p></div>
<div class="paragraph"><p>In response to the ADD work, Brent Muir wrote the blog post
<a href="http://blog.handlerdiaries.com/?p=363">Forensic Analysis of Anti-Forensic
Activities</a> where he analyzes the artifacts that ADD leaves behind, and the
Volatility Blog published a rather confident piece Titled
<a href="http://volatility-labs.blogspot.ch/2014/02/add-next-big-threat-to-memory.html">ADD:
The Next Big Threat To Memory Forensics&#8230;.Or Not</a> claiming that anti-forensics
is dead, and the author reassures us that "There is a significant amount of work
that needs to be done for this to change, so while the attackers are spending
their weeks and months trying to build things up to spec, rest assured that with
proper training and the right tools, you won&#8217;t need to worry about future
versions.". So all we need is training and tools apparently.</p></div>
<div class="paragraph"><p>In my opinion, the reality is slightly less bright than the Volatility blog post
would like us to believe. Anti-forensics can be very effective and being
overconfident is really setting an investigator up for a fall. I think the topic
of anti-forensics is one that needs wider discussion in the forensic community
and to be taken seriously.</p></div>
<div class="paragraph"><p>There are two goals that anti-forensic techniques can implement:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Prevent the analyst from analyzing the image in the first place.
</p>
</li>
<li>
<p>
Plant evidence to decoy or confuse the investigation (or even to present
   doubt to the whole thing in a court proceeding).
</p>
</li>
</ol></div>
<div class="paragraph"><p>We really do need to consider both goals, as currently these are both very
effective. It does not pay to just "shoot the messenger" without considering the
message itself. <tt>ADD</tt> is not a perfect tool - it is merely a proof of concept, but
it can easily be changed to defeat Volatility or any other memory analysis tool.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_goal_1_disable_memory_analysis_tools">Goal 1: Disable memory analysis tools.</h2>
<div class="sectionbody">
<div class="paragraph"><p>To achieve this goal the anti-forensic tool simply needs to prevent the initial
acquisition, or the subsequent analysis. We have already published how a tool
can interfere with memory acquisition by manipulating the data structure that
back the
<a href="http://msdn.microsoft.com/en-us/library/windows/hardware/ff554435(v=vs.85).aspx">MmGetPhysicalMemoryRanges()</a>
function. Virtually all memory acquisition tools use this function to work out
where they should be reading. But since this function is undocumented and is not
normally used, it is quite safe to patch it without affecting system stability.</p></div>
<div class="paragraph"><p>Memory acquisition tools also typically use a couple of well known APIs such as
<tt>MmMapIoSpace()</tt> and <tt>ZwMapViewOfSection()</tt> which have previously been patched
as far back as 2006 in
<a href="http://www.security-assessment.com/files/presentations/darrenbilby_ruxcon06_v0_5.pdf">Darren
Bilby&#8217;s <tt>ddfy</tt> work</a>.</p></div>
<div class="paragraph"><p>So anti-forensics is definitely not dead in the memory acquisition world.</p></div>
<div class="paragraph"><p>How about the analysis world? It is easy to disable a memory analysis framework,
such as <tt>Volatility</tt> or <tt>Rekall</tt> since the tool makes many assumptions which may
not be true. For example, we have run a hands on memory forensic workshop during
the 2013 Open Source Digital Forensic Conference (OSDFC) workshop, titled
<a href="https://drive.google.com/?tab=mo&amp;authuser=0#folders/0B9hc84IflFGbc2FPWHV6TVoyd1k">Memory
Forensics With Volatility</a>. In that workshop, we have used the <tt>WinPmem</tt> driver
(now part of the <a href="https://code.google.com/p/rekall/">Rekall framework</a>) to
actively manipulate physical memory to examine how good the analysis tool
was. (You can still view the workshop on
<a href="http://www.youtube.com/watch?v=9aC7yIYwvAY">You-tube</a>).</p></div>
<div class="paragraph"><p>At first we corrupted the <tt>"KDBG"</tt> owner tag from the <tt>KdDebuggerDataBlock</tt>
structure. The first thing that Volatility does is to recover the <tt>KDBG</tt>
structure from memory (Rekall no longer uses the KDBG but that is the topic for
another post). Without a valid <tt>KDBG</tt> it is very hard to use Volatility since it
uses it to locate the <tt>PsActiveProcessHead</tt> data structure so it can list
processes etc. In fact the Volatility blog post
<a href="http://volatility-labs.blogspot.ch/2014/01/the-secret-to-64-bit-windows-8-and-2012.html">The
Secret to 64-bit Windows 8 and 2012 Raw Memory Dump Forensics</a> stresses the
importance of finding the correct KDBG structure. The important thing, however,
is that the KDBG structure is not really used in Windows under normal
circumstances (its used by the kernel debugger and to produce a crash dump). So
removing it does not affect system stability.</p></div>
<div class="paragraph"><p>It is quite trivial to remove the KDBG signature, in which case Volatility is
unable to proceed without a lot of hand holding. It is also possible to add
false positive (since <tt>kdbgscan</tt> is just a simple scan for a known signature),
which can force Volatility to present whatever results one wishes when
traversing lists such as the process list or the module list (i.e. one can
create entire <tt>fake</tt> lists which are not even used by the kernel at all).</p></div>
<div class="paragraph"><p>In fact quoting from the Volatility blog post "In other words, tools that use
object carving (i.e. pattern matching, scanning) as an analysis technique are
implicitly susceptible to attacks that create objects that look like the ones
being carved.". One wonders what that statement means to the analysis process,
since the entire Volatility analysis process begins with a fuzzy signature
matching carve for the <tt>KDBG</tt> structure.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_goal_2_plant_or_change_evidence">Goal 2: Plant or change evidence.</h2>
<div class="sectionbody">
<div class="paragraph"><p>This goal for an anti-forensic tool is to confuse the analysis process. It is
actually much easier than it sounds since the analysis process is usually
focused around the output of the tool. So all one needs to do is find data that
the tool presents (but is not essential for system stability) and change it to
say whatever they want. Without prior knowledge most investigators will simply
trust the output of their tool.</p></div>
<div class="paragraph"><p>For example, in our <tt>OSDFC</tt> workshop, we illustrated how one can simply
overwrite the filename strings presented in the <tt>vad</tt> plugin output to whatever
you want (One can similarly change protection flags). Since the filename itself
is not used to read from the file once the handle is created, it does not matter
what is written there. This can be used to influence the output of the <tt>vadinfo</tt>
plugin (either to hide or plant evidence). Similarly one can alter process
names, pid-ppid relations, driver names etc, and even remove entire VAD nodes.</p></div>
<div class="paragraph"><p>In fact, during that workshop we used the actual Volatility tool to tell us
where the offset of the strings were in physical memory. This way we knew
exactly which bytes to change in the physical memory, so that the tool output
said what we wanted. The only caveat was that whatever we changed was not
critical for stable system operation. Since memory forensic tools are designed
to find the evidence and tell you where it is, they can all be easily misused to
tell you which bytes in memory you should alter to reflect in the tool output.</p></div>
<div class="paragraph"><p>Many Volatility plugins rely on pool scans which use fixed signatures. A good
anti-forensic technique is to simply overwrite the pool tags (which are just
known strings used for debugging) - this renders all the volatility pool
scanning plugins worthless. Most other scanning plugins also use artifacts which
can easily be changed to avoid signatures matching.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusions">Conclusions</h2>
<div class="sectionbody">
<div class="paragraph"><p>As much as I would love to live in a world where anti-forensics is not
effective, the real world is less perfect. As investigators we need to
acknowledge the fact that we are not perfect and can easily be fooled by
anti-forensic techniques. It is an arms race after all. A little bit of training
can improve your ability to detect these techniques, but you can never be sure.</p></div>
<div class="paragraph"><p>Just a quick word on Brent Muir&#8217;s blog post. It is important to realize that
Brent went about his analysis with 20/20 vision knowing exactly what he was
looking for. If you re-read he analysis without the knowledge that ADD was at
play you would see:</p></div>
<div class="ulist"><ul>
<li>
<p>
A process in <tt>psscan</tt> which does not appear in any of the other lists. (This is
  perfectly plausible for existed processes).
</p>
</li>
<li>
<p>
Some command line output extracted with strings that mention the suspicious
  process (OK Maybe the authors of ADD did not have great opsec, they could have
  scripted the tool better.).
</p>
</li>
<li>
<p>
<tt>Netscan</tt> output which does not agree with the output of the apparently
  unpublished <tt>tcpscan</tt> plugin. This is still consistent with the theory that
  the process has existed or closed all of its connections, but we don&#8217;t really
  know since the <tt>tcpscan</tt> module is not published so we don&#8217;t know how it works.
</p>
</li>
<li>
<p>
The file paths start with "\private\" instead of
  "\Device\HarddiskVolume0\". Maybe an oversight on behalf of the ADD authors -
  I am sure the string can say whatever you want.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Finally Brent finds the string "ADD" in various forms in the strings output
(e.g. <tt>add.exe</tt> and the bat script which runs the add binary with all the
parameters). Had he not known in advance the tool was called <tt>add.exe</tt> I don&#8217;t
think this would have been that suspicious. (We still resort to memory analysis
using strings in 2014?)</p></div>
<div class="paragraph"><p>It is not constructive to pick the faults in a specific implementation of an
anti-forensic POC, ignoring the overall lesson - which is that anti-forensics is
actually very effective, especially when you don&#8217;t know it is there. If one
re-reads Brent Muir&#8217;s blog post without the knowledge that there is
anti-forensics employed, one can see that most investigators will probably fall
for the story that the tool is trying to sell: "There was an existed process
which had these sensitive files open and also had network connections.".</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-02-07 16:11:21 CET
</div>
</div>
</body>
</html>
