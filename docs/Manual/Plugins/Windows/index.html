
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Rekall Memory Forensic Framework</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Rekall Memory Forensic Framework">

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/rekall.css" rel="stylesheet">
    <link href="/css/asciidoc.css" rel="stylesheet">
    <link href="/css/font-awesome.css" rel="stylesheet">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></sc\
ript>
    <![endif]-->
  </head>

  <body>


  <div class="background">
   <header class="header">
    <div class="navbar navbar-fixed-top navbar-inverse">
     <div class="navbar-inner">
      <div class="container">
       <a class="navbar-brand" href="/"
          style="padding-top: 0px; padding-bottom: 0px;"
          >
          <img src="/img/Rekall-small.png" class="small_logo"></img>
       </a>
       <ul class="nav navbar-nav navbar-collapse collapse">

        <li class="divider-vertical"></li>
        
    <li class="">
     <a href="/index.html">
      Home
     </a>
    </li>
    
        <li class="divider-vertical"></li>
        
    <li class="">
     <a href="/about.html">
      About
     </a>
    </li>
    
        <li class="divider-vertical"></li>
        
    <li class=" dropdown">
     <a class="dropdown-toggle"
      id="dropdownMenuReleases"
      data-toggle="dropdown"
      aria-expanded="true">
    Releases
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuReleases">

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Releases/releases-1.2.1.html">Version 1.2.1 Col de la Croix.</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Releases/releases-1.3.1.html">Version 1.3.2 Dammastock.</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Releases/releases-1.4.0.html">Version 1.4.0 Etzel.</a></li>

  </ul>
 </li>

        <li class="divider-vertical"></li>
        
    <li class=" dropdown">
     <a class="dropdown-toggle"
      id="dropdownMenuDocumentation"
      data-toggle="dropdown"
      aria-expanded="true">
    Documentation
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuDocumentation">

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/Manual">Rekall User Manual</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/Developers">Developer Documentation.</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/GUI">Rekall GUI</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/MemoryAnalysis.html">Memory Analysis Course</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/References">References</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/Tools">The Pmem Memory acquisition suite.</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/docs/index.html"></a></li>

  </ul>
 </li>

        <li class="divider-vertical"></li>
        
    <li class=" dropdown">
     <a class="dropdown-toggle"
      id="dropdownMenuDiscuss"
      data-toggle="dropdown"
      aria-expanded="true">
    Discuss
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuDiscuss">

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Discuss/blog.html">The Rekall Blog</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Discuss/github.html">GitHub</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Discuss/index.html"></a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Discuss/issue.html">Issue Tracker</a></li>

    <li role="presentation"><a role="menuitem" tabindex="-1" href="/Discuss/mailinglist.html">Mailing List</a></li>

  </ul>
 </li>

        <li class="divider-vertical"></li>
        
    <li class="">
     <a href="/faq.html">
      FAQ
     </a>
    </li>
    
       <li>
        <a href="https://github.com/google/rekall/edit/gh-pages/docs/Manual/Plugins/Windows/index.md?message=Describe%20your%20change..."
           data-toggle="tooltip"
           data-placement="bottom"
           title="Improve this page"
           class="improve-docs activate_tooltip">
         <i class="glyphicon glyphicon-edit"></i>
        </a>
       </ul>

       <form class="navbar-search col-md-3 docs-search" role="search"
             action="/search.html">
       <span class="glyphicon glyphicon-search search-icon"></span>
       <input type="text" name="q" data-i-search-input="true"
         class="search-query"
         placeholder="Site Search">
       </form>
      </div>
     </div>
    </div>
   </header>

<div class="container-fluid page-background container">
<div class="main">
  <div class="col-md-2">
    
<ul class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix rekall-side-nav">
 <a href="/docs/Manual/Plugins/index.html" class="btn btn-default btn-lg btn-block">
  <span class="glyphicon glyphicon-arrow-left"></span> Plugins
 </a>

 <a href='/docs/Manual/Plugins/Windows/index.html' class="btn btn-default btn-lg btn-block">
   Windows
 </a>
 <p>

<ul class='nav nav-pills nav-stacked'>
        <li>
          <a href='/docs/Manual/Plugins/Windows/Win32_GUI' class="category-directory-link">
            Win32_GUI
          </a>
        </li>
        
        <li>
          <a href='/docs/Manual/Plugins/Windows/Registry' class="category-directory-link">
            Registry
          </a>
        </li>
        <li>
          <a href='#analyze_struct' class="category-link">
            analyze_struct
          </a>
        </li>
        <li>
          <a href='#callbacks' class="category-link">
            callbacks
          </a>
        </li>
        <li>
          <a href='#cert_vad_scan' class="category-link">
            cert_vad_scan
          </a>
        </li>
        <li>
          <a href='#certscan' class="category-link">
            certscan
          </a>
        </li>
        <li>
          <a href='#check_pehooks' class="category-link">
            check_pehooks
          </a>
        </li>
        <li>
          <a href='#cmdscan' class="category-link">
            cmdscan
          </a>
        </li>
        <li>
          <a href='#connections' class="category-link">
            connections
          </a>
        </li>
        <li>
          <a href='#connscan' class="category-link">
            connscan
          </a>
        </li>
        <li>
          <a href='#consoles' class="category-link">
            consoles
          </a>
        </li>
        <li>
          <a href='#devicetree' class="category-link">
            devicetree
          </a>
        </li>
        <li>
          <a href='#dis' class="category-link">
            dis
          </a>
        </li>
        <li>
          <a href='#dlldump' class="category-link">
            dlldump
          </a>
        </li>
        <li>
          <a href='#dlllist' class="category-link">
            dlllist
          </a>
        </li>
        <li>
          <a href='#driverirp' class="category-link">
            driverirp
          </a>
        </li>
        <li>
          <a href='#driverscan' class="category-link">
            driverscan
          </a>
        </li>
        <li>
          <a href='#dtbscan' class="category-link">
            dtbscan
          </a>
        </li>
        <li>
          <a href='#dtbscan2' class="category-link">
            dtbscan2
          </a>
        </li>
        <li>
          <a href='#dumpfiles' class="category-link">
            dumpfiles
          </a>
        </li>
        <li>
          <a href='#evtlogs' class="category-link">
            evtlogs
          </a>
        </li>
        <li>
          <a href='#filescan' class="category-link">
            filescan
          </a>
        </li>
        <li>
          <a href='#find_dtb' class="category-link">
            find_dtb
          </a>
        </li>
        <li>
          <a href='#fls' class="category-link">
            fls
          </a>
        </li>
        <li>
          <a href='#handles' class="category-link">
            handles
          </a>
        </li>
        <li>
          <a href='#hooks_eat' class="category-link">
            hooks_eat
          </a>
        </li>
        <li>
          <a href='#hooks_iat' class="category-link">
            hooks_iat
          </a>
        </li>
        <li>
          <a href='#hooks_inline' class="category-link">
            hooks_inline
          </a>
        </li>
        <li>
          <a href='#imageinfo' class="category-link">
            imageinfo
          </a>
        </li>
        <li>
          <a href='#impscan' class="category-link">
            impscan
          </a>
        </li>
        <li>
          <a href='#kdbgscan' class="category-link">
            kdbgscan
          </a>
        </li>
        <li>
          <a href='#kpcr' class="category-link">
            kpcr
          </a>
        </li>
        <li>
          <a href='#ldrmodules' class="category-link">
            ldrmodules
          </a>
        </li>
        <li>
          <a href='#malfind' class="category-link">
            malfind
          </a>
        </li>
        <li>
          <a href='#memdump' class="category-link">
            memdump
          </a>
        </li>
        <li>
          <a href='#memmap' class="category-link">
            memmap
          </a>
        </li>
        <li>
          <a href='#moddump' class="category-link">
            moddump
          </a>
        </li>
        <li>
          <a href='#modscan' class="category-link">
            modscan
          </a>
        </li>
        <li>
          <a href='#modules' class="category-link">
            modules
          </a>
        </li>
        <li>
          <a href='#mutantscan' class="category-link">
            mutantscan
          </a>
        </li>
        <li>
          <a href='#netscan' class="category-link">
            netscan
          </a>
        </li>
        <li>
          <a href='#netstat' class="category-link">
            netstat
          </a>
        </li>
        <li>
          <a href='#netstat' class="category-link">
            netstat
          </a>
        </li>
        <li>
          <a href='#object_tree' class="category-link">
            object_tree
          </a>
        </li>
        <li>
          <a href='#object_types' class="category-link">
            object_types
          </a>
        </li>
        <li>
          <a href='#pagefiles' class="category-link">
            pagefiles
          </a>
        </li>
        <li>
          <a href='#pas2vas' class="category-link">
            pas2vas
          </a>
        </li>
        <li>
          <a href='#pedump' class="category-link">
            pedump
          </a>
        </li>
        <li>
          <a href='#peinfo' class="category-link">
            peinfo
          </a>
        </li>
        <li>
          <a href='#pfn' class="category-link">
            pfn
          </a>
        </li>
        <li>
          <a href='#phys_map' class="category-link">
            phys_map
          </a>
        </li>
        <li>
          <a href='#pool_tracker' class="category-link">
            pool_tracker
          </a>
        </li>
        <li>
          <a href='#pools' class="category-link">
            pools
          </a>
        </li>
        <li>
          <a href='#procdump' class="category-link">
            procdump
          </a>
        </li>
        <li>
          <a href='#procinfo' class="category-link">
            procinfo
          </a>
        </li>
        <li>
          <a href='#pslist' class="category-link">
            pslist
          </a>
        </li>
        <li>
          <a href='#psscan' class="category-link">
            psscan
          </a>
        </li>
        <li>
          <a href='#pstree' class="category-link">
            pstree
          </a>
        </li>
        <li>
          <a href='#psxview' class="category-link">
            psxview
          </a>
        </li>
        <li>
          <a href='#ptov' class="category-link">
            ptov
          </a>
        </li>
        <li>
          <a href='#raw2dmp' class="category-link">
            raw2dmp
          </a>
        </li>
        <li>
          <a href='#services' class="category-link">
            services
          </a>
        </li>
        <li>
          <a href='#sockets' class="category-link">
            sockets
          </a>
        </li>
        <li>
          <a href='#ssdt' class="category-link">
            ssdt
          </a>
        </li>
        <li>
          <a href='#svcscan' class="category-link">
            svcscan
          </a>
        </li>
        <li>
          <a href='#symlinkscan' class="category-link">
            symlinkscan
          </a>
        </li>
        <li>
          <a href='#thrdscan' class="category-link">
            thrdscan
          </a>
        </li>
        <li>
          <a href='#threads' class="category-link">
            threads
          </a>
        </li>
        <li>
          <a href='#timers' class="category-link">
            timers
          </a>
        </li>
        <li>
          <a href='#tokens' class="category-link">
            tokens
          </a>
        </li>
        <li>
          <a href='#unloaded_modules' class="category-link">
            unloaded_modules
          </a>
        </li>
        <li>
          <a href='#vacbs' class="category-link">
            vacbs
          </a>
        </li>
        <li>
          <a href='#vad' class="category-link">
            vad
          </a>
        </li>
        <li>
          <a href='#vaddump' class="category-link">
            vaddump
          </a>
        </li>
        <li>
          <a href='#vadinfo' class="category-link">
            vadinfo
          </a>
        </li>
        <li>
          <a href='#vadmap' class="category-link">
            vadmap
          </a>
        </li>
        <li>
          <a href='#vadtree' class="category-link">
            vadtree
          </a>
        </li>
        <li>
          <a href='#vadwalk' class="category-link">
            vadwalk
          </a>
        </li>
        <li>
          <a href='#version_modules' class="category-link">
            version_modules
          </a>
        </li>
        <li>
          <a href='#virt_map' class="category-link">
            virt_map
          </a>
        </li>
        <li>
          <a href='#vtop' class="category-link">
            vtop
          </a>
        </li>
        <li>
          <a href='#win32k_autodetect' class="category-link">
            win32k_autodetect
          </a>
        </li>
        </ul></ul>
  </div>

  <div class="col-md-10">
    
<div class="plugin_doc">
<h1 id="Windows Plugins" class="anchor" >Windows Plugins</h1>

<p>Support for Windows memory analysis.</p>

<h1 id="analyze_struct" class="anchor">analyze_struct</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.interactive.structs.AnalyzeStruct-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>A plugin to analyze a memory location.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>offset</p></td><td><p>A virtual address to analyze.</p></td></tr><tr><td><p>search</p></td><td><p>How far back to search for pool tag. (type: IntParser)</p>
<ul>
<li>Default: 256</li>
</ul></td></tr><tr><td><p>size</p></td><td><p>How many elements to identify. (type: IntParser)</p>
<ul>
<li>Default: 256</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The Windows kernel allocates memory from &ldquo;pool space&rdquo;. To ease debugging memory
leaks, the kernel uses a unique &ldquo;Pool Tag&rdquo; to tag many allocations. Each kernel
subsystem or driver would use a specific tag to keep track of its allocation.</p>
<p>We can use this fact when we look at some undocumented, or unknown memory
region. This is what the <code>analyze_struct</code> plugin does:</p>
<ol>
<li>It first searched back from the address of interest to determine if this
   address is part of a pool allocation. The plugin will report the pool tag of
   this allocation as well as its size and starting offset.</li>
<li>For each slot in the struct, the plugin assumes it is a pointer to something,
   and checks if whatever it is pointing to is a pool allocation or a known
   address.</li>
</ol>
<p>We can use this to get an idea of what exists at this memory location and its
struct layout.</p>
<p>In the below example, we pick an _EPROCESS from the output of <code>pslist</code> and
search for pointers to it somewhere in kernel memory (There are many pointers!
We just picked one for this example.). We then use the <code>analyze_struct</code> plugin
to discover that the pointer resides in an allocation with the pool tag
&lsquo;ObHd&rsquo;. We can search the kernel disassembly to realize this is an Object
Handle. Note how we use grep to search for the little endian representation of
the _EPROCESS address.</p>
<div class="highlight"><pre>[1] win7.elf 23:14:38&gt; pslist
  _EPROCESS            Name          PID   PPID   Thds    Hnds    Sess  Wow64           Start                     Exit
-------------- -------------------- ----- ------ ------ -------- ------ ------ ------------------------ ------------------------
....
0xfa8002ad0190 cmd.exe               2644   2616      2       66      1 True   2012-10-01 14:40:20Z     -

[1] win7.elf 23:14:55&gt; grep keyword=&quot;\x90\x01\xad\x02\x80\xfa&quot;
....
    Offset                                   Data                                                Comment
-------------- ----------------------------------------------------------------- ----------------------------------------
0xf8a0013d8ad8 60 40 a9 02 80 fa ff ff 01 00 00 00 00 00 00 00  `@..............
0xf8a0013d8ae8 90 01 ad 02 80 fa ff ff 01 00 00 00 00 00 00 00  ................
0xf8a0013d8af8 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
...
[1] win7.elf 23:17:20&gt; analyze_struct 0xf8a0013d8ae8

0xf8a0013d8ae8 is inside pool allocation with tag &#39;ObHd&#39; (0xf8a0013d8a30)  and size 0x100
    Offset     Content
-------------- -------
           0x0 Data:0xfa8002ad0190 Tag:Pro\xe3 @0xfa8002ad0190 (0x530)
           0x8 Data:0x1
          0x10 Data:0x0
          0x18 Data:0x0
          0x20 Data:0x0
          0x28 Data:0x0
          0x30 Data:0xfa80017f9060 Tag:Pro\xe3 @0xfa80017f9060 (0x530)
          0x38 Data:0x1
          0x40 Data:0x730061006c
          0x48 Data:0x744e034d0110
          0x50 Data:0x490053004c
          0x58 Data:0xa4801280702
          0x60 Data:0x981e
          0x68 Data:0x100000000
          0x70 Data:0x0
[1] win7.elf 23:22:25&gt; hex(struct.unpack(&quot;&lt;I&quot;, &#39;ObHd&#39;)[0])
               Out&lt;24&gt; &#39;0x6448624f&#39;
[1] win7.elf 23:22:33&gt; dis &quot;nt!ObpInsertHandleCount&quot;
---------------------&gt; dis(&quot;nt!ObpInsertHandleCount&quot;)
Address      Rel             Op Codes                     Instruction                Comment
------- -------------- -------------------- ---------------------------------------- -------
------ nt!ObpInsertHandleCount ------: 0xf80002976010
  0xf80002976010            0x0 48895c2408           mov qword ptr [rsp + 8], rbx
  0xf80002976015            0x5 48896c2410           mov qword ptr [rsp + 0x10], rbp
....

  0xf80002976089           0x79 41b84f624864         mov r8d, 0x6448624f
  0xf8000297608f           0x7f e83cd3e4ff           call 0xf800027c33d0                      nt!ExAllocatePoolWithTag
  0xf80002976094           0x84 4885c0               test rax, rax
  0xf80002976097           0x87 0f84dacd0400         je 0xf800029c2e77                        nt!ExpProfileCreate+0x9d57
  0xf8000297609d           0x8d 458bc5               mov r8d, r13d
</pre></div>
</div>

<h1 id="callbacks" class="anchor">callbacks</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.callbacks.Callbacks-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate callback routines.</h2>
<p>This plugin just enumerates installed callback routines from various
sources. It does not scan for them.</p>
<p>This plugin is loosely based on the original Volatility plugin of the same
name but much expanded using new information.</p>
<p>Reference:
<a href="http://www.codemachine.com/notes.html">http://www.codemachine.com/notes.html</a></p>
</div>



<p>The Windows kernel has a facility to register callbacks for certain events. This
is often misused by malware in order to gain persistence. The <code>callbacks</code> plugin
enumerates these callbacks.</p>
<p>Since Rekall has an address resolver, we can often say more about what exists at
each of the callback locations. Normally Rekall only tracks the profile for
certain binaries (such as the kernel).</p>
<p>In the below example the callbacks plugins resolves the address of kernel
symbols precisely since it has the kernel profile loaded. Other symbols are give
approximately as their distance from the module&rsquo;s export table.</p>
<p>Suppose we want to verify what is the callback in the &ldquo;wdf01000&rdquo; driver. We can
instruct the address resolver to download the profile from the Microsoft symbol
server. Once the profile is downloaded, Rekall can determine the exact function
name registered (wdf01000!FxpBugCheckCallback).</p>
<div class="highlight"><pre>[1] win7.elf 00:59:59&gt; callbacks
---------------------&gt; callbacks()
                Type                     Offset        Callback                          Symbol                       Details
------------------------------------ -------------- -------------- -------------------------------------------------- -------
nt!PspLoadImageNotifyRoutine         0xf8000283e4a0 0xf800029acb68 nt!EtwpTraceLoadImage
nt!PspCreateProcessNotifyRoutine     0xf8000283e720 0xf8000265af28 nt!ViCreateProcessCallback
nt!PspCreateProcessNotifyRoutine     0xf8000283e728 0xf88001211330 ksecdd!AcceptSecurityContext+0x230
nt!PspCreateProcessNotifyRoutine     0xf8000283e730 0xf8800112b910 cng!SystemPrng+0x6a0
nt!PspCreateProcessNotifyRoutine     0xf8000283e738 0xf8800164c390 tcpip!CreateProcessNotifyRoutineEx
nt!PspCreateProcessNotifyRoutine     0xf8000283e740 0xf88000d01b94 ci!CiFreePolicyInfo+0xce84
nt!KeBugCheckCallbackListHead        0xfa80019c3ea0 0xf880014548f0 ndis!NdisGetSharedDataAlignment+0x10               Ndis min
nt!KeBugCheckCallbackListHead        0xfa80019a4ea0 0xf880014548f0 ndis!NdisGetSharedDataAlignment+0x10               Ndis min
nt!KeBugCheckCallbackListHead        0xfa80019a1ea0 0xf880014548f0 ndis!NdisGetSharedDataAlignment+0x10               Ndis min
nt!KeBugCheckCallbackListHead        0xf80002c25400 0xf80002c0eef4 hal!HalQueryMaximumProcessorCount+0x54c            ACPI x64
nt!KeBugCheckReasonCallbackListHead  0xfa80026549f8 0xf88000efd054 wdf01000+0x7a054                                   PEAUTH
nt!KeBugCheckReasonCallbackListHead  0xfa8000927f88 0xf88000efd054 wdf01000+0x7a054                                   monitor

[1] win7.elf 02:04:35&gt; address_resolver &quot;wdf01000&quot;
---------------------&gt; address_resolver(&quot;wdf01000&quot;) |
 Trying to fetch http://msdl.microsoft.com/download/symbols/wdf01000.pdb/99521C1B360441A9A1EAECC9E5087A251/wdf01000.pd_
 Trying to fetch http://msdl.microsoft.com/download/symbols/wdf01000.pdb/99521C1B360441A9A1EAECC9E5087A251/wdf01000.pd_
Extracting cabinet: /tmp/tmpnOmJvR/wdf01000.pd_
  extracting Wdf01000.pdb

All done, no errors.
                Out&lt;1&gt; Plugin: address_resolver

1] win7.elf 02:05:08&gt; callbacks
---------------------&gt; callbacks()
                Type                     Offset        Callback                          Symbol                       Details
------------------------------------ -------------- -------------- -------------------------------------------------- -------
nt!PspLoadImageNotifyRoutine         0xf8000283e4a0 0xf800029acb68 nt!EtwpTraceLoadImage
nt!PspCreateProcessNotifyRoutine     0xf8000283e720 0xf8000265af28 nt!ViCreateProcessCallback
nt!PspCreateProcessNotifyRoutine     0xf8000283e728 0xf88001211330 ksecdd!AcceptSecurityContext+0x230
nt!PspCreateProcessNotifyRoutine     0xf8000283e730 0xf8800112b910 cng!SystemPrng+0x6a0
nt!PspCreateProcessNotifyRoutine     0xf8000283e738 0xf8800164c390 tcpip!CreateProcessNotifyRoutineEx
nt!PspCreateProcessNotifyRoutine     0xf8000283e740 0xf88000d01b94 ci!CiFreePolicyInfo+0xce84
nt!KeBugCheckCallbackListHead        0xfa80019c3ea0 0xf880014548f0 ndis!NdisGetSharedDataAlignment+0x10               Ndis min
nt!KeBugCheckCallbackListHead        0xfa80019a4ea0 0xf880014548f0 ndis!NdisGetSharedDataAlignment+0x10               Ndis min
nt!KeBugCheckCallbackListHead        0xfa80019a1ea0 0xf880014548f0 ndis!NdisGetSharedDataAlignment+0x10               Ndis min
nt!KeBugCheckCallbackListHead        0xf80002c25400 0xf80002c0eef4 hal!HalQueryMaximumProcessorCount+0x54c            ACPI x64
nt!KeBugCheckReasonCallbackListHead  0xfa80026549f8 0xf88000efd054 wdf01000!FxpBugCheckCallback                       PEAUTH
nt!KeBugCheckReasonCallbackListHead  0xfa8000927f88 0xf88000efd054 wdf01000!FxpBugCheckCallback                       monitor
nt!KeBugCheckReasonCallbackListHead  0xfa80021f54b0 0xf88003edaf40 mouhid+0x3f40                                      mouhid
</pre></div>
</div>

<h1 id="cert_vad_scan" class="anchor">cert_vad_scan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.dumpcerts.CertVadScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan certificates in process Vads.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>This plugin is similar to the <a href="CertScan.html">certscan</a> plugin. It attempts to detect
DER encoded X509 certificates or RSA private keys in memory. This plugin scans
the process memory of selected processes only. The usualy process selection
arguments are supported in order to restrict the search to some processes only.</p>
<p>Optionally, if a dump directory is provided the DER encoded certificates are
also dumped to files in the specified directory.</p>
<h3>Sample Output</h3>
<p>In the example below we scan the address space of the winpmem acquistion tool to
find certificates used to sign the driver and binary.</p>
<div class="highlight"><pre>win8.1.raw 22:07:16&gt; cert_vad_scan proc_regex=&quot;winpmem&quot;
-------------------&gt; cert_vad_scan(proc_regex=&quot;winpmem&quot;)
Pid   Command       Address     Type  Length Description
----- ---------- -------------- ----- ------ -----------
2628  winpmem_1.5.2. 0x00000003c179 X509  1010  /C=US/O=Symantec Corporation/CN=Symantec Time Stamping Services CA - G2
2628  winpmem_1.5.2. 0x00000003c56b X509  1191  /C=US/O=Symantec Corporation/CN=Symantec Time Stamping Services Signer - G4
2628  winpmem_1.5.2. 0x00000003ca12 X509  1343  /C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance EV Root CA
2628  winpmem_1.5.2. 0x00000003cf51 X509  1690  /C=CH/ST=Switzerland/L=Horgen/O=Michael Cohen/CN=Michael Cohen
2628  winpmem_1.5.2. 0x00000003d285 X509  443   -
2628  winpmem_1.5.2. 0x00000003d5eb X509  1734  /C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance Code Signing CA-1
2628  winpmem_1.5.2. 0x00000003d87c X509  442   -
2628  winpmem_1.5.2. 0x000000bd2260 X509  704   /O=VeriSign Trust Network/OU=VeriSign, Inc./OU=VeriSign Time Stamping Service Root/OU=NO LIABILITY ACCEPTED, (c)97 VeriSign, Inc.
2628  winpmem_1.5.2. 0x000000bd2720 X509  462   /CN=Root Agency
2628  winpmem_1.5.2. 0x000000c153b0 X509  1491  /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/OU=MOPR/CN=Microsoft Update
</pre></div>
</div>

<h1 id="certscan" class="anchor">certscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.dumpcerts.CertScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump RSA private and public SSL keys from the physical address space.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr>
</tbody>
</table>
</div>


<p>This plugin is similar to the <a href="CertVadScan.html">cert_vad_scan</a> plugin. It
attempts to detect DER encoded X509 certificates or RSA private keys in physical
memory.</p>
<p>Optionally, if a dump directory is provided the DER encoded certificates are
also dumped to files in the specified directory.</p>
<h3>Sample Output</h3>
<div class="highlight"><pre>win8.1.raw 22:07:35&gt; certscan
-------------------&gt; certscan()
   Address     Type       Length     Description
-------------- ---------- ---------- -----------
0x000000030c95 X509       1287       /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=Microsoft Windows
0x00000003119c X509       1499       /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=Microsoft Windows Production PCA 2011
0x000000031b94 X509       1653       /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=Microsoft Time-Stamp PCA 2010
0x000000032209 X509       1246       /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/OU=MOPR/OU=nCipher DSE ESN:F528-3777-8A76/CN=Microsoft Time-Stamp Service
0x00000017114e X509       1499       /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=Microsoft Windows Production PCA 2011
0x000000171b46 X509       1653       /C=US/ST=Washington/L=Redmond/O=Microsoft Corporation/CN=Microsoft Time-Stamp PCA 2010
</pre></div>
</div>

<h1 id="check_pehooks" class="anchor">check_pehooks</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.apihooks.CheckPEHooks-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Checks a pe file mapped into memory for hooks.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>image-base</p></td><td><p>The base address of the pe image in memory.</p>
<ul>
<li>Default: 0</li>
</ul></td></tr><tr><td><p>type</p></td><td><p>Type of hook to display. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>all</li>
<li>iat</li>
<li>inline</li>
<li>eat</li>
</ul>
</li>
<li>
<p>Default: all</p>
</li>
</ul></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="cmdscan" class="anchor">cmdscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.cmdhistory.CmdScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Extract command history by scanning for _COMMAND_HISTORY</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>max_history</p></td><td><p>Value of history buffer size. See HKEY_CURRENT_USER\Console\HistoryBufferSize for default.</p>
<ul>
<li>Default: 50</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The cmdscan plugin searches the memory of csrss.exe on XP/2003/Vista/2008 and
conhost.exe on Windows 7 for commands that attackers entered through a console
shell (cmd.exe). This is one of the most powerful commands you can use to gain
visibility into an attackers actions on a victim system, whether they opened
cmd.exe through an RDP session or proxied input/output to a command shell from a
networked backdoor.</p>
<p>This plugin finds structures known as <strong>COMMAND_HISTORY</strong> by looking for a known
constant value (<strong>MaxHistory</strong>) and then applying sanity checks. It is important
to note that the <strong>MaxHistory</strong> value can be changed by right clicking in the
top left of a cmd.exe window and going to Properties. The value can also be
changed for all consoles opened by a given user by modifying the registry key
HKCU\Console\HistoryBufferSize. The default is 50 on Windows systems, meaning
the most recent 50 commands are saved. You can tweak it if needed by using the
&ndash;max_history=NUMBER parameter.</p>
<p>The structures used by this plugin are not public (i.e. Microsoft does not
produce PDBs for them), thus they&rsquo;re not available in WinDBG or any other
forensic framework. They were reverse engineered by Michael Ligh from the
conhost.exe and winsrv.dll binaries.</p>
<p>In addition to the commands entered into a shell, this plugin shows:</p>
<ul>
<li>
<p>The name of the console host process (csrss.exe or conhost.exe)</p>
</li>
<li>
<p>The name of the application using the console (whatever process is using cmd.exe)</p>
</li>
<li>
<p>The location of the command history buffers, including the current buffer count, last added command, and last displayed command</p>
</li>
<li>
<p>The application process handle</p>
</li>
</ul>
<p>Due to the scanning technique this plugin uses, it has the capability to find
commands from both active and closed consoles.</p>
<h3>Notes</h3>
<p>This plugin is pretty fragile since it relies on reversed structures in
undocumented code. We are working on improving the situation here but there is a
moderate chance that it will produce no results or garbage results.</p>
<h3>Sample Output</h3>
<p>The following showing an operator using the winpmem acquisition tool to analyse
the live memory of a Windows 7 machine.</p>
<div class="highlight"><pre>win7.elf 22:15:39&gt; cmdscan
-----------------&gt; cmdscan()
**************************************************
CommandProcess: conhost.exe Pid: 2652
CommandHistory: 0x7ea40 Application: cmd.exe Flags: Allocated, Reset
CommandCount: 3 LastAdded: 2 LastDisplayed: 2
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0x5c
Cmd    Address     Text
--- -------------- --------------------------------------------------
  0 0x00000005ea70 cd \Users\a\Desktop
  1 0x00000005b920 winpmem_1.1-write.exe -w -l
  2 0x0000000b3e70 vol.exe --profile Win7SP1x64 --file \\.\pmem
 15 0x000000040158
 16 0x00000007d3b0

**************************************************
CommandProcess: conhost.exe Pid: 2652
CommandHistory: 0xb40c0 Application: vol.exe Flags: Allocated
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0xd4
Cmd    Address     Text
--- -------------- --------------------------------------------------
  0 0x0000001f77e0
  3 0x000000060ef0
  5 0x0000001f77e0
  8 0x000000060ef0
 10 0x0000001f77e0
 13 0x0000ffd96238
 14 0x00000007ec20
 15 0x0000001f7720
 23 0x0000000610a0
 24 0x0000000974e0
**************************************************
CommandProcess: conhost.exe Pid: 2652
CommandHistory: 0xb4410 Application: vol.exe Flags: Allocated
CommandCount: 0 LastAdded: -1 LastDisplayed: -1
FirstCommand: 0 CommandCountMax: 50
ProcessHandle: 0xd8
Cmd    Address     Text
--- -------------- --------------------------------------------------
</pre></div>
</div>

<h1 id="connections" class="anchor">connections</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.connections.Connections-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print list of open connections [Windows XP Only]</h2>
<hr />
<p>This module enumerates the active connections from tcpip.sys.</p>
<p>Note that if you are using a hibernated image this might not work
because Windows closes all sockets before hibernating. You might
find it more effective to do conscan instead.</p>
<p>Active TCP connections are found in a hash table. The Hash table is given by
the _TCBTable symbol. The size of the hash table is found in the
_MaxHashTableSize variable.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>tcpip_guid</p></td><td><p>Force this profile to be used for tcpip.</p></td></tr>
</tbody>
</table>
</div>


<p>Prior to Windows 7, the windows TCP/IP stack uses objects of type _TCP_OBJECT to
track TCP endpoints. These are the objects parsed by this module, hence this
module will only be available on images from windows XP.</p>
<p>This module walks the _TCP_OBJECT hash tables and displays information related
to the TCP endpoints.</p>
<h3>Notes</h3>
<ol>
<li>
<p>This plugin depends on exported debugging symbols, and therefore requires the
   correct tcpip profile to be loaded from the profile repository. See the
   <a href="/faq.html#profile">FAQ</a> if you need to generate a profile.</p>
</li>
<li>
<p>For later versions of windows use the <a href="Netscan.html">netscan</a> or the
   <a href="Netstat.html">netstat</a> modules.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>xp-laptop-2005-06-25.img 23:00:24&gt; connections
---------------------------------&gt; connections()
Offset (V) Local Address             Remote Address               Pid
---------- ------------------------- ------------------------- ------
0x820869b0 127.0.0.1:1055            127.0.0.1:1056              2160
0xffa2baf0 127.0.0.1:1056            127.0.0.1:1055              2160
0x8220c008 192.168.2.7:1077          64.62.243.144:80            2392
0x81f11e70 192.168.2.7:1082          205.161.7.134:80            2392
0x8220d6b8 192.168.2.7:1066          199.239.137.200:80          2392
</pre></div>
</div>

<h1 id="connscan" class="anchor">connscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.connscan.ConnScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan Physical memory for _TCPT_OBJECT objects (tcp connections)</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>tcpip_guid</p></td><td><p>Force this profile to be used for tcpip.</p></td></tr>
</tbody>
</table>
</div>


<p>Similar to the <a href="Connections.html">connections</a> plugin, this plugin searches from
_TCP_OBJECT structs. However, it employs pool scanning techniques.</p>
<h3>Notes</h3>
<ol>
<li>
<p>This plugin only works on versions of winsows prior to Win7.</p>
</li>
<li>
<p>Since the plugin may recover freed pool memory, the data may have been
   overwritten. This might produce garbage results for terminated connections.</p>
</li>
</ol>
<h3>Sample output.</h3>
<p>Note the nonsensical connection for local address <em>3.0.48.2</em> and the incorrect
pid number below.</p>
<div class="highlight"><pre>xp-laptop-2005-06-25.img 23:00:29&gt; connscan
---------------------------------&gt; connscan()
Offset(P)  Local Address             Remote Address                   Pid
---------- ------------------------- ------------------------- ----------
0x01370e70 192.168.2.7:1115          207.126.123.29:80               1916
0x01ed1a50 3.0.48.2:17985            66.179.81.245:20084       4287933200
0x01f0e358 192.168.2.7:1164          66.179.81.247:80                 944
0x01f11e70 192.168.2.7:1082          205.161.7.134:80                2392
0x01f35cd0 192.168.2.7:1086          199.239.137.200:80              1916
0x01f88e70 192.168.2.7:1162          170.224.8.51:80                 1916
0x020869b0 127.0.0.1:1055            127.0.0.1:1056                  2160
</pre></div>
</div>

<h1 id="consoles" class="anchor">consoles</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.cmdhistory.Consoles-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate command consoles.</h2>
</div>



<p>Similar to <a href="CmdScan.html">cmdscan</a> the consoles plugin finds commands that
attackers typed into cmd.exe or executed via backdoors. However, instead of
scanning for <strong>COMMAND_HISTORY</strong>, this plugin scans for
<strong>CONSOLE_INFORMATION</strong>. The major advantage to this plugin is it not only
prints the commands attackers typed, but it collects the entire screen buffer
(input and output). For instance, instead of just seeing &ldquo;dir&rdquo;, you&rsquo;ll see
exactly what the attacker saw, including all files and directories listed by the
&ldquo;dir&rdquo; command.</p>
<p>Additionally, this plugin prints the following:</p>
<ul>
<li>The original console window title and current console window title</li>
<li>The name and pid of attached processes (walks a <strong>LIST_ENTRY</strong> to enumerate
  all of them if more than one)</li>
<li>Any aliases associated with the commands executed. For example, attackers can
  register an alias such that typing &ldquo;hello&rdquo; actually executes &ldquo;cd system&rdquo;</li>
<li>The screen coordinates of the cmd.exe console.</li>
</ul>
<h3>Notes</h3>
<p>This plugin is pretty fragile since it relies on reversed structures in
undocumented code. We are working on improving the situation here but there is a
moderate chance that it will produce no results or garbage results.</p>
<h3>Sample Output</h3>
<div class="highlight"><pre><span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mi">22</span><span class="o">:</span><span class="mi">23</span><span class="o">:</span><span class="mi">10</span><span class="o">&gt;</span> <span class="n">consoles</span>
<span class="o">**************************************************</span>
<span class="nl">ConsoleProcess</span><span class="p">:</span> <span class="n">conhost</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Pid</span><span class="p">:</span> <span class="mi">2652</span>
<span class="nl">Console</span><span class="p">:</span> <span class="mh">0xffd96200</span> <span class="nl">CommandHistorySize</span><span class="p">:</span> <span class="mi">50</span>
<span class="nl">HistoryBufferCount</span><span class="p">:</span> <span class="mi">4</span> <span class="nl">HistoryBufferMax</span><span class="p">:</span> <span class="mi">4</span>
<span class="nl">OriginalTitle</span><span class="p">:</span> <span class="n">Console2</span> <span class="n">command</span> <span class="n">window</span>
<span class="nl">Title</span><span class="p">:</span> <span class="nl">Administrator</span><span class="p">:</span> <span class="n">Console2</span> <span class="n">command</span> <span class="n">window</span> <span class="o">-</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span>  <span class="o">--</span><span class="n">profile</span> <span class="n">Win7SP1x64</span> <span class="o">--</span><span class="n">file</span> <span class="err">\\</span><span class="p">.</span><span class="err">\</span><span class="n">pmem</span>
<span class="nl">AttachedProcess</span><span class="p">:</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Pid</span><span class="p">:</span> <span class="mi">2920</span> <span class="nl">Handle</span><span class="p">:</span> <span class="mh">0xd8</span>
<span class="nl">AttachedProcess</span><span class="p">:</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Pid</span><span class="p">:</span> <span class="mi">2912</span> <span class="nl">Handle</span><span class="p">:</span> <span class="mh">0xd4</span>
<span class="nl">AttachedProcess</span><span class="p">:</span> <span class="n">cmd</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Pid</span><span class="p">:</span> <span class="mi">2644</span> <span class="nl">Handle</span><span class="p">:</span> <span class="mh">0x5c</span>
<span class="o">----</span>
<span class="nl">CommandHistory</span><span class="p">:</span> <span class="mh">0xb4410</span> <span class="nl">Application</span><span class="p">:</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Flags</span><span class="p">:</span> <span class="n">Allocated</span>
<span class="nl">CommandCount</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">LastAdded</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="nl">LastDisplayed</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="nl">FirstCommand</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">CommandCountMax</span><span class="p">:</span> <span class="mi">50</span>
<span class="nl">ProcessHandle</span><span class="p">:</span> <span class="mh">0xd8</span>
<span class="o">----</span>
<span class="nl">CommandHistory</span><span class="p">:</span> <span class="mh">0xb40c0</span> <span class="nl">Application</span><span class="p">:</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Flags</span><span class="p">:</span> <span class="n">Allocated</span>
<span class="nl">CommandCount</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">LastAdded</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="nl">LastDisplayed</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="nl">FirstCommand</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">CommandCountMax</span><span class="p">:</span> <span class="mi">50</span>
<span class="nl">ProcessHandle</span><span class="p">:</span> <span class="mh">0xd4</span>
<span class="o">----</span>
<span class="nl">CommandHistory</span><span class="p">:</span> <span class="mh">0xb3ee0</span> <span class="nl">Application</span><span class="p">:</span> <span class="n">winpmem_1</span><span class="mf">.1</span><span class="o">-</span><span class="n">write</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Flags</span><span class="p">:</span>
<span class="nl">CommandCount</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">LastAdded</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="nl">LastDisplayed</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span>
<span class="nl">FirstCommand</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">CommandCountMax</span><span class="p">:</span> <span class="mi">50</span>
<span class="nl">ProcessHandle</span><span class="p">:</span> <span class="mh">0x0</span>
<span class="o">----</span>
<span class="nl">CommandHistory</span><span class="p">:</span> <span class="mh">0x7ea40</span> <span class="nl">Application</span><span class="p">:</span> <span class="n">cmd</span><span class="p">.</span><span class="n">exe</span> <span class="nl">Flags</span><span class="p">:</span> <span class="n">Allocated</span><span class="p">,</span> <span class="n">Reset</span>
<span class="nl">CommandCount</span><span class="p">:</span> <span class="mi">3</span> <span class="nl">LastAdded</span><span class="p">:</span> <span class="mi">2</span> <span class="nl">LastDisplayed</span><span class="p">:</span> <span class="mi">2</span>
<span class="nl">FirstCommand</span><span class="p">:</span> <span class="mi">0</span> <span class="nl">CommandCountMax</span><span class="p">:</span> <span class="mi">50</span>
<span class="nl">ProcessHandle</span><span class="p">:</span> <span class="mh">0x5c</span>
<span class="n">Cmd</span> <span class="err">#</span><span class="mi">0</span> <span class="n">at</span> <span class="mh">0x5ea70</span><span class="o">:</span> <span class="n">cd</span> <span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">a</span><span class="err">\</span><span class="n">Desktop</span>
<span class="n">Cmd</span> <span class="err">#</span><span class="mi">1</span> <span class="n">at</span> <span class="mh">0x5b920</span><span class="o">:</span> <span class="n">winpmem_1</span><span class="mf">.1</span><span class="o">-</span><span class="n">write</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">l</span>
<span class="n">Cmd</span> <span class="err">#</span><span class="mi">2</span> <span class="n">at</span> <span class="mh">0xb3e70</span><span class="o">:</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="o">--</span><span class="n">profile</span> <span class="n">Win7SP1x64</span> <span class="o">--</span><span class="n">file</span> <span class="err">\\</span><span class="p">.</span><span class="err">\</span><span class="n">pmem</span>
<span class="o">----</span>
<span class="n">Screen</span> <span class="mh">0x60ef0</span> <span class="nl">X</span><span class="p">:</span><span class="mi">117</span> <span class="nl">Y</span><span class="p">:</span><span class="mi">500</span>
<span class="nl">Dump</span><span class="p">:</span>
<span class="n">Microsoft</span> <span class="n">Windows</span> <span class="p">[</span><span class="n">Version</span> <span class="mf">6.1.7600</span><span class="p">]</span>
<span class="n">Copyright</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="mi">2009</span> <span class="n">Microsoft</span> <span class="n">Corporation</span><span class="p">.</span>  <span class="n">All</span> <span class="n">rights</span> <span class="n">reserved</span><span class="p">.</span>

<span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">system32</span><span class="o">&gt;</span><span class="n">cd</span> <span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">a</span><span class="err">\</span><span class="n">Desktop</span>

<span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">a</span><span class="err">\</span><span class="n">Desktop</span><span class="o">&gt;</span><span class="n">winpmem_1</span><span class="mf">.1</span><span class="o">-</span><span class="n">write</span><span class="p">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">w</span> <span class="o">-</span><span class="n">l</span>
<span class="n">Will</span> <span class="n">enable</span> <span class="n">write</span> <span class="n">mode</span>
<span class="n">Loaded</span> <span class="n">Driver</span><span class="p">.</span>

<span class="nl">C</span><span class="p">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">a</span><span class="err">\</span><span class="n">Desktop</span><span class="o">&gt;</span><span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="o">--</span><span class="n">profile</span> <span class="n">Win7SP1x64</span> <span class="o">--</span><span class="n">file</span> <span class="err">\\</span><span class="p">.</span><span class="err">\</span><span class="n">pmem</span>
<span class="n">Python</span> <span class="mf">2.7.3</span> <span class="p">(</span><span class="k">default</span><span class="p">,</span> <span class="n">Apr</span> <span class="mi">10</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">23</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">26</span><span class="p">)</span> <span class="p">[</span><span class="n">MSC</span> <span class="n">v</span><span class="mf">.1500</span> <span class="mi">32</span> <span class="n">bit</span> <span class="p">(</span><span class="n">Intel</span><span class="p">)]</span>
<span class="n">Type</span> <span class="s">&quot;copyright&quot;</span><span class="p">,</span> <span class="s">&quot;credits&quot;</span> <span class="n">or</span> <span class="s">&quot;license&quot;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span><span class="p">.</span>

<span class="n">IPython</span> <span class="mf">0.12.1</span> <span class="o">--</span> <span class="n">An</span> <span class="n">enhanced</span> <span class="n">Interactive</span> <span class="n">Python</span><span class="p">.</span>
<span class="o">?</span>         <span class="o">-&gt;</span> <span class="n">Introduction</span> <span class="n">and</span> <span class="n">overview</span> <span class="n">of</span> <span class="n">IPython</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">features</span><span class="p">.</span>
<span class="nf">%quickref</span> <span class="o">-&gt;</span> <span class="n">Quick</span> <span class="n">reference</span><span class="p">.</span>
<span class="n">help</span>      <span class="o">-&gt;</span> <span class="n">Python</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">own</span> <span class="n">help</span> <span class="n">system</span><span class="p">.</span>
<span class="n">object</span><span class="o">?</span>   <span class="o">-&gt;</span> <span class="n">Details</span> <span class="n">about</span> <span class="err">&#39;</span><span class="n">object</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">use</span> <span class="err">&#39;</span><span class="n">object</span><span class="o">??</span><span class="err">&#39;</span> <span class="k">for</span> <span class="n">extra</span> <span class="n">details</span><span class="p">.</span>


<span class="n">The</span> <span class="n">Volatility</span> <span class="n">Memory</span> <span class="n">Forensic</span> <span class="n">Framework</span> <span class="n">technology</span> <span class="n">preview</span> <span class="p">(</span><span class="mf">3.0</span><span class="n">_tp2</span><span class="p">).</span>

<span class="nl">NOTE</span><span class="p">:</span> <span class="n">This</span> <span class="n">is</span> <span class="n">pre</span><span class="o">-</span><span class="n">release</span> <span class="n">software</span> <span class="n">and</span> <span class="n">is</span> <span class="n">provided</span> <span class="k">for</span> <span class="n">evauation</span> <span class="n">only</span><span class="p">.</span> <span class="n">Please</span>
<span class="n">check</span> <span class="n">at</span> <span class="nl">http</span><span class="p">:</span><span class="c1">//volatility.googlecode.com/ for officially supported versions.</span>

<span class="n">This</span> <span class="n">program</span> <span class="n">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">;</span> <span class="n">you</span> <span class="n">can</span> <span class="n">redistribute</span> <span class="n">it</span> <span class="n">and</span><span class="o">/</span><span class="n">or</span> <span class="n">modify</span> <span class="n">it</span> <span class="n">under</span>
<span class="n">the</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span><span class="p">.</span>
<span class="nl">Win7SP1x64</span><span class="p">:</span><span class="n">pmem</span> <span class="mo">07</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mi">08</span><span class="o">&gt;</span> <span class="n">pslist</span>
<span class="o">------------------------&gt;</span> <span class="n">pslist</span><span class="p">()</span>
  <span class="n">Offset</span> <span class="p">(</span><span class="n">V</span><span class="p">)</span>   <span class="n">Name</span>                    <span class="n">PID</span>   <span class="n">PPID</span>   <span class="n">Thds</span>     <span class="n">Hnds</span>   <span class="n">Sess</span>  <span class="n">Wow64</span> <span class="n">Start</span>                <span class="n">Exit</span>

<span class="o">--------------</span> <span class="o">--------------------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------------------</span> <span class="o">----------------</span>
<span class="o">----</span>
<span class="mh">0xfa80008959e0</span> <span class="n">System</span>                    <span class="mi">4</span>      <span class="mi">0</span>     <span class="mi">85</span>      <span class="mi">502</span> <span class="o">------</span>  <span class="n">False</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">01</span> <span class="mi">21</span><span class="o">:</span><span class="mi">39</span><span class="o">:</span><span class="mi">51</span>  <span class="o">-</span>

<span class="mh">0xfa8001994310</span> <span class="n">smss</span><span class="p">.</span><span class="n">exe</span>                <span class="mi">272</span>      <span class="mi">4</span>      <span class="mi">2</span>       <span class="mi">29</span> <span class="o">------</span>  <span class="n">False</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">01</span> <span class="mi">21</span><span class="o">:</span><span class="mi">39</span><span class="o">:</span><span class="mi">51</span>  <span class="o">-</span>
</pre></div>
</div>

<h1 id="devicetree" class="anchor">devicetree</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.devicetree.DeviceTree-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Show device tree.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>Windows uses a layered driver architecture, or driver chain so that multiple
drivers can inspect or respond to an IRP. Rootkits often insert drivers (or
devices) into this chain for filtering purposes (to hide files, hide network
connections, steal keystrokes or mouse movements). The devicetree plugin shows
the relationship of a driver object to its devices (by walking
_DRIVER_OBJECT.DeviceObject.NextDevice) and any attached devices
(_DRIVER_OBJECT.DeviceObject.AttachedDevice).</p>
<h3>Notes</h3>
<p>In the current implementation this plugin uses scanning methods to locate the
driver and device objects. This is an inefficient method which is also
susceptible to false positives and active subversion. We are working on
converting this plugin to use the <a href="ObjectTree.html">object_tree</a> plugin to
directly parse kernel driver structures.</p>
<h3>Sample output</h3>
<div class="highlight"><pre><span class="k">[snip]</span>
<span class="err">DRV</span> <span class="err">0x2bb31060</span> <span class="err">\Driver\winpmem</span>
<span class="err">---|</span> <span class="err">DEV</span> <span class="err">0xfa80019ba060</span> <span class="err">pmem</span> <span class="err">FILE_DEVICE_UNKNOWN</span>
<span class="err">DRV</span> <span class="err">0x2bb36600</span> <span class="err">\Driver\TermDD</span>
<span class="err">---|</span> <span class="err">DEV</span> <span class="err">0xfa80019ff040</span> <span class="err">-</span> <span class="err">FILE_DEVICE_8042_PORT</span>
<span class="err">------|</span> <span class="err">ATT</span> <span class="err">0xfa80019ff980</span> <span class="err">-</span> <span class="err">-</span> <span class="err">\Driver\mouclass</span> <span class="err">FILE_DEVICE_MOUSE</span>
<span class="err">---|</span> <span class="err">DEV</span> <span class="err">0xfa80019e2040</span> <span class="err">-</span> <span class="err">FILE_DEVICE_8042_PORT</span>
<span class="err">------|</span> <span class="err">ATT</span> <span class="err">0xfa80019e2960</span> <span class="err">-</span> <span class="err">-</span> <span class="err">\Driver\kbdclass</span> <span class="err">FILE_DEVICE_KEYBOARD</span>
<span class="k">[snip]</span>
</pre></div>


<p>In the above we can see that the winpmem driver has a device called &ldquo;pmem&rdquo;. We
also can see the mouse and keyboard drivers attached to the terminal services
driver.</p>
</div>

<h1 id="dis" class="anchor">dis</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.tools.disassembler.Disassemble-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Disassemble the given offset.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>address_space</p></td><td><p>The address space to use.</p></td></tr><tr><td><p>branch</p></td><td><p>If set we follow all branches to cover all code. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>canonical</p></td><td><p>If set emit canonical instructions. These can be used to develop signatures. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>end</p></td><td><p>The end address to disassemble up to. (type: IntParser)</p></td></tr><tr><td><p>length</p></td><td><p>The number of instructions (lines) to disassemble. (type: IntParser)</p></td></tr><tr><td><p>mode</p></td><td><p>Disassemble Mode (AMD64 or I386). Defaults to &lsquo;auto&rsquo;. (type: Choices)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>auto</li>
<li>I386</li>
<li>AMD64</li>
<li>MIPS</li>
</ul>
</li>
<li>
<p>Default: auto</p>
</li>
</ul></td></tr><tr><td><p>offset</p></td><td><p>An offset to disassemble. This can also be the name of a symbol with an optional offset. For example: tcpip!TcpCovetNetBufferList. (type: SymbolAddress)</p></td></tr><tr><td><p>suppress_headers</p></td><td><p>If set we do not write table headers. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>This plugin is used to disassemble memory regions. The offset to disassemble may be given as:</p>
<ul>
<li>
<p>An address in the current default address space (See the
  <a href="SetProcessContext.html">cc</a> plugin for an explaination of the default address
  space).</p>
</li>
<li>
<p>The name of a kernel module with an optional symbol name. The symbol may be an
  experted symbol, or non-exported symbol as defined in the pdb file for that
  kernel module.</p>
</li>
</ul>
<h3>Notes</h3>
<ol>
<li>
<p>When using the interactive console you can complete symbol names by double
   tapping the [tab] key. For example <strong>dis &ldquo;nt!KiSetTi[tab][tab]</strong>.</p>
</li>
<li>
<p>Rekall attempts to resolve addresses in the disassembly back to known symbol
   names. Additionally, for indirect operations, Rekall also prints the current
   value of the memory location. This feature is especially useful for
   understanding where indirect jumps are going - without needing to consider PE
   import tables etc. This works since the IAT is already patched into memory,
   hence Rekall can completely ignore IAT resoltion (unlike a standalone PE
   analyser like IDA).</p>
</li>
</ol>
<h3>Sample output</h3>
<p>Here we disassemble the kernel function <strong>KiSetTimerEx</strong> to observe the DPC
pointer obfuscation that Patch Guard uses on 64 bit Windows 7. We can see the
names of the symbols used and their current values, as well as the name of
internally called functions.</p>
<div class="highlight"><pre>win7.elf 23:48:14&gt; dis &quot;nt!KiSetTimerEx&quot;
-----------------&gt; dis(&quot;nt!KiSetTimerEx&quot;)
   Address      Rel Op Codes             Instruction                    Comment
-------------- ---- -------------------- ------------------------------ -------
------ nt!KiSetTimerEx ------
0xf8000269d4f0    0 48895c2408           MOV [RSP+0x8], RBX
0xf8000269d4f5    5 4889542410           MOV [RSP+0x10], RDX
0xf8000269d4fa    A 55                   PUSH RBP
0xf8000269d4fb    B 56                   PUSH RSI
0xf8000269d4fc    C 57                   PUSH RDI
0xf8000269d4fd    D 4154                 PUSH R12
0xf8000269d4ff    F 4155                 PUSH R13
0xf8000269d501   11 4156                 PUSH R14
0xf8000269d503   13 4157                 PUSH R15
0xf8000269d505   15 4883ec50             SUB RSP, 0x50
0xf8000269d509   19 488b05f09b2200       MOV RAX, [RIP+0x229bf0]        0x6D7CFFA404933FBB nt!KiWaitNever
0xf8000269d510   20 488b1dc19c2200       MOV RBX, [RIP+0x229cc1]        0x933DD660CFFF8004 nt!KiWaitAlways
0xf8000269d517   27 4c8bb424b0000000     MOV R14, [RSP+0xb0]
0xf8000269d51f   2F 4933de               XOR RBX, R14
0xf8000269d522   32 488bf1               MOV RSI, RCX
0xf8000269d525   35 450fb6f9             MOVZX R15D, R9B
0xf8000269d529   39 480fcb               BSWAP RBX
0xf8000269d52c   3C 418bf8               MOV EDI, R8D
0xf8000269d52f   3F 4833d9               XOR RBX, RCX
0xf8000269d532   42 8bc8                 MOV ECX, EAX
0xf8000269d534   44 48d3cb               ROR RBX, CL
0xf8000269d537   47 4833d8               XOR RBX, RAX
0xf8000269d53a   4A 450f20c4             MOV R12, CR8
0xf8000269d53e   4E b802000000           MOV EAX, 0x2
0xf8000269d543   53 440f22c0             MOV CR8, RAX
0xf8000269d547   57 65488b2c2520000000   MOV RBP, [GS:0x20]
0xf8000269d550   60 33d2                 XOR EDX, EDX
0xf8000269d552   62 488bce               MOV RCX, RSI
0xf8000269d555   65 e8f6b0ffff           CALL 0xf80002698650            nt!KiCancelTimer
0xf8000269d55a   6A 48895e30             MOV [RSI+0x30], RBX
</pre></div>
</div>

<h1 id="dlldump" class="anchor">dlldump</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.procdump.DLLDump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump DLLs from a process address space</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>out_fd</p></td><td><p>A file like object to write the output.</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>regex</p></td><td><p>A Regular expression for selecting the dlls to dump.</p>
<ul>
<li>Default: .+</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>To extract a DLL from a process&rsquo;s memory space and dump it to disk for analysis,
use the dlldump command. All the usual process selectors are
supported. Additionally a regular expression can be specified for the DLL name
to dump.</p>
<h3>Note</h3>
<ol>
<li>
<p>In order to dump any PE file from memory we need the PE header to be memory
   resident. Often this is not the case, and the header is flushed out of
   virtual memory. In this case it is still possible to dump parts of the PE
   image using the <a href="VADDump.html">vaddump</a> plugin.</p>
</li>
<li>
<p>When dumping any binary from memory, it is not usually a perfect binary
   (i.e. you can not just run it). This is because the Import Address Table
   (IAT) reflects the patched version in memory and some pages may be
   missing. The resultant binary is probably only useful to analyses using a
   tool like IDA pro.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 14:51:37&gt; dlldump proc_regex=&quot;winpmem&quot;, dump_dir=&quot;/tmp/&quot;
-------------------&gt; dlldump(proc_regex=&quot;winpmem&quot;, dump_dir=&quot;/tmp/&quot;)
  _EPROCESS    Name                  Base      Module               Dump File
-------------- ---------------- -------------- -------------------- ---------
0xe0000204a900 winpmem_1.5.2.   0x000000020000 winpmem_1.5.2.exe    module.2628.3d04a900.20000.winpmem_1.5.2.exe
0xe0000204a900 winpmem_1.5.2.   0x7ff87f320000 ntdll.dll            module.2628.3d04a900.7ff87f320000.ntdll.dll
0xe0000204a900 winpmem_1.5.2.   0x000076f50000 wow64.dll            module.2628.3d04a900.76f50000.wow64.dll
0xe0000204a900 winpmem_1.5.2.   0x000076fa0000 wow64win.dll         module.2628.3d04a900.76fa0000.wow64win.dll
0xe0000204a900 winpmem_1.5.2.   0x000077010000 wow64cpu.dll         module.2628.3d04a900.77010000.wow64cpu.dll
</pre></div>
</div>

<h1 id="dlllist" class="anchor">dlllist</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.taskmods.WinDllList-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Prints a list of dll modules mapped into each process.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>Lists dll modules loaded into a process by following the doubly linked list of
<strong>LDR_DATA_TABLE_ENTRY</strong> stored in in
<strong>_EPROCESS.Peb.Ldr.InLoadOrderModuleList</strong>. DLLs are automatically added to
this list when a process calls <em>LoadLibrary</em> (or some derivative such as
<em>LdrLoadDll</em>) and they aren&rsquo;t removed until <em>FreeLibrary</em> is called and the
reference count reaches zero.</p>
<p>All the usual process selectors are supported.</p>
<h3>Note</h3>
<ol>
<li>
<p>Wow64 processes (i.e. 32 bit binaries running on 64 bit windows) load dlls
   through a different mechanism.</p>
</li>
<li>
<p>Since the <strong>InLoadOrderModuleList</strong> is maintained in the process address
   space, it is simple to manipulate from Ring 3 (without kernel access). This
   means that this plugin may not show all the linked in DLLs.</p>
</li>
<li>
<p>A better plugin to use is the <a href="LdrModules.html">ldrmodules</a> plugin, which
   uses the VAD to enumerate dlls. The VAD is maintained in kernel memory and
   therefore can only be accessed through Ring 0 access.</p>
</li>
</ol>
<h3>Sample output</h3>
<p>Below we see winpmem used to acquire the image of this Windows 8.1 system. Since
winpmem is a 32 bit application, we see the wow64.dll dynamically loaded. Note
that in this case, the 32 bit dlls will not show in the
<strong>InLoadOrderModuleList</strong>. Using the <a href="LdrModules.html">ldrmodules</a> plugin
reveals all the 32 bit dlls loaded.</p>
<div class="highlight"><pre>win8.1.raw 15:35:10&gt; dlllist proc_regex=&quot;winpmem&quot;
-------------------&gt; dlllist(proc_regex=&quot;winpmem&quot;)
winpmem_1.5.2. pid: 2628
Command line : winpmem_1.5.2.exe  -2 win8.1.raw
Note: use ldrmodules for listing DLLs in Wow64 processes


     Base           Size      Load Reason/Count              Path
-------------- -------------- ------------------------------ ----
0x000000020000        0x2d000 LoadReasonStaticDependency     C:\temp\winpmem_1.5.2.exe
0x7ff87f320000       0x1a9000 LoadReasonStaticDependency     C:\Windows\SYSTEM32\ntdll.dll
0x000076f50000        0x49000 LoadReasonDynamicLoad          C:\Windows\SYSTEM32\wow64.dll
0x000076fa0000        0x68000 LoadReasonStaticDependency     C:\Windows\system32\wow64win.dll
0x000077010000         0x9000 LoadReasonStaticDependency     C:\Windows\system32\wow64cpu.dll
win8.1.raw 15:35:51&gt; ldrmodules proc_regex=&quot;winpmem&quot;
-------------------&gt; ldrmodules(proc_regex=&quot;winpmem&quot;)
Pid      Process                   Base      InLoad InInit InMem MappedPath
-------- -------------------- -------------- ------ ------ ----- ----------
2628     winpmem_1.5.2.       0x0000753b0000 False False False \Windows\SysWOW64\KernelBase.dll
2628     winpmem_1.5.2.       0x000000020000 True  False True  \temp\winpmem_1.5.2.exe
2628     winpmem_1.5.2.       0x000076c30000 False False False \Windows\SysWOW64\kernel32.dll
2628     winpmem_1.5.2.       0x000074a40000 False False False \Windows\SysWOW64\cryptbase.dll
2628     winpmem_1.5.2.       0x000074a50000 False False False \Windows\SysWOW64\sspicli.dll
2628     winpmem_1.5.2.       0x000077010000 True  True  True  \Windows\System32\wow64cpu.dll
2628     winpmem_1.5.2.       0x000076f50000 True  True  True  \Windows\System32\wow64.dll
2628     winpmem_1.5.2.       0x000076fa0000 True  True  True  \Windows\System32\wow64win.dll
2628     winpmem_1.5.2.       0x000075250000 False False False \Windows\SysWOW64\rpcrt4.dll
2628     winpmem_1.5.2.       0x0ff87f320000 False False False \Windows\System32\ntdll.dll
2628     winpmem_1.5.2.       0x000077020000 False False False \Windows\SysWOW64\ntdll.dll
2628     winpmem_1.5.2.       0x0000749e0000 False False False \Windows\SysWOW64\bcryptprimitives.dll
2628     winpmem_1.5.2.       0x000074ff0000 False False False \Windows\SysWOW64\advapi32.dll
2628     winpmem_1.5.2.       0x000076f10000 False False False \Windows\SysWOW64\sechost.dll
2628     winpmem_1.5.2.       0x000074d80000 False False False \Windows\SysWOW64\msvcrt.dll
</pre></div>
</div>

<h1 id="driverirp" class="anchor">driverirp</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.devicetree.DriverIrp-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Driver IRP hook detection</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>regex</p></td><td><p>Analyze drivers matching REGEX</p></td></tr><tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>Windows drivers export a table of functions called the IRP <strong>MajorFunction</strong>
table. In that table, the driver installs function handlers to handle verious
types of requests from userspace. A common way to hook a legitimate driver is to
replace these function pointers with a malicious function.</p>
<p>Many drivers forward their IRP functions to other drivers for legitimate
purposes, so detecting hooked IRP functions based on containing modules is not a
good method. Instead, we print everything and let you be the judge. The command
also checks for Inline hooks of IRP functions and optionally prints a
disassembly of the instructions at the IRP address (pass &ndash;verbosity to enable
this).</p>
<p>This command outputs information for all drivers, unless you specify a regular
expression filter.</p>
<h3>Notes</h3>
<p>In the current implementation this plugin uses scanning methods to locate the
driver and device objects. This is an inefficient method which is also
susceptible to false positives and active subversion. We are working on
converting this plugin to use the <a href="ObjectTree.html">object_tree</a> plugin to
directly parse kernel driver structures.</p>
<h3>Sample output</h3>
<p>In the below we see that the pmem driver handles the <strong>IRP_MJ_CREATE</strong>,
<strong>IRP_MJ_CLOSE</strong>, <strong>IRP_MJ_READ</strong> and <strong>IRP_MJ_DEVICE_CONTROL</strong> IRP types.</p>
<div class="highlight"><pre>win8.1.raw 16:15:36&gt; driverirp regex=&quot;pmem&quot;
-------------------&gt; driverirp(regex=&quot;pmem&quot;)
**************************************************
DriverName: pmem
DriverStart: 0xf800025ca000
DriverSize: 0x10000
DriverStartIo: 0x0
   - Func Name                              Func Addr    Module
---- ------------------------------------ -------------- ------
   0 IRP_MJ_CREATE                        0xf800025cb210 \??\C:\Users\test\AppData\Local\Temp\pmeA86F.tmp
   1 IRP_MJ_CREATE_NAMED_PIPE             0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
   2 IRP_MJ_CLOSE                         0xf800025cb270 \??\C:\Users\test\AppData\Local\Temp\pmeA86F.tmp
   3 IRP_MJ_READ                          0xf800025cbfa0 \??\C:\Users\test\AppData\Local\Temp\pmeA86F.tmp
   4 IRP_MJ_WRITE                         0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
   5 IRP_MJ_QUERY_INFORMATION             0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
   6 IRP_MJ_SET_INFORMATION               0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
   7 IRP_MJ_QUERY_EA                      0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
   8 IRP_MJ_SET_EA                        0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
   9 IRP_MJ_FLUSH_BUFFERS                 0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  10 IRP_MJ_QUERY_VOLUME_INFORMATION      0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  11 IRP_MJ_SET_VOLUME_INFORMATION        0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  12 IRP_MJ_DIRECTORY_CONTROL             0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  13 IRP_MJ_FILE_SYSTEM_CONTROL           0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  14 IRP_MJ_DEVICE_CONTROL                0xf800025cb300 \??\C:\Users\test\AppData\Local\Temp\pmeA86F.tmp
  15 IRP_MJ_INTERNAL_DEVICE_CONTROL       0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  16 IRP_MJ_SHUTDOWN                      0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  17 IRP_MJ_LOCK_CONTROL                  0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  18 IRP_MJ_CLEANUP                       0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  19 IRP_MJ_CREATE_MAILSLOT               0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  20 IRP_MJ_QUERY_SECURITY                0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  21 IRP_MJ_SET_SECURITY                  0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  22 IRP_MJ_POWER                         0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  23 IRP_MJ_SYSTEM_CONTROL                0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  24 IRP_MJ_DEVICE_CHANGE                 0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  25 IRP_MJ_QUERY_QUOTA                   0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  26 IRP_MJ_SET_QUOTA                     0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
  27 IRP_MJ_PNP                           0xf802d31131b8 \SystemRoot\system32\ntoskrnl.exe
</pre></div>
</div>

<h1 id="driverscan" class="anchor">driverscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.filescan.DriverScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan for driver objects _DRIVER_OBJECT</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>To find <strong>_DRIVER_OBJECT</strong>s in physical memory using pool tag scanning, use this
plugin. This is another way to locate kernel modules, although not all kernel
modules have an associated <strong>_DRIVER_OBJECT</strong>.</p>
<p>The usual way for malware to enter Ring 0 is via loading a kernel driver of some
sort. A malicious kernel driver is a strong indication that malware is running
in Ring 0.</p>
<h3>Notes</h3>
<ol>
<li>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_DRIVER_OBJECT</strong> structures out of memory. On
   the other hand, this plugin may reveal drivers which have been unloaded.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 16:17:29&gt; driverscan
-------------------&gt; driverscan()
    Offset(P)    #Ptr #Hnd     Start           Size      Service Key          Name         Driver Name
- -------------- ---- ---- -------------- -------------- -------------------- ------------ -----------
...
  0x00003e569c60    3    0 0xf80000b14000        0x10000 pcw                  pcw          \Driver\pcw
  0x00003e569e60    3    0 0xf80000aeb000        0x29000 VBoxGuest            VBoxGuest    \Driver\VBoxGuest
  0x00003e59e590   17    0 0xf80000c26000       0x118000 NDIS                 NDIS         \Driver\NDIS
  0x00003e5a1060    8    0 0xf80000ec5000       0x27f000 Tcpip                Tcpip        \Driver\Tcpip
  0x00003eb8d870    3    0 0xf800025ca000        0x10000 pmem                 pmem         \Driver\pmem
  0x00003f066e60    3    0 0xf80001c69000         0xe000 monitor              monitor      \Driver\monitor
....
</pre></div>
</div>

<h1 id="dtbscan" class="anchor">dtbscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pfn.DTBScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scans the physical memory for DTB values.</h2>
<p>This plugin can compare the DTBs found against the list of known processes
to find hidden processes.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>limit</p></td><td><p>Stop scanning after this many mb. (type: IntParser)</p>
<ul>
<li>Default: 0</li>
</ul></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>The PFN database can be used to resolve a physical address to its virtual
address in the process address space. Since processes must have unique page
tables, and therefore a unique DTB, we can enumerate all unique page tables on
the system.</p>
<p>Using this technique allows us to locate hidden processes. We simply check each
physical page and locate its DTB (or page table directory base) offset. We then
match the DTB to a known process DTB. If the DTB is not known this is a strong
indication that the process is hidden.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 16:23:50&gt; dtbscan
-------------------&gt; dtbscan()
     DTB           VAddr        _EPROCESS    Image Name           Known
-------------- -------------- -------------- -------------------- -----
0x0000001a7000 0xf6fb7dbed000 0xe00000074580 System               True
0x0000118a3000 0xf6fb7dbed000 0xe00002073900 explorer.exe         True
0x00000923e000 0xf6fb7dbed000 0xe000020ea900 svchost.exe          True
0x000036ea3000 0xf6fb7dbed000 0xe000006208c0 taskhost.exe         True
0x000004c01000 0xf6fb7dbed000 0xe000000ce080 wininit.exe          True
0x00000d0a4000 0xf6fb7dbed000 0xe000022c6900 MsMpEng.exe          True
0x0000093c4000 0xf6fb7dbed000 0xe000020df080 svchost.exe          True
0x0000348c6000 0xf6fb7dbed000 0xe00001e2f700 dwm.exe              True
0x000011504000 0xf6fb7dbed000 0xe000007a3080 svchost.exe          True
0x000007c94000 0xf6fb7dbed000 0xe00001f22080 cmd.exe              True
0x00002fe03000 0xf6fb7dbed000 0xe00002043900 conhost.exe          True
0x00002f8ce000 0xf6fb7dbed000 0xe00001299900 SearchIndexer.       True
0x0000207b9000 0xf6fb7dbed000 0xe00002645080 VBoxTray.exe         True
</pre></div>
</div>

<h1 id="dtbscan2" class="anchor">dtbscan2</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pfn.DTBScan2-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>A Fast scanner for hidden DTBs.</h2>
<p>This scanner uses the fact that the virtual address of the DTB is always the
same. We walk over all the physical pages, assume each page is a DTB and try
to resolve the constant to a physical address.</p>
<p>This plugin was written based on ideas and discussion with thomasdullien.</p>
</div>




</div>

<h1 id="dumpfiles" class="anchor">dumpfiles</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.cache.DumpFiles-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump files from memory.</h2>
<p>The interface is loosely based on the Volatility plugin of the same name,
although the implementation is quite different.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>file_objects</p></td><td><p>Kernel addresses of _FILE_OBJECT structs. (type: ArrayIntParser)</p>
<ul>
<li>Default: </li>
</ul></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="evtlogs" class="anchor">evtlogs</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.registry.evtlogs.EvtLogs-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Extract Windows Event Logs (XP/2003 only)</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>hive-offsets</p></td><td><p>A list of hive offsets as found by hivelist. If not provided we call hivelist ourselves and list the keys on all hives. (type: ArrayIntParser)</p></td></tr><tr><td><p>hive_regex</p></td><td><p>A regex to filter hive names.If not provided we use all hives.</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The evtlogs command extracts and parses binary event logs from memory. Binary
event logs are found on Windows XP and 2003 machines, therefore this plugin only
works on these architectures. These files are extracted from VAD of the
services.exe process, parsed and shown as output.</p>
<h3>Notes</h3>
<ol>
<li>This plugin will only work on Windows XP/2003. Modern windows systems use
   evtx event log format. We are still working on supporting these logs.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>xp-laptop-2005-06-25.img 16:43:19&gt; evtlogs
---------------------------------&gt; evtlogs()
TimeWritten Filename Computer Sid Source Event Id Event Type Message
----------- -------- -------- --- ------ -------- ---------- -------
2004-05-05 19:36:55+0000 SecEvent.Evt MOIT-A-PHXMOD2 S-1-5-18 Security 612 Success &#39;-&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;-&#39;;&#39;-&#39;;&#39;-&#39;;&#39;-&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;+&#39;;&#39;MOIT-A-PHXMOD2$&#39;;&#39;BALTIMORE&#39;;&#39;(0x0,0x3E7)&#39;
2004-05-05 19:36:56+0000 SecEvent.Evt MOIT-A-PHXMOD2 S-1-5-18 Security 618 Success &#39;MOIT-A-PHXMOD2$&#39;;&#39;BALTIMORE&#39;;&#39;(0x0,0x3E7)&#39;;&#39;PolEfDat: &lt;binary data&gt; (none);  &#39;
2004-05-05 19:37:03+0000 SecEvent.Evt MOIT-A-PHXMOD2 S-1-5-18 Security 537 Failure &#39;AJ.Morning&#39;;&#39;BALTIMORE&#39;;&#39;11&#39;;&#39;User32  &#39;;&#39;Negotiate&#39;;&#39;MOIT-A-PHXMOD2&#39;;&#39;0xC000005E&#39;;&#39;0x0&#39;
2004-05-05 19:37:03+0000 SecEvent.Evt MOIT-A-PHXMOD2 S-1-5-21-487349131-2095749132-2248483902-19753 Security 528 Success &#39;AJ.Morning&#39;;&#39;BALTIMORE&#39;;&#39;(0x0,0x113AD)&#39;;&#39;2&#39;;&#39;User32  &#39;;&#39;Negotiate&#39;;&#39;MOIT-A-PHXMOD2&#39;;&#39;{5c92d34f-85d3-2f5d-d036-759d7c97bfd7}&#39;
2004-05-05 19:37:32+0000 SecEvent.Evt MOIT-A-PHXMOD2 S-1-5-19 Security 528 Success &#39;LOCAL SERVICE&#39;;&#39;NT AUTHORITY&#39;;&#39;(0x0,0x3E5)&#39;;&#39;5&#39;;&#39;Advapi  &#39;;&#39;Negotiate&#39;;&#39;&#39;;&#39;{00000000-0000-0000-0000-000000000000}&#39;
2004-05-05 19:37:33+0000 SecEvent.Evt MOIT-A-PHXMOD2 S-1-5-21-487349131-2095749132-2248483902-19753 Security 596 Failure &#39;619be804-cde6-484f-aff4-2a5e588d6eef&#39;;&#39;&#39;;&#39;&#39;;&#39;0x57&#39;
</pre></div>
</div>

<h1 id="filescan" class="anchor">filescan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.filescan.FileScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan Physical memory for _FILE_OBJECT pool allocations</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>To find FILE_OBJECTs in physical memory using pool tag scanning, use the
filescan command. This will find open files even if a rootkit is hiding the
files on disk and if the rootkit hooks some API functions to hide the open
handles on a live system.</p>
<p>The plugin also resolves back the <strong>_FILE_OBJECT</strong> into the ownning
process. This works only if the <strong>_FILE_OBJECT</strong> is actually in use (it does not
work for closed files).</p>
<h3>Notes</h3>
<ol>
<li>
<p>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_FILE_OBJECT</strong> structures out of memory. On the
   other hand, this plugin may reveal files which have been closed or freed.</p>
</li>
<li>
<p>When inspecting the output, the <strong>#Hnd</strong> column indicates the number of
   handles to this <strong>_FILE_OBJECT</strong>.  Objects in use will have a non zero value
   here and are likely to not be freed.</p>
</li>
<li>
<p>The plugin displays the physical address of the <strong>_FILE_OBJECT</strong> found. It
   may be possible to derive their virtual address using the <a href="PtoV.html">ptov</a>
   plugin. Alternatively, specify the <em>scan_in_kernel</em> option, to ensure
   scanning occurs in the kernel address space.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre><span class="x">win8.1.raw 16:55:44&gt; filescan scan_in_kernel=True</span>
<span class="x">-------------------&gt; filescan(scan_in_kernel=True)</span>
<span class="x">      Offset       </span><span class="cp">#</span><span class="nf">Ptr</span><span class="x"> </span><span class="cp">#</span><span class="nf">Hnd</span><span class="x"> Access     Owner      Owner Pid Owner Name       Name</span>
<span class="x">- -------------- ------ ---- ------ -------------- --------- ---------------- ----</span>
<span class="x">  0xe000000421e0     17   0 RW-rwd -------------- ---- ---------------- \</span><span class="p">$</span><span class="nv">Directory</span><span class="x"></span>
<span class="x">  0xe00000057d70     14   0 R--rwd -------------- ---- ---------------- \Windows\System32\AuthBroker.dll</span>
<span class="x">  0xe000000599d0  32758   1 R--rw- 0xe00000074580    4 System           \Windows\CSC\v2.0.6</span>
<span class="x">  0xe000000686e0     19   0 RW-rwd -------------- ---- ---------------- \</span><span class="p">$</span><span class="nv">Directory</span><span class="x"></span>
<span class="x">  0xe0000006a1f0     19   0 RW-rwd -------------- ---- ---------------- \</span><span class="p">$</span><span class="nv">Directory</span><span class="x"></span>
<span class="x">  0xe0000006b5a0     16   0 R--r-d -------------- ---- ---------------- \Windows\Fonts\modern.fon</span>
<span class="x">  0xe0000006d8c0      4   0 R--r-d -------------- ---- ---------------- \Windows\System32\negoexts.dll</span>
<span class="x">  0xe0000006dc40     16   0 R--r-- -------------- ---- ---------------- \Windows\Fonts\meiryob.ttc</span>
<span class="x">  0xe0000006e1f0  29617   1 ------ 0xe0000204a900 2628 winpmem_1.5.2.   \Connect</span>
<span class="x">  0xe0000006edd0     16   0 R--rwd -------------- ---- ---------------- \Windows\System32\msctf.dll</span>
<span class="x">  0xe00000079270     16   0 R--r-- -------------- ---- ---------------- \Windows\Cursors\aero_up.cur</span>
<span class="x">  0xe0000007abc0     12   0 R--rwd -------------- ---- ---------------- \Windows\System32\puiobj.dll</span>
<span class="x">  0xe0000007ba90     18   0 RW-rwd -------------- ---- ---------------- \</span><span class="p">$</span><span class="nv">Directory</span><span class="x"></span>
<span class="x">  0xe0000007e070      3   0 R--r-- -------------- ---- ---------------- \Windows\Fonts\segoeui.ttf</span>
<span class="x">  0xe0000007e360      4   0 RW-rwd -------------- ---- ---------------- \</span><span class="p">$</span><span class="nv">ConvertToNonresident</span><span class="x"></span>
<span class="x">  0xe0000007e890      7   0 R--r-d -------------- ---- ---------------- \Windows\System32\usbmon.dll</span>
<span class="x">  0xe0000007f360  32768   1 R--r-d 0xe000000ce080  432 wininit.exe      \Windows\System32\en-GB\user32.dll.mui</span>
<span class="x">  0xe0000007f980      4   0 R--r-d -------------- ---- ---------------- \Windows\System32\KBDUK.DLL</span>
<span class="x">  0xe000000b1d90     17   0 RW-rwd -------------- ---- ---------------- \</span><span class="p">$</span><span class="nv">Directory</span><span class="x"></span>
<span class="x">  0xe000000b1f20      5   0 R--r-d -------------- ---- ---------------- \Windows\System32\AppXDeploymentServer.dll</span>
<span class="x">  0xe000000b4610     12   0 R--rwd -------------- ---- ---------------- \Windows\SysWOW64\winmmbase.dll</span>
<span class="x">  0xe000000b6820      1   1 RWD--- 0xe00000074580    4 System           \Windows\System32\config\RegBack\SECURITY</span>
<span class="x">  0xe000000b6a50  32766   1 RW---- 0xe00000074580    4 System           \Windows\System32\config\SECURITY.LOG2</span>
</pre></div>
</div>

<h1 id="find_dtb" class="anchor">find_dtb</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.common.WinFindDTB-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>A plugin to search for the Directory Table Base for windows systems.</h2>
<p>There are a number of ways to find the DTB:</p>
<ul>
<li>
<p>Scanner method: Scans the image for a known kernel process, and read the
  DTB from its Process Environment Block (PEB).</p>
</li>
<li>
<p>Get the DTB from the KPCR structure.</p>
</li>
<li>
<p>Note that the kernel is mapped into every process&rsquo;s address space (with
  the exception of session space which might be different) so using any
  process&rsquo;s DTB from the same session will work to read kernel data
  structures. If this plugin fails, try psscan to find potential DTBs.</p>
</li>
</ul>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>process_name</p></td><td><p>The name of the process to search for.</p></td></tr>
</tbody>
</table>
</div>


<h3>Notes</h3>
<ol>
<li>This is an internally used plugin for discovering the Directory Table Base
   (DTB) on windows systems. It is unlikely to be useful to a user by itself.</li>
</ol>
</div>

<h1 id="fls" class="anchor">fls</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.filesystems.ntfs.FLS-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2></h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>path</p></td><td><p>Path to print stats for.</p>
<ul>
<li>Default: /</li>
</ul></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="handles" class="anchor">handles</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.handles.Handles-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print list of open handles for each process</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>named_only</p></td><td><p>Output only handles with a name . (type: Boolean)</p></td></tr><tr><td><p>object_types</p></td><td><p>Types of objects to show. (type: ArrayStringParser)</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>This plugin displays the handle table of processes. The handle table in the
process stores securable kernel objects.</p>
<p>When a user mode process obtains a securable kernel object, they receive a
handle to it - i.e. an integer which is the location in the handle table, rather
than the raw kernel level pointer. User processes then use the handle to operate
of the kernel level object. For example, if a process opens a file the
<strong>_FILE_OBJECT</strong> will be stored in the handle table, and the userspace code will
receive the offset into the handle table.</p>
<p>This plugin is especially useful to find all resources that are opened by a user
space program, such as open files, registry keys etc. In fact any of the objects
shown by the <a href="ObjectTypes.html">object_types</a> plugin are stored in the handle
table as can be seen by this module.</p>
<p>All the usual process selectors are supported. Additionally, it is possible to
filter the output by using a comma separated list of handle types (as can be
seen by the <a href="ObjectTypes.html">object_types</a> plugin.</p>
<h3>Sample output</h3>
<p>In the following output we see the winpmem acquisition tool&rsquo;s handle table. Note
that it has an open file to the raw device <em>\Device\pmem</em> and the output file of
<em>\Device\HarddiskVolume2\temp\win8.1.raw</em>.</p>
<div class="highlight"><pre>win8.1.raw 18:00:43&gt; handles proc_regex=&quot;winpmem&quot;
-------------------&gt; handles(proc_regex=&quot;winpmem&quot;)
  Offset (V)      Pid     Handle         Access     Type             Details
-------------- ------ -------------- -------------- ---------------- -------
0xe00001f82f20   2628            0x4       0x12019f File             \Device\ConDrv\Reference
0xe00001d17e00   2628           0x10       0x100020 File             \Device\HarddiskVolume2\Windows
0xe00001f546b0   2628           0x18       0x12019f File             \Device\ConDrv\Input
0xe00001eef800   2628           0x1c       0x12019f File             \Device\ConDrv\Output
0xe00001eef800   2628           0x20       0x12019f File             \Device\ConDrv\Output
0xe00001d0db80   2628           0x24       0x100020 File             \Device\HarddiskVolume2\temp
0xe0000006e1f0   2628           0x28       0x12019f File             \Device\ConDrv\Connect
0xe00000637480   2628           0x30       0x1f0001 ALPC Port
0xe000006bd290   2628           0x34       0x1f0003 Event
0xe00001ed6060   2628           0x38            0x1 WaitCompletionPacket
0xe00001ecd080   2628           0x3c       0x1f0003 IoCompletion
0xe00001ec7060   2628           0x40        0xf00ff TpWorkerFactory
0xe00000778320   2628           0x44       0x100002 IRTimer
0xe00001ecfb80   2628           0x48            0x1 WaitCompletionPacket
0xe00001a629d0   2628           0x4c       0x100002 IRTimer
0xe00001ec8f90   2628           0x50            0x1 WaitCompletionPacket
0xe00002048970   2628           0x54          0x804 EtwRegistration
0xe0000077dd00   2628           0x58       0x100003 Semaphore
0xe00001d1b340   2628           0x5c       0x100001 File             \Device\CNG
0xe000006b82c0   2628           0x60       0x100003 Semaphore
0xe00001d0c6e0   2628           0x64       0x120196 File             \Device\HarddiskVolume2\temp\win8.1.raw
0xe000007db2f0   2628           0x74       0x1f0003 Event
0xe000023eda60   2628           0x78          0x804 EtwRegistration
0xe000024c56c0   2628           0x7c          0x804 EtwRegistration
0xe00001f803e0   2628           0x80          0x804 EtwRegistration
0xe00000813330   2628           0x84       0x1f0003 Event
0xe00001254440   2628           0x88       0x1fffff Thread           TID 3420 PID 2628
0xe0000061ebb0   2628           0x8c       0x1f0001 ALPC Port
0xe00001d0c340   2628           0x90       0x12019f File             \Device\pmem
</pre></div>
</div>

<h1 id="hooks_eat" class="anchor">hooks_eat</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.apihooks.EATHooks-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Detect EAT hooks in process and kernel memory</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="hooks_iat" class="anchor">hooks_iat</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.apihooks.IATHooks-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Detect IAT/EAT hooks in process and kernel memory</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="hooks_inline" class="anchor">hooks_inline</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.apihooks.InlineHooks-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Detect API hooks in process and kernel memory</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="imageinfo" class="anchor">imageinfo</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.ImageInfo-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>List overview information about this image.</h2>
</div>



<p>This plugin prints an overview of certain parameters of the image.</p>
<h3>Notes</h3>
<ol>
<li>Since Rekall does not require users to select the profiles manually this
   plugin is not required to be run prior to any analysis. In fact the plugin
   itself needs to have accurate profiles loaded. It therefore does not server
   the same purpose as in previous version of the software.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 18:00:48&gt; imageinfo
-------------------&gt; imageinfo()
Fact                 Value
-------------------- -----
Kernel DTB           0x1a7000
NT Build             9600.winblue_gdr.130913-2141
NT Build Ex          9600.16404.amd64fre.winblue_gdr.130913-2141
Signed Drivers       -
Time (UTC)           2014-01-24 21:20:05+0000
Time (Local)         2014-01-24 21:20:05+0000
Sec Since Boot       764.359375
NtSystemRoot         C:\Windows
**************** Physical Layout ****************
Physical Start  Physical End  Number of Pages
-------------- -------------- ---------------
0x000000001000 0x00000009f000 158
0x000000100000 0x000000102000 2
0x000000103000 0x00003fff0000 261869
</pre></div>
</div>

<h1 id="impscan" class="anchor">impscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.impscan.ImpScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan for calls to imported functions.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>base</p></td><td><p>Base address in process memory if &ndash;pid is supplied, otherwise an address in kernel space (type: IntParser)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>kernel</p></td><td><p>Scan in kernel space. (type: Boolean)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>size</p></td><td><p>Size of memory to scan (type: IntParser)</p></td></tr>
</tbody>
</table>
</div>


<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 18:30:34&gt; impscan proc_regex=&quot;dwm.exe&quot;
-------------------&gt; impscan(proc_regex=&quot;dwm.exe&quot;)
**************************************************
Process dwm.exe PID 692
     IAT            Call      Module               Function
-------------- -------------- -------------------- --------
0x7ff7474f4000 0x7ff87f2c369c sechost.dll          ConvertStringSecurityDescriptorToSecurityDescriptorW
0x7ff7474f4030 0x7ff87b48beb0 uxtheme.dll          CloseThemeData
0x7ff7474f4038 0x7ff87b4bfc80 uxtheme.dll          OpenThemeData
0x7ff7474fa020 0x7ff87e4b5d34 msvcrt.dll           382
0x7ff7474fa030 0x7ff87e4b5f18 msvcrt.dll           410
0x7ff7474fa050 0x7ff87e4b9948 msvcrt.dll           144
0x7ff7474fa058 0x7ff87e4babc0 msvcrt.dll           129
0x7ff7474fa0e0 0x7ff87e4b468c msvcrt.dll           35
0x7ff7474fa0e8 0x7ff87e4b1cd4 msvcrt.dll           36
0x7ff7474fa120 0x7ff87f38f85c ntdll.dll            1252
0x7ff7474fa128 0x7ff87f36e384 ntdll.dll            1229
0x7ff7474fa130 0x7ff87c9a3dec KERNELBASE.dll       170
0x7ff7474fa138 0x7ff87f33c31c ntdll.dll            815
0x7ff7474fa148 0x7ff87f383270 ntdll.dll            RtlInitializeCriticalSection
0x7ff7474fa158 0x7ff87f36d100 ntdll.dll            RtlAcquireSRWLockShared
0x7ff7474fa168 0x7ff87f36b810 ntdll.dll            RtlLeaveCriticalSection
0x7ff7474fa170 0x7ff87c9a24f4 KERNELBASE.dll       157
0x7ff7474fa180 0x7ff87f36e50c ntdll.dll            1228
0x7ff7474fa188 0x7ff87f35db60 ntdll.dll            RtlAcquireSRWLockExclusive
0x7ff7474fa190 0x7ff87f36b550 ntdll.dll            867
0x7ff7474fa1a0 0x7ff87c9a14a0 KERNELBASE.dll       635
0x7ff7474fa1c8 0x7ff87c9a1440 KERNELBASE.dll       481
0x7ff7474fa1e8 0x7ff87f37c7c0 ntdll.dll            RtlSetLastWin32Error
0x7ff7474fa1f8 0x7ff87f366b90 ntdll.dll            928
0x7ff7474fa200 0x7ff87f3620d0 ntdll.dll            RtlAllocateHeap
0x7ff7474fa208 0x7ff87c9ac960 KERNELBASE.dll       684
0x7ff7474fa218 0x7ff87c9a14e0 KERNELBASE.dll       554
0x7ff7474fa230 0x7ff87edd3184 KERNEL32.DLL         GetStartupInfoW
0x7ff7474fa238 0x7ff87edd3074 KERNEL32.DLL         SetPriorityClass
</pre></div>
</div>

<h1 id="kdbgscan" class="anchor">kdbgscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.kdbgscan.KDBGScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan for possible _KDDEBUGGER_DATA64 structures.</h2>
<p>The scanner is detailed here:
http://moyix.blogspot.com/2008/04/finding-kernel-global-variables-in.html</p>
<p>The relevant structures are detailed here:
http://doxygen.reactos.org/d3/ddf/include_2psdk_2wdbgexts_8h_source.html</p>
<p>We can see that _KDDEBUGGER_DATA64.Header is:</p>
<p>typedef struct _DBGKD_DEBUG_DATA_HEADER64 {
    LIST_ENTRY64    List;
    ULONG           OwnerTag;
    ULONG           Size;
}</p>
<p>We essentially search for an owner tag of &ldquo;KDBG&rdquo;, then overlay the
_KDDEBUGGER_DATA64 struct on it. We test for validity by reflecting
through the Header.List member.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>full_scan</p></td><td><p>Scan the full address space. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>Windows keeps a store of some useful global variables in a structure called
<strong>_KDDEBUGGER_DATA64</strong>. This information is used by the microsoft kernel
debugger in order to bootstap the analysis of a crash dump.</p>
<p>Rekall no longer uses the Kernel Debugger Block for analysis - instead accurate
global symbol information are fetched from Microsoft PDB files containing
debugging symbols.</p>
<h3>Notes</h3>
<ol>
<li>Previous versions of Rekall used the KDBG heavily for analysis, and by
   extension used this plugin. Currently the KDBG is not used by Rekall at all
   so this plugin is not all that useful.</li>
</ol>
</div>

<h1 id="kpcr" class="anchor">kpcr</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.kpcr.KPCR-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>A plugin to print all KPCR blocks.</h2>
</div>



<p>Windows maintains per-processor information for each physical CPU in the
system. This plugin displays this infomation.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 21:15:09&gt; kpcr
-------------------&gt; kpcr()
**************************************************
Property                       Value
------------------------------ -----
Offset (V)                     0xf802d3307000
KdVersionBlock                 Pointer to -
IDT                            0xf802d4a43080
GDT                            0xf802d4a43000
CurrentThread                 : 0xe00001254440 TID 3420 (winpmem_1.5.2.:2628)
IdleThread                    : 0xf802d335fa80 TID 0 (System:0)
Details                       : CPU 0 (GenuineIntel @ 2517 MHz)
CR3/DTB                       : 0x1a7000
</pre></div>
</div>

<h1 id="ldrmodules" class="anchor">ldrmodules</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.malfind.LdrModules-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Detect unlinked DLLs</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>There are many ways to hide a DLL. One of the ways involves unlinking the DLL
from one (or all) of the linked lists in the PEB. However, when this is done,
there is still information contained within the VAD (Virtual Address Descriptor)
which identifies the base address of the DLL and its full path on disk. To
cross-reference this information (known as memory mapped files) with the 3 PEB
lists, use the ldrmodules command.</p>
<p>For each memory mapped PE file, the ldrmodules command prints True or False if
the PE exists in the PEB lists.</p>
<div class="highlight"><pre>win8.1.raw 22:17:36&gt; ldrmodules proc_regex=&quot;winpmem&quot;
-------------------&gt; ldrmodules(proc_regex=&quot;winpmem&quot;)
Pid      Process                   Base      InLoad InInit InMem MappedPath
-------- -------------------- -------------- ------ ------ ----- ----------
2628     winpmem_1.5.2.       0x0000753b0000 False False False \Windows\SysWOW64\KernelBase.dll
2628     winpmem_1.5.2.       0x000000020000 True  False True  \temp\winpmem_1.5.2.exe
2628     winpmem_1.5.2.       0x000076c30000 False False False \Windows\SysWOW64\kernel32.dll
2628     winpmem_1.5.2.       0x000074a40000 False False False \Windows\SysWOW64\cryptbase.dll
2628     winpmem_1.5.2.       0x000074a50000 False False False \Windows\SysWOW64\sspicli.dll
2628     winpmem_1.5.2.       0x000077010000 True  True  True  \Windows\System32\wow64cpu.dll
2628     winpmem_1.5.2.       0x000076f50000 True  True  True  \Windows\System32\wow64.dll
2628     winpmem_1.5.2.       0x000076fa0000 True  True  True  \Windows\System32\wow64win.dll
2628     winpmem_1.5.2.       0x000075250000 False False False \Windows\SysWOW64\rpcrt4.dll
2628     winpmem_1.5.2.       0x7ff87f320000 True  True  True  \Windows\System32\ntdll.dll
2628     winpmem_1.5.2.       0x000077020000 False False False \Windows\SysWOW64\ntdll.dll
2628     winpmem_1.5.2.       0x0000749e0000 False False False \Windows\SysWOW64\bcryptprimitives.dll
2628     winpmem_1.5.2.       0x000074ff0000 False False False \Windows\SysWOW64\advapi32.dll
2628     winpmem_1.5.2.       0x000076f10000 False False False \Windows\SysWOW64\sechost.dll
2628     winpmem_1.5.2.       0x000074d80000 False False False \Windows\SysWOW64\msvcrt.dll
</pre></div>


<p>Since the PEB and the DLL lists that it contains all exist in user mode, its
also possible for malware to hide (or obscure) a DLL by simply overwriting the
path. Tools that only look for unlinked entries may miss the fact that malware
could overwrite <em>C:\bad.dll</em> to show <em>C:\windows\system32\kernel32.dll</em>. So you
can also pass the <em>verbosity=10</em> parameter to ldrmodules to see the full path of
all entries.</p>
<p>For concrete examples, see <a href="http://blogs.mcafee.com/mcafee-labs/zeroaccess-misleads-memory-file-link">ZeroAccess Misleads Memory-File
Link</a>
and <a href="http://mnin.blogspot.com/2012/06/quickpost-flame-volatility.html">QuickPost: Flame &amp;
Volatility</a>.</p>
<div class="highlight"><pre>win8.1.raw 22:17:41&gt; ldrmodules proc_regex=&quot;winpmem&quot;, verbosity=10
-------------------&gt; ldrmodules(proc_regex=&quot;winpmem&quot;, verbosity=10)
Pid      Process                   Base      InLoad InInit InMem MappedPath
-------- -------------------- -------------- ------ ------ ----- ----------
2628     winpmem_1.5.2.       0x0000753b0000 False False False \Windows\SysWOW64\KernelBase.dll
2628     winpmem_1.5.2.       0x000000020000 True  False True  \temp\winpmem_1.5.2.exe
  Load Path: C:\temp\winpmem_1.5.2.exe : winpmem_1.5.2.exe
  Mem Path: C:\temp\winpmem_1.5.2.exe : winpmem_1.5.2.exe
2628     winpmem_1.5.2.       0x000076c30000 False False False \Windows\SysWOW64\kernel32.dll
2628     winpmem_1.5.2.       0x000074a40000 False False False \Windows\SysWOW64\cryptbase.dll
2628     winpmem_1.5.2.       0x000074a50000 False False False \Windows\SysWOW64\sspicli.dll
2628     winpmem_1.5.2.       0x000077010000 True  True  True  \Windows\System32\wow64cpu.dll
  Load Path: C:\Windows\system32\wow64cpu.dll : wow64cpu.dll
  Init Path: C:\Windows\system32\wow64cpu.dll : wow64cpu.dll
  Mem Path: C:\Windows\system32\wow64cpu.dll : wow64cpu.dll
2628     winpmem_1.5.2.       0x000076f50000 True  True  True  \Windows\System32\wow64.dll
  Load Path: C:\Windows\SYSTEM32\wow64.dll : wow64.dll
  Init Path: C:\Windows\SYSTEM32\wow64.dll : wow64.dll
  Mem Path: C:\Windows\SYSTEM32\wow64.dll : wow64.dll
2628     winpmem_1.5.2.       0x000076fa0000 True  True  True  \Windows\System32\wow64win.dll
  Load Path: C:\Windows\system32\wow64win.dll : wow64win.dll
  Init Path: C:\Windows\system32\wow64win.dll : wow64win.dll
  Mem Path: C:\Windows\system32\wow64win.dll : wow64win.dll
2628     winpmem_1.5.2.       0x000075250000 False False False \Windows\SysWOW64\rpcrt4.dll
2628     winpmem_1.5.2.       0x7ff87f320000 True  True  True  \Windows\System32\ntdll.dll
  Load Path: C:\Windows\SYSTEM32\ntdll.dll : ntdll.dll
  Init Path: C:\Windows\SYSTEM32\ntdll.dll : ntdll.dll
  Mem Path: C:\Windows\SYSTEM32\ntdll.dll : ntdll.dll
2628     winpmem_1.5.2.       0x000077020000 False False False \Windows\SysWOW64\ntdll.dll
2628     winpmem_1.5.2.       0x0000749e0000 False False False \Windows\SysWOW64\bcryptprimitives.dll
2628     winpmem_1.5.2.       0x000074ff0000 False False False \Windows\SysWOW64\advapi32.dll
2628     winpmem_1.5.2.       0x000076f10000 False False False \Windows\SysWOW64\sechost.dll
2628     winpmem_1.5.2.       0x000074d80000 False False False \Windows\SysWOW64\msvcrt.dll
</pre></div>


<h3>Notes</h3>
<ol>
<li>Wow64 processes (i.e. 32 bit processes on 64 bit windows) will not show any
   32 bit DLLs in any of the loader lists. This is normal (and you will see the
   Dlls loaded from the \Windows\Wow64 directory.</li>
</ol>
</div>

<h1 id="malfind" class="anchor">malfind</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.malfind.Malfind-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Find hidden and injected code</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>The malfind command helps find hidden or injected code/DLLs in user mode memory,
based on characteristics such as VAD tag and page permissions.</p>
<p>Note: malfind does not detect DLLs injected into a process using
<strong>CreateRemoteThread-&gt;LoadLibrary</strong>. DLLs injected with this technique are not
hidden and thus you can view them with dlllist. The purpose of malfind is to
locate DLLs that standard methods/tools do not see.</p>
<p>Here is an example of using it to detect the presence of Zeus. The first memory
segment (starting at 0x2aa0000) was detected because it is executable, marked as
private (not shared between processes) and has a VadS tag&hellip; which means there
is no memory mapped file already occupying the space. Based on a disassembly of
the data found at this address, it seems to contain some API hook trampoline
stubs.</p>
<p>The second memory segment (starting at 0x3080000) was detected because it contained an executable that isn&rsquo;t listed in the PEB&rsquo;s module lists.</p>
<p>If you want to save extracted copies of the memory segments identified by
malfind, just supply an output directory with the <em>dump_dir</em> parameter. In this
case, an unpacked copy of the Zeus binary that was injected into explorer.exe
would be written to disk.</p>
<div class="highlight"><pre>zeus2x4.vmem 22:53:43&gt; malfind proc_regex=&quot;explorer&quot;
---------------------&gt; malfind(proc_regex=&quot;explorer&quot;)
**************************************************f pid 1752
Process: explorer.exe Pid: 1752 Address: 0x2aa0000
Vad Tag: VadS Protection: EXECUTE_READWRITE
Flags: CommitCharge: 1, MemCommit: 1, PrivateMemory: 1, Protection: 6

 0x2aa0000 b8 35 00 00 00 e9 a9 d1 e6 79 68 6c 02 00 00 e9  .5.......yhl....
 0x2aa0010 b4 63 e7 79 8b ff 55 8b ec e9 7c 11 d7 79 8b ff  .c.y..U...|..y..
 0x2aa0020 55 8b ec e9 01 32 77 74 8b ff 55 8b ec e9 7c 60  U....2wt..U...|`
 0x2aa0030 72 74 8b ff 55 8b ec e9 ca e9 72 74 8b ff 55 8b  rt..U.....rt..U.

0x02aa0000      b835000000           MOV EAX, 0x35
0x02aa0005      e9a9d1e679           JMP 0x7c90d1b3
0x02aa000a      686c020000           PUSH DWORD 0x26c
0x02aa000f      e9b463e779           JMP 0x7c9163c8
0x02aa0014      8bff                 MOV EDI, EDI
0x02aa0016      55                   PUSH EBP
0x02aa0017      8bec                 MOV EBP, ESP
0x02aa0019      e97c11d779           JMP 0x7c81119a
0x02aa001e      8bff                 MOV EDI, EDI
0x02aa0020      55                   PUSH EBP
0x02aa0021      8bec                 MOV EBP, ESP
0x02aa0023      e901327774           JMP 0x77213229
0x02aa0028      8bff                 MOV EDI, EDI
0x02aa002a      55                   PUSH EBP
0x02aa002b      8bec                 MOV EBP, ESP
0x02aa002d      e97c607274           JMP 0x771c60ae
0x02aa0032      8bff                 MOV EDI, EDI
0x02aa0034      55                   PUSH EBP
0x02aa0035      8bec                 MOV EBP, ESP
0x02aa0037      e9cae97274           JMP 0x771cea06
0x02aa003c      8bff                 MOV EDI, EDI
0x02aa003e      55                   PUSH EBP
0x02aa003f      8bec                 MOV EBP, ESP
0x02aa0041      e9e8327774           JMP 0x7721332e
0x02aa0046      8bff                 MOV EDI, EDI
0x02aa0048      55                   PUSH EBP
0x02aa0049      8bec                 MOV EBP, ESP
0x02aa004b      e9494d7274           JMP 0x771c4d99
0x02aa0050      8bff                 MOV EDI, EDI
0x02aa0052      55                   PUSH EBP
0x02aa0053      8bec                 MOV EBP, ESP
0x02aa0055      e99d827274           JMP 0x771c82f7
0x02aa005a      8bff                 MOV EDI, EDI
0x02aa005c      55                   PUSH EBP
0x02aa005d      8bec                 MOV EBP, ESP
0x02aa005f      e9ef927574           JMP 0x771f9353
0x02aa0064      8bff                 MOV EDI, EDI
0x02aa0066      55                   PUSH EBP
0x02aa0067      8bec                 MOV EBP, ESP
0x02aa0069      e9fe897374           JMP 0x771d8a6c
0x02aa006e      6a2c                 PUSH 0x2c
0x02aa0070      68187b1c77           PUSH DWORD 0x771c7b18
0x02aa0075      e957797274           JMP 0x771c79d1
0x02aa007a      8bff                 MOV EDI, EDI
0x02aa007c      55                   PUSH EBP
0x02aa007d      8bec                 MOV EBP, ESP
0x02aa007f      e9ac3d016f           JMP 0x71ab3e30
0x02aa0084      8bff                 MOV EDI, EDI
0x02aa0086      55                   PUSH EBP
0x02aa0087      8bec                 MOV EBP, ESP
0x02aa0089      e99e4b016f           JMP 0x71ab4c2c
0x02aa008e      8bff                 MOV EDI, EDI
0x02aa0090      55                   PUSH EBP
0x02aa0091      8bec                 MOV EBP, ESP
0x02aa0093      e96768016f           JMP 0x71ab68ff
0x02aa0098      8bff                 MOV EDI, EDI
0x02aa009a      55                   PUSH EBP
0x02aa009b      8bec                 MOV EBP, ESP
0x02aa009d      e9598b977b           JMP 0x7e418bfb
0x02aa00a2      8bff                 MOV EDI, EDI
0x02aa00a4      55                   PUSH EBP
0x02aa00a5      8bec                 MOV EBP, ESP
0x02aa00a7      e9130d997b           JMP 0x7e430dbf
0x02aa00ac      8bff                 MOV EDI, EDI
0x02aa00ae      55                   PUSH EBP
**************************************************
Process: explorer.exe Pid: 1752 Address: 0x3080000
Vad Tag: VadS Protection: EXECUTE_READWRITE
Flags: CommitCharge: 52, MemCommit: 1, PrivateMemory: 1, Protection: 6

 0x3080000 4d 5a 90 00 03 00 00 00 04 00 00 00 ff ff 00 00  MZ..............
 0x3080010 b8 00 00 00 00 00 00 00 40 00 00 00 00 00 00 00  ........@.......
 0x3080020 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
 0x3080030 00 00 00 00 00 00 00 00 00 00 00 00 c0 00 00 00  ................

0x03080000      4d                   DEC EBP
0x03080001      5a                   POP EDX
0x03080002      90                   NOP
0x03080003      0003                 ADD [EBX], AL
0x03080005      0000                 ADD [EAX], AL
0x03080007      000400               ADD [EAX+EAX], AL
0x0308000a      0000                 ADD [EAX], AL
0x0308000c      ff                   DB 0xff
0x0308000d      ff00                 INC DWORD [EAX]
0x0308000f      00b800000000         ADD [EAX+0x0], BH
0x03080015      0000                 ADD [EAX], AL
0x03080017      004000               ADD [EAX+0x0], AL
0x0308001a      0000                 ADD [EAX], AL
0x0308001c      0000                 ADD [EAX], AL
0x0308001e      0000                 ADD [EAX], AL
</pre></div>
</div>

<h1 id="memdump" class="anchor">memdump</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.taskmods.WinMemDump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump windows processes.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>all</p></td><td><p>Use the entire range of address space. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>coalesce</p></td><td><p>Merge contiguous pages into larger ranges. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>To dump all addressable memory in a process, use the memdump plugin. This plugin
enumerates the process page tables and writes them out into an external file. An
index file is also created which can be used to find the virtual address of each
byte in the output file.</p>
<p>You would typically use this output file in order to scan for e.g. virus
signatures or other patterns in tools which do not understand virtual memory
mappings.</p>
<p>The plugin accepts all the usual process filtering commands (e.g. by pid,
proc_regex etc). Additionally if no filtering command is specified the plugin
dumps the kernel&rsquo;s address space. (You can dump all processes by providing a<strong>proc_regex</strong> of &lsquo;.&rsquo;).</p>
<h3>Notes</h3>
<ol>
<li>
<p>This plugin is very similar to the vaddump plugin, except that it dumps the
   page table, and not only the VAD tree. This plugin actually contains all
   memory currently accessible to the process (despite any possible manipulation
   of the VAD tree).</p>
</li>
<li>
<p>The process&rsquo;s virtual address space is typically fragmented and had large,
   unmapped gaps in it. Therefore this plugin does not just zero fill these
   gaps, rather it writes all addressable memory directly to the output
   file. This means that contiguous memory in the output file is not necessarily
   contiguous in memory.</p>
</li>
<li>
<p>To find out where a particular byte in the output file maps in the process
   virtual memory, check the index file (Example below).</p>
</li>
<li>
<p>Note that processes typically alway map the kernel in the upper memory region
   (i.e. above the symbol <code>MmHighestUserAddress</code>. This plugin does not dump the
   kernel portion of the address space, unless the <strong>&ndash;all</strong> parameter is
   specified.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win7.elf 00:30:52&gt; memdump pid=2912, dump_dir=&quot;/tmp/&quot;
-----------------&gt; memdump(pid=2912, dump_dir=&quot;/tmp/&quot;)
**************************************************
Writing vol.exe 0xfa8002193060 to vol.exe_2912.dmp
win7.elf 00:30:55&gt; ls -l /tmp/vol.exe_2912.dmp -h
-rw-r----- 1 scudette staff 2.2M Jun 18 00:30 /tmp/vol.exe_2912.dmp
win7.elf 00:30:59&gt; less /tmp/vol.exe_2912.dmp.idx
 File Address      Length      Virtual Addr
-------------- -------------- --------------
0x000000000000 0x000000001000 0x000000010000
0x000000001000 0x000000001000 0x000000020000
0x000000002000 0x000000001000 0x000000021000
0x000000003000 0x000000001000 0x00000002f000
0x000000004000 0x000000001000 0x000000040000
0x000000005000 0x000000001000 0x000000050000
0x000000006000 0x000000001000 0x000000051000
</pre></div>
</div>

<h1 id="memmap" class="anchor">memmap</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.taskmods.WinMemMap-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Calculates the memory regions mapped by a process.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>all</p></td><td><p>Use the entire range of address space. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>coalesce</p></td><td><p>Merge contiguous pages into larger ranges. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>To enumerate the address space of a process use this plugin.</p>
<p>It is not that useful in practice, unless you want to manually translate a
physical address to a virtual address.</p>
<h3>Notes</h3>
<ol>
<li>
<p>It is not often necessary to dump the entire page tables of each
   process. Instead it is possible to first switch to the process context (using
   the <strong>cc</strong> plugin), and then use <em>vtop</em> to translate the virtual address to
   physical address.</p>
</li>
<li>
<p>Similar to the <strong>memdump</strong> plugin, we do not dump the kernel address space
   portion for processes unless the <strong>all</strong> parameter is specified.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win7.elf 00:54:22&gt; memmap pid=2912
-----------------&gt; memmap(pid=2912)
**************************************************
Process: &#39;vol.exe&#39; pid: 2912

Dumping address space at DTB 0x271ec000

   Virtual        Physical         Size
-------------- -------------- --------------
0x000000010000 0x000007c4c000         0x1000
0x000000020000 0x00000818f000         0x1000
0x000000021000 0x000007e11000         0x1000
0x00000002f000 0x000008010000         0x1000
0x000000040000 0x00002428e000         0x1000
0x000000050000 0x000001e6b000         0x1000
0x000000051000 0x000007f49000         0x1000
</pre></div>
</div>

<h1 id="moddump" class="anchor">moddump</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.procdump.ModDump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump kernel drivers from kernel space.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>out_fd</p></td><td><p>A file like object to write the output.</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>regex</p></td><td><p>A Regular expression for selecting the dlls to dump.</p>
<ul>
<li>Default: .+</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>To extract a kernel module from memory and dump it to disk for analysis, use the
moddump command. A regular expression can be specified for the module name to
dump.</p>
<h3>Note</h3>
<ol>
<li>
<p>In order to dump any PE file from memory we need the PE header to be memory
   resident. Often this is not the case, and the header is flushed out of
   virtual memory.</p>
</li>
<li>
<p>When dumping any binary from memory, it is not usually a perfect binary
   (i.e. you can not just run it). This is because the Import Address Table
   (IAT) reflects the patched version in memory and some pages may be
   missing. The resultant binary is probably only useful to analyses using a
   tool like IDA pro.</p>
</li>
</ol>
<h3>Sample output</h3>
<p>In this example we dump the winpmem driver to disk. The winpmem driver loads
from a temporary file name (You can see it using the <a href="Modules.html">modules</a>
plugin.</p>
<div class="highlight"><pre>win8.1.raw 23:27:12&gt; moddump regex=&quot;tmp&quot;, dump_dir=&quot;/tmp&quot;
-------------------&gt; moddump(regex=&quot;tmp&quot;, dump_dir=&quot;/tmp&quot;)
Dumping pmeA86F.tmp, Base: f800025ca000 output: driver.f800025ca000.sys
</pre></div>
</div>

<h1 id="modscan" class="anchor">modscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.modscan.ModScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan Physical memory for _LDR_DATA_TABLE_ENTRY objects.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The modscan command finds LDR_DATA_TABLE_ENTRY structures by scanning physical
memory for pool tags. This can pick up previously unloaded drivers and drivers
that have been hidden/unlinked by rootkits.</p>
<h3>Notes</h3>
<ol>
<li>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_LDR_DATA_TABLE_ENTRY</strong> structures out of
   memory. On the other hand, this plugin may reveal files which have been
   closed or freed.</li>
</ol>
<h3>Sample output</h3>
<p>In this example we can identify the pmem driver which was loaded from a
temporary location.</p>
<div class="highlight"><pre>win8.1.raw 23:27:24&gt; modscan
-------------------&gt; modscan()
  Offset(P)    Name                      Base           Size      File
-------------- -------------------- -------------- -------------- ----
0x000001ce507e                      0x20c483483824     0xebc08b44
0x00003ce163b0 mrxsmb.sys           0xf80002174000        0x6d000 \SystemRoot\system32\DRIVERS\mrxsmb.sys
0x00003ce17610 mrxsmb20.sys         0xf80002000000        0x39000 \SystemRoot\system32\DRIVERS\mrxsmb20.sys
0x00003ce1e830 mpsdrv.sys           0xf8000215d000        0x17000 \SystemRoot\System32\drivers\mpsdrv.sys
0x00003ce4cf30 Ndu.sys              0xf800022cd000        0x1d000 \SystemRoot\system32\drivers\Ndu.sys
0x00003ce4df20 mrxsmb10.sys         0xf80002282000        0x4b000 \SystemRoot\system32\DRIVERS\mrxsmb10.sys
0x00003ce80170 peauth.sys           0xf800022ea000        0xa9000 \SystemRoot\system32\drivers\peauth.sys
0x00003ce8b010 srvnet.sys           0xf8000239e000        0x43000 \SystemRoot\System32\DRIVERS\srvnet.sys
0x00003ce8bc20 secdrv.SYS           0xf80002393000         0xb000 \SystemRoot\System32\Drivers\secdrv.SYS
0x00003ceae280 tcpipreg.sys         0xf800023e1000        0x12000 \SystemRoot\System32\drivers\tcpipreg.sys
0x00003ceae520 srv2.sys             0xf800024ec000        0xad000 \SystemRoot\System32\DRIVERS\srv2.sys
0x00003cec9ee0                      0x665602050006            0x0
0x00003ceede60 srv.sys              0xf80002400000        0x98000 \SystemRoot\System32\DRIVERS\srv.sys
0x00003cf44eb0 mslldp.sys           0xf80002498000        0x16000 \SystemRoot\system32\DRIVERS\mslldp.sys
0x00003d144160 rspndr.sys           0xf80001caf000        0x18000 \SystemRoot\system32\DRIVERS\rspndr.sys
0x00003d145a50 lltdio.sys           0xf80001c9b000        0x14000 \SystemRoot\system32\DRIVERS\lltdio.sys
0x00003d18c850 HTTP.sys             0xf80002043000        0xfa000 \SystemRoot\system32\drivers\HTTP.sys
0x00003d29b010 pmeA86F.tmp          0xf800025ca000        0x10000 \??\C:\Users\test\AppData\Local\Temp\pmeA86F.tmp
0x00003d655520 HdAudio.sys          0xf80001d45000        0x66000 \SystemRoot\system32\drivers\HdAudio.sys
0x00003d6593e0 tunnel.sys           0xf800024ae000        0x2d000 \SystemRoot\system32\DRIVERS\tunnel.sys
</pre></div>
</div>

<h1 id="modules" class="anchor">modules</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.modules.Modules-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print list of loaded kernel modules.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>name_regex</p></td><td><p>Filter module names by this regex.</p></td></tr>
</tbody>
</table>
</div>


<p>To view the list of kernel drivers loaded on the system, use the modules
command. This walks the doubly-linked list of <strong>_LDR_DATA_TABLE_ENTRY</strong>
structures pointed to by <strong>PsLoadedModuleList</strong>.</p>
<p>It cannot find hidden/unlinked kernel drivers, however <a href="ModScan.html">modscan</a>
serves that purpose. Also, since this plugin uses list walking techniques, you
typically can assume that the order the modules are displayed in the output is
the order they were loaded on the system.</p>
<h3>Notes</h3>
<ol>
<li>The Base address is the location where the kernel module&rsquo;s PE header is
   mapped. For example you can examine information about the module&rsquo;s IAT/EAT
   using the <a href="PEInfo.html">peinfo</a> plugin, providing the base address.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 23:35:19&gt; modules
-------------------&gt; modules()
  Offset (V)   Name                      Base           Size      File
-------------- -------------------- -------------- -------------- ----
0xe00000057620 ntoskrnl.exe         0xf802d3019000       0x781000 \SystemRoot\system32\ntoskrnl.exe
0xe00000057530 hal.dll              0xf802d379a000        0x6f000 \SystemRoot\system32\hal.dll
0xe000000557c0 storahci.sys         0xf800006d9000        0x1d000 \SystemRoot\System32\drivers\storahci.sys
0xe0000149ade0 mssmbios.sys         0xf800018c4000         0xc000 \SystemRoot\System32\drivers\mssmbios.sys
0xe000013871e0 Npfs.SYS             0xf800008ba000        0x14000 \SystemRoot\System32\Drivers\Npfs.SYS
0xe00000055d50 volmgrx.sys          0xf80000393000        0x5f000 \SystemRoot\System32\drivers\volmgrx.sys
0xe00002145a50 lltdio.sys           0xf80001c9b000        0x14000 \SystemRoot\system32\DRIVERS\lltdio.sys
0xe00000055e40 volmgr.sys           0xf8000045d000        0x15000 \SystemRoot\System32\drivers\volmgr.sys
0xe00000054950 fwpkclnt.sys         0xf80001144000        0x6c000 \SystemRoot\System32\drivers\fwpkclnt.sys
0xe00000054c60 NETIO.SYS            0xf80000d3e000        0x79000 \SystemRoot\system32\drivers\NETIO.SYS
0xe000014b3500 kbdclass.sys         0xf80001a1f000        0x10000 \SystemRoot\System32\drivers\kbdclass.sys
0xe00001339b50 drmk.sys             0xf80001c00000        0x1c000 \SystemRoot\system32\drivers\drmk.sys
0xe00000054b70 ksecpkg.sys          0xf80000db7000        0x34000 \SystemRoot\System32\Drivers\ksecpkg.sys
0xe00000054100 CLASSPNP.SYS         0xf80000800000        0x56000 \SystemRoot\System32\drivers\CLASSPNP.SYS
</pre></div>
</div>

<h1 id="mutantscan" class="anchor">mutantscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.filescan.MutantScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan for mutant objects _KMUTANT</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>This plugin uses pool scanning techniques to find <strong>_KMUTANT</strong> objects.</p>
<p>Mutants implement a &ldquo;named semaphore&rdquo; in windows. This is used by malware to
ensure only a single copy of the malware is running at the same time. By
analyzing the name of the Mutant that a specific malware strand is using it is
possible to tell immediately if the malware is running on the machine.</p>
<p>For more information, see Andreas Schuster&rsquo;s <a href="http://computer.forensikblog.de/en/2009/04/searching_for_mutants.html">Searching for Mutants</a>.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_KMUTANT</strong> structures out of memory.</p>
</li>
<li>
<p>It is more efficient to search for named mutants using the
   <a href="ObjectTree.html">object_tree</a> plugin - since it does not use pool scanning
   techniques.</p>
</li>
<li>
<p>When inspecting the output, the <strong>#Hnd</strong> column indicates the number of
   handles to this <strong>_KMUTANT</strong>.  Objects in use will have a non zero value here
   and are likely to not be freed.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 23:46:56&gt; mutantscan scan_in_kernel=1
-------------------&gt; mutantscan(scan_in_kernel=1)
    Offset(P)      #Ptr #Hnd Signal     Thread           CID Name
- -------------- ------ ---- ------ -------------- --------- ----
  0xe0000007f810      3  2 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:thumbcache_sr.db!dfMaintainer
  0xe0000007f8d0      3  2 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:thumbcache_1600.db!dfMaintainer
  0xe000000b8d00  32722  1 1    0x000000000000           BcdSyncMutant
  0xe00000624240  32769  1 0    0xe00000624700  556:1396 F659A567-8ACB-4E4A-92A7-5C2DD1884F72
  0xe000006f4a60  32768  1 0    0xe000006dc080 2332:2460 Instance2:  ESENT Performance Data Schema Version 255
  0xe00001253080  32768  1 0    0xe000007fd080  880:3144 Instance3:  ESENT Performance Data Schema Version 255
  0xe00001262360      2  1 1    0x000000000000           ARC_AppRepSettings_Mutex
  0xe00001272530      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_1024.db!dfMaintainer
  0xe000012725f0      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_256.db!dfMaintainer
  0xe000012726b0      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_96.db!dfMaintainer
  0xe00001272770      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_48.db!dfMaintainer
  0xe00001272ac0 131007  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_32.db!dfMaintainer
  0xe0000128e1e0 131005  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_16.db!dfMaintainer
  0xe0000129a2c0  32734  1 1    0x000000000000           SmartScreen_AppRepSettings_Mutex
  0xe000012c7950 131061  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_idx.db!IconCacheInit
  0xe000012c7a10      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_wide_alternate.db!dfMaintainer
  0xe000012c7ad0      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_exif.db!dfMaintainer
  0xe000012c7b90      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_wide.db!dfMaintainer
  0xe000012c7c50      5  4 1    0x000000000000           C::Users:test:AppData:Local:Microsoft:Windows:Explorer:iconcache_sr.db!dfMaintainer
...
</pre></div>
</div>

<h1 id="netscan" class="anchor">netscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.netscan.WinNetscan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan a Vista, 2008 or Windows 7 image for connections and sockets</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr><tr><td><p>tcpip_guid</p></td><td><p>Force this profile to be used for tcpip.</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="netstat" class="anchor">netstat</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.linux.netstat.Netstat-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print the active network connections.</h2>
</div>




</div>

<h1 id="netstat" class="anchor">netstat</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.network.WinNetstat-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate image for connections and sockets</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>tcpip_guid</p></td><td><p>Force this profile to be used for tcpip.</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="object_tree" class="anchor">object_tree</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.ObjectTree-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Visualize the kernel object tree.</h2>
<p>Ref:
http://msdn.microsoft.com/en-us/library/windows/hardware/ff557762(v=vs.85).aspx</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>type_regex</p></td><td><p>Filter the type of objects shown.</p>
<ul>
<li>Default: .</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The windows kernel has the notion of a <strong>Kernel Object</strong>. Objects are managed by
the kernel through a dedicated API. Kernel Objects are typically used to manage
resources which the kernel manages on behalf of user space, for example, open
files are managed via the <strong>_FILE_OBJECT</strong> object.</p>
<p>Objects can be named using a directory structure not unlike a
filesystem. Objects are placed inside an <strong>_OBJECT_DIRECTORY</strong> object which
contains other objects, including other directories. This means that named
kernel objects forma tree in memory.</p>
<p>It is possible to discover all currently in-use named objects by following this
object tree in memory, which is what this plugin does. This is an alternative to
the scanning approach employed by plugins like <strong>psscan</strong>, <strong>driverscan</strong> etc.</p>
<h3>Notes</h3>
<ol>
<li>
<p>The object tree only tracks named objects. So for example Process objects are
   typically not tracked here, but Mutants, SymbolicLinks etc are.</p>
</li>
<li>
<p>It is possible to filter objects by types. So for example to enumerate all
   Mutants one would use the <strong>type_regex=&rdquo;Mutant&rdquo;</strong> option.</p>
</li>
<li>
<p><em>SymbolicLinks</em> also contain the timestamp when they were created. Note that
   SymbolicLinks are typically used to provide userspace access to a kernel
   driver (via the <em>CreateFile</em> api), so a timestamp here is a good indication
   of when a driver was loaded.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre><span class="cp"># Enumeate all drivers</span>
<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mo">01</span><span class="o">:</span><span class="mi">25</span><span class="o">:</span><span class="mi">12</span><span class="o">&gt;</span> <span class="n">object_tree</span> <span class="n">type_regex</span><span class="o">=</span><span class="s">&quot;Driver&quot;</span>
<span class="o">-----------------&gt;</span> <span class="n">object_tree</span><span class="p">(</span><span class="n">type_regex</span><span class="o">=</span><span class="s">&quot;Driver&quot;</span><span class="p">)</span>
<span class="n">_OBJECT_HEADER</span> <span class="n">Type</span>                 <span class="n">Name</span>
<span class="o">--------------</span> <span class="o">--------------------</span> <span class="o">--------------------</span>
<span class="mh">0xfa80025e5d10</span> <span class="n">Driver</span>               <span class="p">.</span> <span class="n">mrxsmb10</span>
<span class="mh">0xfa80025e1190</span> <span class="n">Driver</span>               <span class="p">.</span> <span class="n">mrxsmb</span>
<span class="mh">0xfa8001953940</span> <span class="n">Driver</span>               <span class="p">.</span> <span class="n">mrxsmb20</span>
<span class="p">....</span>

<span class="cp"># We can examine a specific object using the virtual offset.</span>

<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mo">01</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">18</span><span class="o">&gt;</span> <span class="n">x</span><span class="o">=</span><span class="n">profile</span><span class="p">.</span><span class="n">_OBJECT_HEADER</span><span class="p">(</span><span class="mh">0xfa80019fb8d0</span><span class="p">)</span>
<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mo">01</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">34</span><span class="o">&gt;</span> <span class="n">print</span> <span class="n">x</span><span class="p">.</span><span class="n">get_object_type</span><span class="p">()</span>
<span class="n">Driver</span>

<span class="cp"># We can dereference the exact object contained in this header (in this case</span>
<span class="cp">#  _DRIVER_OBJECT.</span>

<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mo">01</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">40</span><span class="o">&gt;</span> <span class="n">print</span> <span class="n">x</span><span class="p">.</span><span class="n">Object</span>
<span class="p">[</span><span class="n">_DRIVER_OBJECT</span> <span class="n">_DRIVER_OBJECT</span><span class="p">]</span> <span class="p">@</span> <span class="mh">0xFA80019FB900</span>
  <span class="mh">0x00</span> <span class="n">Type</span>              <span class="p">[</span><span class="kt">short</span><span class="o">:</span><span class="n">Type</span><span class="p">]</span><span class="o">:</span> <span class="mh">0x00000004</span>
  <span class="mh">0x02</span> <span class="n">Size</span>              <span class="p">[</span><span class="kt">short</span><span class="o">:</span><span class="n">Size</span><span class="p">]</span><span class="o">:</span> <span class="mh">0x00000150</span>
  <span class="mh">0x08</span> <span class="n">DeviceObject</span>     <span class="o">&lt;</span><span class="n">_DEVICE_OBJECT</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xFA80019FB550</span><span class="p">]</span> <span class="p">(</span><span class="n">DeviceObject</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x10</span> <span class="n">Flags</span>             <span class="p">[</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">:</span><span class="n">Flags</span><span class="p">]</span><span class="o">:</span> <span class="mh">0x00000012</span>
  <span class="mh">0x18</span> <span class="n">DriverStart</span>      <span class="o">&lt;</span><span class="n">Void</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xF88003B45000</span><span class="p">]</span> <span class="p">(</span><span class="n">DriverStart</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x20</span> <span class="n">DriverSize</span>        <span class="p">[</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">:</span><span class="n">DriverSize</span><span class="p">]</span><span class="o">:</span> <span class="mh">0x0000B000</span>
  <span class="mh">0x28</span> <span class="n">DriverSection</span>    <span class="o">&lt;</span><span class="n">Void</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xFA80019FB7C0</span><span class="p">]</span> <span class="p">(</span><span class="n">DriverSection</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x30</span> <span class="n">DriverExtension</span>  <span class="o">&lt;</span><span class="n">_DRIVER_EXTENSION</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xFA80019FBA50</span><span class="p">]</span> <span class="p">(</span><span class="n">DriverExtension</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x38</span> <span class="n">DriverName</span>       <span class="p">[</span><span class="n">_UNICODE_STRING</span> <span class="n">DriverName</span><span class="p">]</span> <span class="p">@</span> <span class="mh">0xFA80019FB938</span> <span class="p">(</span><span class="err">\</span><span class="n">Driver</span><span class="err">\</span><span class="n">rdpbus</span><span class="p">)</span>
  <span class="mh">0x48</span> <span class="n">HardwareDatabase</span> <span class="o">&lt;</span><span class="n">_UNICODE_STRING</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xF80002B59558</span><span class="p">]</span> <span class="p">(</span><span class="n">HardwareDatabase</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x50</span> <span class="n">FastIoDispatch</span>   <span class="o">&lt;</span><span class="n">_FAST_IO_DISPATCH</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span> <span class="p">(</span><span class="n">FastIoDispatch</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x58</span> <span class="n">DriverInit</span>       <span class="o">&lt;</span><span class="n">Function</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xF88003B4D1B0</span><span class="p">]</span> <span class="p">(</span><span class="n">DriverInit</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x60</span> <span class="n">DriverStartIo</span>    <span class="o">&lt;</span><span class="n">Function</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0x00000000</span><span class="p">]</span> <span class="p">(</span><span class="n">DriverStartIo</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x68</span> <span class="n">DriverUnload</span>     <span class="o">&lt;</span><span class="n">Function</span> <span class="n">Pointer</span> <span class="n">to</span> <span class="p">[</span><span class="mh">0xF88003B4B480</span><span class="p">]</span> <span class="p">(</span><span class="n">DriverUnload</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="mh">0x70</span> <span class="n">MajorFunction</span>    <span class="o">&lt;</span><span class="n">IndexedArray</span> <span class="mi">28</span> <span class="n">x</span> <span class="n">Pointer</span> <span class="p">@</span> <span class="mh">0xFA80019FB970</span><span class="o">&gt;</span>
<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mo">01</span><span class="o">:</span><span class="mi">29</span><span class="o">:</span><span class="mo">01</span><span class="o">&gt;</span> <span class="n">print</span> <span class="n">x</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">DriverName</span>
<span class="err">\</span><span class="n">Driver</span><span class="err">\</span><span class="n">rdpbus</span>
</pre></div>


<p>In the next example we search for SymbolicLinks for the pmem device and discover
when the pmem driver was loaded.</p>
<div class="highlight"><pre>win7.elf 01:38:53&gt; object_tree type_regex=&quot;Symbolic&quot;
0xf8a0003a58a0 SymbolicLink         . Root#MS_PPPOEMINIPORT#0000#{cac88484-7515-4c03-82e6-71a87abac361}-&gt; \Device\00000034 (2012-10-01 21:39:55+0000)
0xf8a0003c1030 SymbolicLink         . Root#*ISATAP#0000#{ad498944-762f-11d0-8dcb-00c04fc3358c}-&gt; \Device\00000001 (2012-10-01 21:39:51+0000)
0xf8a00007fda0 SymbolicLink         . WMIAdminDevice-&gt; \Device\WMIAdminDevice (2012-10-01 21:39:45+0000)
0xf8a0056e8dd0 SymbolicLink         . pmem-&gt; \Device\pmem (2012-10-01 14:40:44+0000)
0xf8a0001111c0 SymbolicLink         . Root#MS_NDISWANIP#0000#{cac88484-7515-4c03-82e6-71a87abac361}-&gt; \Device\00000032 (2012-10-01 21:39:55+0000)
0xf8a0003bef20 SymbolicLink         . Root#MS_NDISWANBH#0000#{cac88484-7515-4c03-82e6-71a87abac361}-&gt; \Device\00000031 (2012-10-01 21:39:55+0000)
0xf8a000006f40 SymbolicLink         . Global-&gt; \GLOBAL?? (2012-10-01 21:39:45+0000)
</pre></div>
</div>

<h1 id="object_types" class="anchor">object_types</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.Objects-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Displays all object Types on the system.</h2>
</div>



<p>The windows kernel has the notion of a <strong>Kernel Object</strong>. Objects are managed by
the kernel through a dedicated API. Kernel Objects are typically used to manage
resources which the kernel manages on behalf of user space, for example, open
files are managed via the <strong>_FILE_OBJECT</strong> object.</p>
<p>There is a fixed number of kernel objects, each is described by an
<strong>_OBJECT_TYPE</strong> structure, the address of which can be found at the
<strong>ObpObjectTypes</strong> symbol.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Each time a new object is created by the kernel, the <strong>Number of Objects</strong>
   count increases. For every free&rsquo;s object, this number decreases. The counter
   therefore represents the total number of active instances of this object
   type.</p>
</li>
<li>
<p>The number of kernel objects varies between windows kernel version. In order
   to find the size of the <strong>ObpObjectTypes</strong> array, Rekall uses the reference
   count on the <strong>Type</strong> object type - each kernel object type has a unique
   <strong>_OBJECT_TYPE</strong> structure.</p>
</li>
<li>
<p>The <strong>Number of Objects</strong> count also has forensic significance. For example
   the total number of <strong>Process</strong> objects represents the total number of
   _EPROCESS structures in current use (Note that a process may be terminated
   but the _EPROCESS is still kept in use).</p>
</li>
</ol>
<h3>Sample output</h3>
<p>The below output indicates that there should be 41 processes active, and 548 threads.</p>
<div class="highlight"><pre>win7.elf 01:39:36&gt; object_types
-----------------&gt; object_types()
Index  Number Objects PoolType        Name
----- --------------- --------------- ----
    2              42 NonPagedPool    Type
    3              40 PagedPool       Directory
    4             173 PagedPool       SymbolicLink
    5             704 PagedPool       Token
    6               3 NonPagedPool    Job
    7              41 NonPagedPool    Process
    8             548 NonPagedPool    Thread
    9               0 NonPagedPool    UserApcReserve
   10               1 NonPagedPool    IoCompletionReserve
...
</pre></div>
</div>

<h1 id="pagefiles" class="anchor">pagefiles</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pagefile.Pagefiles-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Report all the active pagefiles.</h2>
</div>




</div>

<h1 id="pas2vas" class="anchor">pas2vas</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pas2kas.WinPas2Vas-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Resolves a physical address to a virtual addrress in a process.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>offsets</p></td><td><p>A list of physical offsets to resolve. (type: ArrayIntParser)</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>In virtual (or protected) mode, the CPU can not access physical memory
directly. Instead each memory access made by the CPU is translated using the MMU
into a relevant physical address. This translation is controlled by page tables
loaded in the memory address controlled by the CR3 register.</p>
<p>Each processes has a unique page table structure, and therefore a unique view of
physical memory. In order to know what physical address is mapped to each
virtual address you can use the <strong>vtop</strong> plugin. However, the reverse mapping is
not so simple - there can be many virtual addresses mapped to the same physical
address.</p>
<p>This plugin enumerates all virtual to physical mappings in one or more
processes. It then builds a large lookup table in memory to be able to reverse
the mapping. i.e. given a physical address, the plugin is able to determine the
virtual address that maps to it, and in which processes it exists.</p>
<p>Forensically this can be used if you find an interesting string in the physical
image (e.g. with a hex editor) and want to know which process has that physical
memory mapped. Another use case is to detect shared memory between multiple
processes.</p>
<h3>Notes</h3>
<ol>
<li>
<p>This plugin only enumerates the userspace portion of the process address
   space (since all processes share the same kernel address space).</p>
</li>
<li>
<p>The plugin may take a while to run while it builds its lookup table. The next
   time you run it it should be very fast. The lookup map is also stored in the
   session cache so you can use the <strong>-s</strong> parameter to store the session for
   next time.</p>
</li>
</ol>
<h3>Sample output</h3>
<p>In the following we see that the process <code>vol.exe</code> is a Wow64 process and maps
<strong>\Windows\SysWOW64\ws2_32.dll</strong>. We want to know who else is using this dll. We
first find the physical address of the mapped dll (note we need to switch to the
correct process context first), then we use the <strong>pas2vas</strong> plugin to determine
which other process has that physical page mapped.</p>
<div class="highlight"><pre><span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mi">12</span><span class="o">:</span><span class="mi">29</span><span class="o">:</span><span class="mi">35</span><span class="o">&gt;</span> <span class="n">pslist</span>
  <span class="n">Offset</span> <span class="p">(</span><span class="n">V</span><span class="p">)</span>   <span class="n">Name</span>                    <span class="n">PID</span>   <span class="n">PPID</span>   <span class="n">Thds</span>     <span class="n">Hnds</span>   <span class="n">Sess</span>  <span class="n">Wow64</span> <span class="n">Start</span>                    <span class="n">Exit</span>
<span class="o">--------------</span> <span class="o">--------------------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">------------------------</span> <span class="o">------------------------</span>
<span class="p">...</span>
<span class="mh">0xfa8002193060</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span>                <span class="mi">2912</span>   <span class="mi">2644</span>      <span class="mi">1</span>       <span class="mi">19</span>      <span class="mi">1</span>   <span class="n">True</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">01</span> <span class="mi">14</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mo">03</span><span class="o">+</span><span class="mo">0000</span> <span class="o">-</span>
<span class="mh">0xfa80017f9060</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span>                <span class="mi">2920</span>   <span class="mi">2912</span>      <span class="mi">4</span>      <span class="mi">169</span>      <span class="mi">1</span>   <span class="n">True</span> <span class="mi">2012</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mo">01</span> <span class="mi">14</span><span class="o">:</span><span class="mi">41</span><span class="o">:</span><span class="mo">03</span><span class="o">+</span><span class="mo">0000</span> <span class="o">-</span>
<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mi">12</span><span class="o">:</span><span class="mi">29</span><span class="o">:</span><span class="mi">59</span><span class="o">&gt;</span> <span class="n">vad</span> <span class="mi">2912</span>
<span class="o">-----------------&gt;</span> <span class="n">vad</span><span class="p">(</span><span class="mi">2912</span><span class="p">)</span>
<span class="o">**************************************************</span>
<span class="nl">Pid</span><span class="p">:</span> <span class="mi">2912</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span>
     <span class="n">VAD</span>       <span class="n">lev</span>     <span class="n">start</span>           <span class="n">end</span>        <span class="n">com</span> <span class="o">-</span>       <span class="o">-</span>      <span class="n">Protect</span>              <span class="n">Filename</span>
<span class="o">--------------</span> <span class="o">---</span> <span class="o">--------------</span> <span class="o">--------------</span> <span class="o">----</span> <span class="o">-------</span> <span class="o">------</span> <span class="o">--------------------</span> <span class="o">--------</span>
<span class="mh">0xfa80026f9d80</span> <span class="mi">1</span>         <span class="mh">0x74400</span>        <span class="mh">0x7443e</span>    <span class="mi">3</span> <span class="n">Mapped</span>  <span class="n">Exe</span>    <span class="n">EXECUTE_WRITECOPY</span>    <span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">System32</span><span class="err">\</span><span class="n">wow64</span><span class="p">.</span><span class="n">dll</span>
<span class="p">...</span>
<span class="mh">0xfa80021da200</span> <span class="mi">3</span>         <span class="mh">0x766c0</span>        <span class="mh">0x766f4</span>    <span class="mi">2</span> <span class="n">Mapped</span>  <span class="n">Exe</span>    <span class="n">EXECUTE_WRITECOPY</span>    <span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">SysWOW64</span><span class="err">\</span><span class="n">ws2_32</span><span class="p">.</span><span class="n">dll</span>
<span class="mh">0xfa80026eb5e0</span> <span class="mi">4</span>         <span class="mh">0x75ef0</span>        <span class="mh">0x75fdf</span>    <span class="mi">2</span> <span class="n">Mapped</span>  <span class="n">Exe</span>    <span class="n">EXECUTE_WRITECOPY</span>    <span class="err">\</span><span class="n">Windows</span><span class="err">\</span><span class="n">SysWOW64</span><span class="err">\</span><span class="n">rpcrt4</span><span class="p">.</span><span class="n">dll</span>
<span class="p">...</span>
<span class="mh">0xfa80028f59d0</span> <span class="mi">5</span>         <span class="mh">0x7fff0</span>     <span class="mh">0x7fffffef</span>   <span class="o">-</span><span class="mi">1</span> <span class="n">Private</span>        <span class="n">READONLY</span>
<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mi">12</span><span class="o">:</span><span class="mi">30</span><span class="o">:</span><span class="mi">08</span><span class="o">&gt;</span> <span class="n">cc</span> <span class="mi">2912</span>
<span class="n">Switching</span> <span class="n">to</span> <span class="n">process</span> <span class="nl">context</span><span class="p">:</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span> <span class="p">(</span><span class="n">Pid</span> <span class="mi">2912</span><span class="mh">@0xfa8002193060</span><span class="p">)</span>

<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mi">12</span><span class="o">:</span><span class="mi">32</span><span class="o">:</span><span class="mi">45</span><span class="o">&gt;</span> <span class="n">vtop</span> <span class="mh">0x766c0000</span>
<span class="o">-----------------&gt;</span> <span class="n">vtop</span><span class="p">(</span><span class="mh">0x766c0000</span><span class="p">)</span>
<span class="n">Virtual</span> <span class="mh">0x766c0000</span> <span class="n">Page</span> <span class="n">Directory</span> <span class="mh">0x271ec000</span>
<span class="n">pml4e</span><span class="p">@</span> <span class="mh">0x271ec000</span> <span class="o">=</span> <span class="mh">0x70000008844867</span>
<span class="n">pdpte</span><span class="p">@</span> <span class="mh">0x8844008</span> <span class="o">=</span> <span class="mh">0x80000007845867</span>
<span class="n">pde</span><span class="p">@</span> <span class="mh">0x7845d98</span> <span class="o">=</span> <span class="mh">0x7b55847</span>
<span class="n">pte</span><span class="p">@</span> <span class="mh">0x7b55600</span> <span class="o">=</span> <span class="mh">0x1a58f005</span>
<span class="n">PTE</span> <span class="n">mapped</span><span class="p">@</span> <span class="mh">0x7b55600</span> <span class="o">=</span> <span class="mh">0x1a58f000</span>
<span class="n">Physical</span> <span class="n">Address</span> <span class="mh">0x1a58f000</span>
<span class="n">win7</span><span class="p">.</span><span class="n">elf</span> <span class="mi">12</span><span class="o">:</span><span class="mi">32</span><span class="o">:</span><span class="mi">53</span><span class="o">&gt;</span> <span class="n">pas2vas</span> <span class="mh">0x1a58f000</span>

   <span class="n">Physical</span>       <span class="n">Virtual</span>        <span class="n">Pid</span> <span class="n">Name</span>
<span class="o">--------------</span> <span class="o">--------------</span> <span class="o">------</span> <span class="o">----</span>
<span class="mh">0x00001a58f000</span> <span class="mh">0x0000766c0000</span>   <span class="mi">2616</span> <span class="n">Console</span><span class="p">.</span><span class="n">exe</span>
<span class="mh">0x00001a58f000</span> <span class="mh">0x0000766c0000</span>   <span class="mi">2920</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span>
<span class="mh">0x00001a58f000</span> <span class="mh">0x0000766c0000</span>   <span class="mi">2912</span> <span class="n">vol</span><span class="p">.</span><span class="n">exe</span>
</pre></div>


<p>We see that <code>Console.exe</code> also maps the same dll - probably since it is also a
Wow64 process which requires network access.</p>
</div>

<h1 id="pedump" class="anchor">pedump</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.procdump.PEDump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump a PE binary from memory.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>address_space</p></td><td><p>The address space to use.</p></td></tr><tr><td><p>image_base</p></td><td><p>The address of the image base (dos header). (type: IntParser)</p>
<ul>
<li>Default: 0</li>
</ul></td></tr><tr><td><p>out_fd</p></td><td><p>A file like object to write the output.</p></td></tr><tr><td><p>out_file</p></td><td><p>The file name to write.</p></td></tr>
</tbody>
</table>
</div>


<p>Windows executable files (PE Files) are mapped into memory from disk. This
plugin can dump arbitrary PE files from memory (whether they are executables,
DLLs, kernel modules etc). All we require is the PE file&rsquo;s mapped base addresses
(i.e. the location in the virtual address space where the MZ header resides.</p>
<p>The image_base offset can be specified using a named address as usual. So for
example, to specify a kernel module it is sufficient to just name it
(e.g. pedump &ldquo;nt&rdquo; - will dump the kernel image).</p>
<p>This plugin is used by the <strong>dlldump</strong>, <strong>moddump</strong>, <strong>procdump</strong> etc plugins.</p>
<h3>Note</h3>
<ol>
<li>
<p>In order to dump any PE file from memory we need the PE header to be memory
   resident. Often this is not the case, and the header is flushed out of
   virtual memory. In this case it is still possible to dump parts of the PE
   image using the <a href="VADDump.html">vaddump</a> plugin.</p>
</li>
<li>
<p>When dumping any binary from memory, it is not usually a perfect binary
   (i.e. you can not just run it). This is because the Import Address Table
   (IAT) reflects the patched version in memory and some pages may be
   missing. The resultant binary is probably only useful to analyses using a
   tool like IDA pro.</p>
</li>
</ol>
</div>

<h1 id="peinfo" class="anchor">peinfo</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.procinfo.PEInfo-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print information about a PE binary.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>address-space</p></td><td><p>The address space to use.</p></td></tr><tr><td><p>executable</p></td><td><p>If provided we create an address space from this file.</p></td></tr><tr><td><p>image-base</p></td><td><p>The base of the image. (type: SymbolAddress)</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The <strong>peinfo</strong> plugin examines a PE file mapped into memory and displays a rich
variety of information about it:</p>
<ul>
<li>Metadata about the file (architecture, build date etc)</li>
<li>The PDB guid for the file.</li>
<li>The list of sections and where they are mapped into the virtual address space</li>
<li>The import directory.</li>
<li>The export directory.</li>
<li>A version resource strings that might exist in the executable.</li>
</ul>
<h3>Notes</h3>
<ol>
<li>
<p>This plugin depends on having a valid mapped PE header into memory. Sometimes
   this is not the case, since under memory pressure the kernel will unmapped
   the PE headers (since they are not needed after loading).</p>
</li>
<li>
<p>This plugin also works on disk files (PE executable). Simply pass a filename
   parameter to have it print information about external files.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 15:11:02&gt; peinfo &quot;nt&quot;
-------------------&gt; peinfo(&quot;nt&quot;)
Attribute            Value
-------------------- -----
Machine              IMAGE_FILE_MACHINE_AMD64
TimeDateStamp        2013-09-14 08:23:16+0000
Characteristics      IMAGE_FILE_EXECUTABLE_IMAGE, IMAGE_FILE_LARGE_ADDRESS_AWARE
GUID/Age             FD3D00D28EDC4527BB922BCC0509D2851
PDB                  ntkrnlmp.pdb
MajorOperatingSystemVersion 6
MinorOperatingSystemVersion 3
MajorImageVersion    6
MinorImageVersion    3
MajorSubsystemVersion 6
MinorSubsystemVersion 3

Sections (Relative to 0xF802D3019000):
Perm Name          VMA            Size
---- -------- -------------- --------------
xr-  .text    0x000000001000 0x00000028d600
xr-  NONPAGED 0x00000028f000 0x000000000200
xr-  POOLCODE 0x000000290000 0x000000002800
-rw  .data    0x000000293000 0x00000000be00
-r-  .reloc   0x000000778000 0x000000008e00
...

Data Directories:
-                                             VMA            Size
---------------------------------------- -------------- --------------
IMAGE_DIRECTORY_ENTRY_EXPORT             0xf802d36ab000 0x0000000135ff
IMAGE_DIRECTORY_ENTRY_IMPORT             0xf802d335b728 0x00000000012c
IMAGE_DIRECTORY_ENTRY_RESOURCE           0xf802d375f000 0x000000031d20
IMAGE_DIRECTORY_ENTRY_EXCEPTION          0xf802d331c000 0x00000003ed6c
IMAGE_DIRECTORY_ENTRY_SECURITY           0xf802d3725e00 0x000000002158
IMAGE_DIRECTORY_ENTRY_BASERELOC          0xf802d3791000 0x000000003cd4
IMAGE_DIRECTORY_ENTRY_DEBUG              0xf802d301a100 0x000000000038
IMAGE_DIRECTORY_ENTRY_COPYRIGHT          0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_GLOBALPTR          0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_TLS                0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG        0xf802d3033f20 0x000000000094
IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT       0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_IAT                0xf802d335b000 0x000000000728
IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT       0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR     0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_RESERVED           0x000000000000 0x000000000000

Import Directory (Original):
Name                                               Ord
-------------------------------------------------- -----
ext-ms-win-ntos-werkernel-l1-1-0.dll!WerLiveKernelCloseHandle 1
ext-ms-win-ntos-werkernel-l1-1-0.dll!WerLiveKernelOpenDumpFile 4
ext-ms-win-ntos-werkernel-l1-1-0.dll!WerLiveKernelCancelReport 0
ext-ms-win-ntos-werkernel-l1-1-0.dll!WerLiveKernelInitSystem 3
...
msrpc.sys!MesDecodeBufferHandleCreate              11
msrpc.sys!NdrMesTypeDecode3                        45

Export Directory:
    Entry      Stat Ord   Name
-------------- ---- ----- --------------------------------------------------
0xf802d30ed1f4 M    3     ntoskrnl.exe!AlpcGetHeaderSize (nt!AlpcGetHeaderSize)
0xf802d30ed080 M    4     ntoskrnl.exe!AlpcGetMessageAttribute (nt!AlpcGetMessageAttribute)
0xf802d30ed19c M    5     ntoskrnl.exe!AlpcInitializeMessageAttribute (nt!AlpcInitializeMessageAttribute)
0xf802d36a4004 -    6     ntoskrnl.exe!BgkDisplayCharacter (nt!BgkDisplayCharacter)
0xf802d36a40b8 -    7     ntoskrnl.exe!BgkGetConsoleState (nt!BgkGetConsoleState)
0xf802d36a40e0 -    8     ntoskrnl.exe!BgkGetCursorState (nt!BgkGetCursorState)
0xf802d36a4108 -    9     ntoskrnl.exe!BgkSetCursor (nt!BgkSetCursor)
0xf802d31d23c8 M    10    ntoskrnl.exe!CcAddDirtyPagesToExternalCache (nt!CcAddDirtyPagesToExternalCache)
0xf802d3106888 M    11    ntoskrnl.exe!CcCanIWrite (nt!CcCanIWrite)
...
</pre></div>
</div>

<h1 id="pfn" class="anchor">pfn</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pfn.PFNInfo-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Prints information about an address from the PFN database.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>pfn</p></td><td><p>The PFN to examine. (type: IntParser)</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="phys_map" class="anchor">phys_map</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.WinPhysicalMap-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Prints the boot physical memory map.</h2>
</div>



<p>This plugin will simply print the kernels idea of the physical memory layout on
a machine. Typically the physical address space is not contiguous (i.e. does not
have RAM chip mapping all address ranges between 0 and the maximum number). This
is because the BIOS needs to leave gaps for DMA devices to be mapped.</p>
<p>The BIOS sets up an initial mapping and communicates the mapping to the kernel
through a BIOS service call (Or EFI call) which can be done while the kernel
still boots (In real mode). The kernel then keeps this information and returns
it through the <strong>MmGetPhysicalMemoryRanges()</strong> function.</p>
<h3>Notes</h3>
<ol>
<li>It is rather easy to manupulate this information to subvert acquisition. Most
   acquisition tools use this information to determine where it is safe to read
   and to avoid reading from DMA mapped memory.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 15:19:26&gt; phys_map
-------------------&gt; phys_map()
  Phys Start      Phys End    Number of Pages
-------------- -------------- ---------------
0x000000001000 0x00000009f000 158
0x000000100000 0x000000102000 2
0x000000103000 0x00003fff0000 261869
</pre></div>
</div>

<h1 id="pool_tracker" class="anchor">pool_tracker</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.PoolTracker-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate pool tag usage statistics.</h2>
</div>



<p>The Windows kernel allocates memory from a shared pool. In order to track memory
leaks and to aid in debugging, pool allocations typically have fixed tags
indicating the component which allocated the memory. For example, in windows 8,
allocating an _EPROCESS struct will result in a pool allocation with a tag of
<code>Proc</code>.</p>
<p>To aid in debugging, Windows tracks pool allocation in a special table found by
the symbol <strong>PoolTrackTable</strong>. This table can show the total number of
allocation and deallocations associated with a particular pool tag.</p>
<p>From a forensic point of view, this information can be useful to assess the
number of outstanding allocations. For example we can see how many live
processes we expect to be preset.</p>
<h3>Notes</h3>
<ol>
<li>Just because the process is terminated does not mean the _EPROCESS structure
   is immediately deallocated. Windows might keep these structures alive for
   some time for various reasons. A discrepancy here is at best a hint that
   something does&rsquo;nt add up.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 15:29:07&gt; pool_tracker
Tag              NP Alloc   NP Bytes              P Alloc    P Bytes
---- -------------------- ---------- -------------------- ----------
 DMV                1 (0)          0                0 (0)          0
8042                6 (4)       4048               12 (0)          0
ACPI                4 (0)          0                0 (0)          0
AFGp                1 (0)          0                0 (0)          0
ALPC           3211 (770)     434240                0 (0)          0
ARFT                0 (0)          0              151 (3)        192
AcpA                2 (2)        160                0 (0)          0
AcpB                0 (0)          0              121 (0)          0
...
Pprl                0 (0)          0                3 (0)          0
Ppsu                0 (0)          0           1394 (223)      18512
Prcr                5 (4)       5440               13 (0)          0
Proc             137 (48)      91328                0 (0)          0
PsFn              136 (0)          0                0 (0)          0
...

win8.1.raw 15:36:40&gt; pslist
-------------------&gt; pslist()
  Offset (V)   Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                    Exit
-------------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------ ------------------------
DEBUG:root:Listed 48 processes using PsActiveProcessHead
DEBUG:root:Listed 43 processes using CSRSS
DEBUG:root:Listed 47 processes using PspCidTable
DEBUG:root:Listed 45 processes using Sessions
DEBUG:root:Listed 45 processes using Handles
...
</pre></div>


<p>In the above example we see that there are 48 outstanding <em>_EPROCESS</em> objects
and there are 48 members in the <strong>PsActiveProcessHead</strong> list.</p>
</div>

<h1 id="pools" class="anchor">pools</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.Pools-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Prints information about system pools.</h2>
<p>Ref:
http://illmatics.com/Windows%208%20Heap%20Internals.pdf
https://media.blackhat.com/bh-dc-11/Mandt/BlackHat_DC_2011_Mandt_kernelpool-wp.pdf
https://immunityinc.com/infiltrate/archives/kernelpool_infiltrate2011.pdf
http://gate.upm.ro/os/LABs/Windows_OS_Internals_Curriculum_Resource_Kit-ACADEMIC/WindowsResearchKernel-WRK/WRK-v1.2/base/ntos/ex/pool.c</p>
</div>




</div>

<h1 id="procdump" class="anchor">procdump</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.procdump.ProcExeDump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump a process to an executable file sample</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>out_fd</p></td><td><p>A file like object to write the output.</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>This plugin dumps the mapped PE files associated with a windows process. It is
equivalent to calling <strong>pedump</strong> with an image base corresponding to the VAD
section of the main process executable.</p>
<p>The <strong>procdump</strong> plugin is a thin wrapper around the <strong>pedump</strong> plugin.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win7.elf 14:42:55&gt; procdump proc_regex=&quot;csrss&quot;, dump_dir=&quot;/tmp/&quot;
**************************************************
Dumping csrss.exe, pid: 348    output: executable.csrss_exe_348.exe
**************************************************
Dumping csrss.exe, pid: 396    output: executable.csrss_exe_396.exe
</pre></div>
</div>

<h1 id="procinfo" class="anchor">procinfo</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.procinfo.ProcInfo-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump detailed information about a running process.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>The <strong>procinfo</strong> plugin displays basic information about a process. It takes all
the usual process selectors (e.g. pid, name etc) and prints information about
the PE file (using <strong>peinfo</strong>) as well as the process environment strings.</p>
<h3>Sample output</h3>
<div class="highlight"><pre><span class="nt">win7</span><span class="nc">.elf</span> <span class="nt">14</span><span class="nd">:43:15</span><span class="o">&gt;</span> <span class="nt">procinfo</span> <span class="nt">proc_regex</span><span class="o">=</span><span class="s2">&quot;csrss&quot;</span>
<span class="o">**************************************************</span>
<span class="nt">Pid</span><span class="o">:</span> <span class="nt">348</span> <span class="nt">csrss</span><span class="nc">.exe</span>

<span class="nt">Process</span> <span class="nt">Environment</span>
   <span class="nt">ComSpec</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">system32</span><span class="err">\</span><span class="nt">cmd</span><span class="nc">.exe</span>
   <span class="nt">FP_NO_HOST_CHECK</span><span class="o">=</span><span class="nt">NO</span>
   <span class="nt">NUMBER_OF_PROCESSORS</span><span class="o">=</span><span class="nt">1</span>
   <span class="nt">OS</span><span class="o">=</span><span class="nt">Windows_NT</span>
   <span class="nt">Path</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">system32</span><span class="o">;</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="o">;</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">System32</span><span class="err">\</span><span class="nt">Wbem</span><span class="o">;</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">System32</span><span class="err">\</span><span class="nt">WindowsPowerShell</span><span class="err">\</span><span class="nt">v1</span><span class="nc">.0</span><span class="err">\</span>
   <span class="nt">PATHEXT</span><span class="o">=</span><span class="nc">.COM</span><span class="o">;</span><span class="nc">.EXE</span><span class="o">;</span><span class="nc">.BAT</span><span class="o">;</span><span class="nc">.CMD</span><span class="o">;</span><span class="nc">.VBS</span><span class="o">;</span><span class="nc">.VBE</span><span class="o">;</span><span class="nc">.JS</span><span class="o">;</span><span class="nc">.JSE</span><span class="o">;</span><span class="nc">.WSF</span><span class="o">;</span><span class="nc">.WSH</span><span class="o">;</span><span class="nc">.MSC</span>
   <span class="nt">PROCESSOR_ARCHITECTURE</span><span class="o">=</span><span class="nt">AMD64</span>
   <span class="nt">PROCESSOR_IDENTIFIER</span><span class="o">=</span><span class="nt">Intel64</span> <span class="nt">Family</span> <span class="nt">6</span> <span class="nt">Model</span> <span class="nt">37</span> <span class="nt">Stepping</span> <span class="nt">2</span><span class="o">,</span> <span class="nt">GenuineIntel</span>
   <span class="nt">PROCESSOR_LEVEL</span><span class="o">=</span><span class="nt">6</span>
   <span class="nt">PROCESSOR_REVISION</span><span class="o">=</span><span class="nt">2502</span>
   <span class="nt">PSModulePath</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">system32</span><span class="err">\</span><span class="nt">WindowsPowerShell</span><span class="err">\</span><span class="nt">v1</span><span class="nc">.0</span><span class="err">\</span><span class="nt">Modules</span><span class="err">\</span>
   <span class="nt">SystemDrive</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span>
   <span class="nt">SystemRoot</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span>
   <span class="nt">TEMP</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">TEMP</span>
   <span class="nt">TMP</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span><span class="err">\</span><span class="nt">TEMP</span>
   <span class="nt">USERNAME</span><span class="o">=</span><span class="nt">SYSTEM</span>
   <span class="nt">windir</span><span class="o">=</span><span class="nt">C</span><span class="o">:</span><span class="err">\</span><span class="nt">Windows</span>

<span class="nt">PE</span> <span class="nt">Infomation</span>
<span class="nt">Attribute</span>            <span class="nt">Value</span>
<span class="nt">--------------------</span> <span class="nt">-----</span>
<span class="nt">Machine</span>              <span class="nt">IMAGE_FILE_MACHINE_AMD64</span>
<span class="nt">TimeDateStamp</span>        <span class="nt">2009-07-13</span> <span class="nt">23</span><span class="nd">:19:49</span><span class="o">+</span><span class="nt">0000</span>
<span class="nt">Characteristics</span>      <span class="nt">IMAGE_FILE_EXECUTABLE_IMAGE</span><span class="o">,</span> <span class="nt">IMAGE_FILE_LARGE_ADDRESS_AWARE</span>
<span class="nt">GUID</span><span class="o">/</span><span class="nt">Age</span>             <span class="nt">E8979C26A0EE47A69575E54FA6C7F6BE1</span>
<span class="nt">PDB</span>                  <span class="nt">csrss</span><span class="nc">.pdb</span>
<span class="nt">MajorOperatingSystemVersion</span> <span class="nt">6</span>
<span class="nt">MinorOperatingSystemVersion</span> <span class="nt">1</span>
<span class="nt">MajorImageVersion</span>    <span class="nt">6</span>
<span class="nt">MinorImageVersion</span>    <span class="nt">1</span>
<span class="nt">MajorSubsystemVersion</span> <span class="nt">6</span>
<span class="nt">MinorSubsystemVersion</span> <span class="nt">1</span>

<span class="nt">Sections</span> <span class="o">(</span><span class="nt">Relative</span> <span class="nt">to</span> <span class="nt">0x497B0000</span><span class="o">):</span>
<span class="nt">Perm</span> <span class="nt">Name</span>          <span class="nt">VMA</span>            <span class="nt">Size</span>
<span class="nt">----</span> <span class="nt">--------</span> <span class="nt">--------------</span> <span class="nt">--------------</span>
<span class="nt">xr-</span>  <span class="nc">.text</span>    <span class="nt">0x000000001000</span> <span class="nt">0x000000000c00</span>
<span class="nt">-rw</span>  <span class="nc">.data</span>    <span class="nt">0x000000002000</span> <span class="nt">0x000000000200</span>
<span class="nt">-r-</span>  <span class="nc">.pdata</span>   <span class="nt">0x000000003000</span> <span class="nt">0x000000000200</span>
<span class="nt">-r-</span>  <span class="nc">.rsrc</span>    <span class="nt">0x000000004000</span> <span class="nt">0x000000000800</span>
<span class="nt">-r-</span>  <span class="nc">.reloc</span>   <span class="nt">0x000000005000</span> <span class="nt">0x000000000200</span>

<span class="nt">Data</span> <span class="nt">Directories</span><span class="o">:</span>
<span class="nt">-</span>                                             <span class="nt">VMA</span>            <span class="nt">Size</span>
<span class="nt">----------------------------------------</span> <span class="nt">--------------</span> <span class="nt">--------------</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_EXPORT</span>             <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_IMPORT</span>             <span class="nt">0x0000497b17c4</span> <span class="nt">0x00000000003c</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_RESOURCE</span>           <span class="nt">0x0000497b4000</span> <span class="nt">0x0000000007f8</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_EXCEPTION</span>          <span class="nt">0x0000497b3000</span> <span class="nt">0x00000000003c</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_SECURITY</span>           <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_BASERELOC</span>          <span class="nt">0x0000497b5000</span> <span class="nt">0x00000000000c</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_DEBUG</span>              <span class="nt">0x0000497b10a0</span> <span class="nt">0x00000000001c</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_COPYRIGHT</span>          <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_GLOBALPTR</span>          <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_TLS</span>                <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG</span>        <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT</span>       <span class="nt">0x0000497b02b0</span> <span class="nt">0x000000000030</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_IAT</span>                <span class="nt">0x0000497b1000</span> <span class="nt">0x000000000098</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT</span>       <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR</span>     <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>
<span class="nt">IMAGE_DIRECTORY_ENTRY_RESERVED</span>           <span class="nt">0x000000000000</span> <span class="nt">0x000000000000</span>

<span class="nt">Import</span> <span class="nt">Directory</span> <span class="o">(</span><span class="nt">Original</span><span class="o">):</span>
<span class="nt">Name</span>                                               <span class="nt">Ord</span>
<span class="nt">--------------------------------------------------</span> <span class="nt">-----</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">NtSetInformationProcess</span>                  <span class="nt">498</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlSetHeapInformation</span>                    <span class="nt">1158</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlSetUnhandledExceptionFilter</span>           <span class="nt">1179</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">NtTerminateProcess</span>                       <span class="nt">535</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlVirtualUnwind</span>                         <span class="nt">1264</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlLookupFunctionEntry</span>                   <span class="nt">1025</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlCaptureContext</span>                        <span class="nt">635</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">NtTerminateThread</span>                        <span class="nt">536</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlUnhandledExceptionFilter</span>              <span class="nt">1219</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlSetProcessIsCritical</span>                  <span class="nt">1166</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">isspace</span>                                  <span class="nt">1900</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlUnicodeStringToAnsiString</span>             <span class="nt">1222</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlAllocateHeap</span>                          <span class="nt">613</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlFreeAnsiString</span>                        <span class="nt">840</span>
<span class="nt">ntdll</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">RtlNormalizeProcessParams</span>                <span class="nt">1041</span>
<span class="nt">CSRSRV</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">CsrServerInitialization</span>                 <span class="nt">22</span>
<span class="nt">CSRSRV</span><span class="nc">.dll</span><span class="o">!</span><span class="nt">CsrUnhandledExceptionFilter</span>             <span class="nt">26</span>

<span class="nt">Export</span> <span class="nt">Directory</span><span class="o">:</span>
    <span class="nt">Entry</span>      <span class="nt">Stat</span> <span class="nt">Ord</span>   <span class="nt">Name</span>
<span class="nt">--------------</span> <span class="nt">----</span> <span class="nt">-----</span> <span class="nt">--------------------------------------------------</span>
<span class="nt">Version</span> <span class="nt">Information</span><span class="o">:</span>
<span class="nt">key</span>                  <span class="nt">value</span>
<span class="nt">--------------------</span> <span class="nt">-----</span>
<span class="nt">CompanyName</span>          <span class="nt">Microsoft</span> <span class="nt">Corporation</span>
<span class="nt">FileDescription</span>      <span class="nt">Client</span> <span class="nt">Server</span> <span class="nt">Runtime</span> <span class="nt">Process</span>
<span class="nt">FileVersion</span>          <span class="nt">6</span><span class="nc">.1.7600.16385</span> <span class="o">(</span><span class="nt">win7_rtm</span><span class="nc">.090713-1255</span><span class="o">)</span>
<span class="nt">InternalName</span>         <span class="nt">CSRSS</span><span class="nc">.Exe</span>
<span class="nt">LegalCopyright</span>       <span class="nt">Microsoft</span> <span class="nt">Corporation</span><span class="o">.</span> <span class="nt">All</span> <span class="nt">rights</span> <span class="nt">reserved</span><span class="o">.</span>
<span class="nt">OriginalFilename</span>     <span class="nt">CSRSS</span><span class="nc">.Exe</span>
<span class="nt">ProductName</span>          <span class="nt">Microsoft</span> <span class="nt">Windows</span> <span class="nt">Operating</span> <span class="nt">System</span>
<span class="nt">ProductVersion</span>       <span class="nt">6</span><span class="nc">.1.7600.16385</span>
</pre></div>
</div>

<h1 id="pslist" class="anchor">pslist</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.taskmods.WinPsList-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>List processes for windows.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>The <strong>pslist</strong> plugin list all the processes on windows using a variety of
methods. Since it is required by all plugins which has process selectors, this
plugin will, by default, list processes using all methods.</p>
<p>The output of this plugin is typically cached in the session, so the first time
it is run there might be a slight delay while all methods are used, but
subsequent invokations should be almost instant.</p>
<p>Currently the following process listing methods are used:</p>
<ul>
<li>
<p>PsActiveProcessHead: This method follows the doubly linked list found by the
  symbol <strong>PsActiveProcessHead</strong>. It is the simplest and fastest method for
  listing processes, but it is easily subverted by simply removing an _EPROCESS
  struct from this list.</p>
</li>
<li>
<p>CSRSS: The client-server runtime service is responsible for monitoring all
  running processes. It therefore maintains open handles to running
  processes. This method locates the <code>csrss.exe</code> process and enumerates its
  handle table finding all handles to processes. Note that this will not
  typically find the csrss.exe proces itself, nor system processes which were
  started before it.</p>
</li>
<li>
<p>PspCidTable: The PspCidTable is a handle table for process and thread client
  IDs <a href="http://uninformed.org/index.cgi?v=3&amp;a=7&amp;p=6">Ref</a>. The process&rsquo;s pid is
  the index into this table. This method enumerates the table in order to find
  all processes. (Note a rootkit can easily remove a process from this table).</p>
</li>
<li>
<p>Sessions: This enumerates all the processes in all windows sessions
  (<strong>SessionProcessLinks</strong> member of <strong>_MM_SESSION_SPACE</strong> struct).</p>
</li>
<li>
<p>Handles: The enumerates all handle tables (Which are found on a list from the
  symbol <strong>HandleTableListHead</strong>) and collects their owning process (The
  <strong>QuotaProcess</strong> member).</p>
</li>
</ul>
<h3>Sample output</h3>
<div class="highlight"><pre>  Offset (V)   Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                    Exit
-------------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------ ------------------------
DEBUG:root:Listed 48 processes using PsActiveProcessHead
DEBUG:root:Listed 43 processes using CSRSS
DEBUG:root:Listed 47 processes using PspCidTable
DEBUG:root:Listed 45 processes using Sessions
DEBUG:root:Listed 45 processes using Handles
0xe00000074580 System                    4      0     97 -------- ------  False 2014-01-24 22:07:24+0000 -
0xe00001499040 smss.exe                292      4      2 -------- ------  False 2014-01-24 22:07:24+0000 -
0xe0000212c900 svchost.exe             372    528     15 --------      0  False 2014-01-24 21:07:51+0000 -
0xe00001be1280 csrss.exe               380    372      8 --------      0  False 2014-01-24 22:07:32+0000 -
0xe000000ce080 wininit.exe             432    372      1 --------      0  False 2014-01-24 22:07:32+0000 -
0xe000000d9280 csrss.exe               440    424      9 --------      1  False 2014-01-24 22:07:32+0000 -
</pre></div>
</div>

<h1 id="psscan" class="anchor">psscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.filescan.PSScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan Physical memory for _EPROCESS pool allocations.</h2>
<p>Status flags:
  E: A known _EPROCESS address from pslist.
  P: A known pid from pslist.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>Pool scanning is a technique for discovering kernel data structures based on
signatures. It is essentially the memory forensic equivalent of carving. The
<strong>psscan</strong> plugin carves for <strong>_EPROCESS</strong> structures in memory.</p>
<p>By default the plugin scans in the physical address space. Any hits are resolved
into the virtual address space by following the lists. If <strong>scan_in_kernel</strong> is
specified, the scanning occurs in kernel space.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_EPROCESS</strong> structures out of memory. On the
   other hand, this plugin may reveal files which have been closed or freed.</p>
</li>
<li>
<p>The plugin displays the physical address of the <strong>_EPROCESS</strong> found. It
   may be possible to derive their virtual address using the <a href="PtoV.html">ptov</a>
   plugin. Alternatively, specify the <em>scan_in_kernel</em> option, to ensure
   scanning occurs in the kernel address space.</p>
</li>
</ol>
</div>

<h1 id="pstree" class="anchor">pstree</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pstree.PSTree-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print process list as a tree</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>This plugin displays all known processes in a tree form (i.e. the process
parents with their children). This is useful to see which process launched
another process.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Sometimes malware will launch a processes called &ldquo;lsass.exe&rdquo; or
   &ldquo;csrss.exe&rdquo;. This plugin helps to highlight discrepencies since these
   processes are normally only launched from known processes.</p>
</li>
<li>
<p>Using the <strong>verbose=1</strong> flag will also print the command lines of each
   process as determined by three methods:</p>
</li>
</ol>
<ul>
<li>cmd: **task.Peb.ProcessParameters.CommandLine</li>
<li>path: **task.Peb.ProcessParameters.ImagePathName</li>
<li>audit: <strong>task.SeAuditProcessCreationInfo.ImageFileName.Name</strong></li>
</ul>
<h3>Sample output</h3>
<div class="highlight"><pre>win7.elf 14:55:19&gt; pstree verbose=1
Name                                        Pid   PPid   Thds   Hnds Time
---------------------------------------- ------ ------ ------ ------ ------------------------
 0xFA8002259060:csrss.exe                   348    340      9    436 2012-10-01 21:39:57+0000
    cmd: %SystemRoot%\system32\csrss.exe ObjectDirectory=\Windows SharedSection=1024,20480,768 Windows=On SubSystemType=Windows ServerDll=basesrv,1 ServerDll=winsrv:UserServerDllInitialization,3 ServerDll=winsrv:ConServerDllInitialization,2 ServerDll=sxssrv,4 ProfileControl=Off MaxRequestThreads=16
    path: C:\Windows\system32\csrss.exe
    audit: \Device\HarddiskVolume2\Windows\System32\csrss.exe
 0xFA8000901060:wininit.exe                 384    340      3     75 2012-10-01 21:39:57+0000
    cmd: wininit.exe
    path: C:\Windows\system32\wininit.exe
    audit: \Device\HarddiskVolume2\Windows\System32\wininit.exe
. 0xFA800206D5F0:services.exe               480    384     11    208 2012-10-01 21:39:58+0000
     cmd: C:\Windows\system32\services.exe
     path: C:\Windows\system32\services.exe
     audit: \Device\HarddiskVolume2\Windows\System32\services.exe
.. 0xFA80024F85D0:svchost.exe               236    480     19    455 2012-10-01 14:40:01+0000
      cmd: C:\Windows\system32\svchost.exe -k LocalService
      path: C:\Windows\system32\svchost.exe
      audit: \Device\HarddiskVolume2\Windows\System32\svchost.exe
</pre></div>
</div>

<h1 id="psxview" class="anchor">psxview</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.psxview.WindowsPsxView-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Find hidden processes with various process listings</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
<li>PSScan</li>
<li>Thrdproc</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles, PSScan, Thrdproc</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="ptov" class="anchor">ptov</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pfn.PtoV-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Converts a physical address to a virtual address.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>physical_address</p></td><td><p>The Virtual Address to examine. (type: IntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>This plugin uses the <strong>PFN Database</strong> to convert a physical page to its virtual
address. It is similar to the <strong>pas2vas</strong> plugin in this regard, but does not
need to enumerate all address spaces prior to running (so it is a bit faster).</p>
<h3>Notes</h3>
<ol>
<li>
<p>The plugin currently only works for kernel addresses and for 4k pages. So for
   example this will not work reliably for pool memory (since Pool is allocated
   in 2mb pages).</p>
</li>
<li>
<p>If this plugin does not work for a certain address, try to use the
   <strong>pas2vas</strong> plugin.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win7.elf 15:22:57&gt; vtop 0xfa8002635810
-----------------&gt; vtop(0xfa8002635810)
Virtual 0xfa8002635810 Page Directory 0x271ec000
pml4e@ 0x271ecfa8 = 0x4000863
pdpte@ 0x4000000 = 0x4001863
pde@ 0x4001098 = 0x2ac009e3
Large page mapped 0x2ae35810
Physical Address 0x2ac35810
win7.elf 15:23:05&gt; ptov 0x2ac35810
-----------------&gt; ptov(0x2ac35810)
Physical Address 0x2ac35810 =&gt; Virtual Address 0xf6fd40035810
DTB @ 0x187000
PML4E @ 0x187f68
PDPTE @ 0x187fa8
PDE @ 0x4000000
PTE @ 0x40011a8
</pre></div>
</div>

<h1 id="raw2dmp" class="anchor">raw2dmp</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.crashinfo.Raw2Dump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Convert the physical address space to a crash dump.</h2>
<p>The Windows debugger (Windbg) works only with memory dumps stored
in the proprietary &lsquo;crashdump&rsquo; file format. This file format
contains the following features:</p>
<p>1) Physical memory ranges are stored in a sparse way - there is a
   &lsquo;Runs&rsquo; table which specifies the mapping between the physical
   offset and the file offset of each page. This allows the format
   to omit unmapped regions (unlike raw format which must pad them
   with zero to maintain alignment).</p>
<p>2) The crash dump header contains metadata about the
   image. Specifically, the header contain a copy of the Kernel
   Debugger Data Block (AKA the KDBG). This data is used to
   bootstrap the windows debugger by providing critical initial
   hints to the debugger.</p>
<p>Since the KDBG block is created at system boot and never used
(until the crash dump is written) it is trivial for malware to
overwrite it - making it really hard for responders since windbg
will not be able to read the file. In later versions of windows,
the kdbg is also obfuscated (See the function &ldquo;nt!KdCopyDataBlock&rdquo;
which decrypts it.).</p>
<p>Rekall itself does not use the KDBG block any more, although older
memory forensic tools still do use it. Rekall instead relies on
accurate debugging symbols to locate critical kernel data
structures, reducing the level of trust we place on the image
itself (so Rekall is more resilient to manipulation).</p>
<p>In order to ensure that the windows debugger is able to read the
produced crash dump, we recreate the kernel debugger block from
the symbol information we already have.</p>
<p>NOTE: The crashdump file format can be deduced by:</p>
<p>dis &lsquo;nt!IoFillDumpHeader&rsquo;</p>
<p>This is the reference for this plugin.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>destination</p></td><td><p>The destination path to write the crash dump.</p></td></tr><tr><td><p>rebuild</p></td><td><p>Rebuild the KDBG data block. (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>The Windows debugger (Windbg) works only with memory dumps stored
in the proprietary &lsquo;crashdump&rsquo; file format. This file format
contains the following features:</p>
<ol>
<li>
<p>Physical memory ranges are stored in a sparse way - there is a
   <code>Runs</code> table which specifies the mapping between the physical
   offset and the file offset of each page. This allows the format
   to omit unmapped regions (unlike raw format which must pad them
   with zero to maintain alignment).</p>
</li>
<li>
<p>The crash dump header contains metadata about the
   image. Specifically, the header contain a copy of the Kernel
   Debugger Data Block (AKA the <strong>KDBG</strong>). This data is used to
   bootstrap the windows debugger by providing critical initial
   hints to the debugger.</p>
</li>
</ol>
<p>Since the <strong>KDBG</strong> block is created at system boot and never used (until the
crash dump is written) it is trivial for malware to overwrite it - making it
really hard for responders since windbg will not be able to read the file. In
later versions of windows, the kdbg is also obfuscated (See the function
<code>nt!KdCopyDataBlock</code> which decrypts it.).</p>
<p>Rekall itself does not use the <strong>KDBG</strong> block any more, although older memory
forensic tools still do use it. Rekall instead relies on accurate debugging
symbols to locate critical kernel data structures, reducing the level of trust
we place on the image itself (so Rekall is more resilient to manipulation).</p>
<p>In order to ensure that the windows debugger is able to read the produced crash
dump, we recreate the kernel debugger block from the symbol information we
already have.</p>
<h3>Notes:</h3>
<ol>
<li>
<p>The crashdump file format can be deduced by:
   <code>dis 'nt!IoFillDumpHeader'</code>
   This is the reference for this plugin.</p>
</li>
<li>
<p>This plugin is really only useful in order to produce an image compatible
   with the windows debugger for the purpose of further investigation by the
   debugger. If you find that the windows debugger has a useful feature that
   Rekall does not have, please let up know so we can implement it in Rekall. We
   intend to replace the use of the windows debugger in digital forensics.</p>
</li>
</ol>
</div>

<h1 id="services" class="anchor">services</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.registry.printkey.Services-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate all services.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>hive-offsets</p></td><td><p>A list of hive offsets as found by hivelist. If not provided we call hivelist ourselves and list the keys on all hives. (type: ArrayIntParser)</p></td></tr><tr><td><p>hive_regex</p></td><td><p>A regex to filter hive names.If not provided we use all hives.</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="sockets" class="anchor">sockets</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.connections.Sockets-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print list of open sockets. [Windows xp only]</h2>
<hr />
<p>This module enumerates the active sockets from tcpip.sys</p>
<p>Note that if you are using a hibernated image this might not work
because Windows closes all sockets before hibernating.</p>
<p>_ADDRESS_OBJECT are arranged in a hash table found by the _AddrObjTable
symbol. The hash table has a size found by the _AddrObjTableSize symbol.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>tcpip_guid</p></td><td><p>Force this profile to be used for tcpip.</p></td></tr>
</tbody>
</table>
</div>


<p>This module enumerates the active sockets from tcpip.sys</p>
<p>Note that if you are using a hibernated image this might not work
  because Windows closes all sockets before hibernating.</p>
<p>_ADDRESS_OBJECT are arranged in a hash table found by the _AddrObjTable
  symbol. The hash table has a size found by the _AddrObjTableSize symbol.</p>
<p>epydoc: rekall.plugins.windows.connections.Sockets-class.html
args:
  tcpip_guid: &lsquo;Force this profile to be used for tcpip.&rsquo;</p>
<hr />
</div>

<h1 id="ssdt" class="anchor">ssdt</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.ssdt.WinSSDT-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate the SSDT.</h2>
</div>



<p>The System Service Descritor Table is the main interface to the kernel from user
space. In the past, malware used to install hook in this SSDT in order to
intercept userspace-&gt;kernel calls. In more recent versions of Windows, Microsoft
has implemented <strong>PatchGuard</strong> specifically to prevent these kinds of
hooks. Therefore, its very rare to see these kinds of hooks any more.</p>
<p>The <strong>ssdt</strong> plugin enumerates the the SSDT table and resolves the addresses
back to the names of the functions. Windows has two SSDTs - one for the kernel
and one for the GUI subsystem (win32k driver).</p>
<p>An intalled ssdt hook will appear as a function in a different module (or an
unknown module).</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win7.elf 15:35:25&gt; ssdt
************ Table 0 @ 0xf80002691b00 ************
    Entry          Target     Symbol
-------------- -------------- ------
           0x0 0xf80002aa2190 nt!NtMapUserPhysicalPagesScatter
           0x1 0xf80002988a00 nt!NtWaitForSingleObject
           0x2 0xf80002688dd0 nt!NtCallbackReturn
           0x3 0xf800029abb10 nt!NtReadFile
           0x4 0xf800029a9bb0 nt!NtDeviceIoControlFile
           0x5 0xf800029a4ee0 nt!NtWriteFile
           0x6 0xf8000294adc0 nt!NtRemoveIoCompletion
           0x7 0xf80002947f10 nt!NtReleaseSemaphore
           0x8 0xf8000299fda0 nt!NtReplyWaitReceivePort
           0x9 0xf80002a71e20 nt!NtReplyPort
...
         0x18c 0xf8000297a92c nt!NtWaitForKeyedEvent
         0x18d 0xf800026a1010 nt!NtWaitForWorkViaWorkerFactory
         0x18e 0xf80002ab0b00 nt!NtWaitHighEventPair
         0x18f 0xf80002ab0b90 nt!NtWaitLowEventPair
         0x190 0xf80002678fc4 nt!NtWorkerFactoryWorkerReady
************ Table 1 @ 0xf960001a1c00 ************
    Entry          Target     Symbol
-------------- -------------- ------
           0x0 0xf96000195580 win32k!NtUserGetThreadState
           0x1 0xf96000192630 win32k!NtUserPeekMessage
           0x2 0xf960001a3c6c win32k!NtUserCallOneParam
           0x3 0xf960001b1dd0 win32k!NtUserGetKeyState
           0x4 0xf960001ab1ac win32k!NtUserInvalidateRect
           0x5 0xf960001a3e70 win32k!NtUserCallNoParam
           0x6 0xf9600019b5a0 win32k!NtUserGetMessage
           0x7 0xf9600017fbec win32k!NtUserMessageCall
...
         0x334 0xf96000153b80 win32k!NtUserValidateHandleSecure
         0x335 0xf960001acd9c win32k!NtUserWaitForInputIdle
         0x336 0xf960001a6304 win32k!NtUserWaitForMsgAndEvent
         0x337 0xf960001acef0 win32k!NtUserWindowFromPhysicalPoint
         0x338 0xf960001ae06c win32k!NtUserYieldTask
         0x339 0xf960001a6b84 win32k!NtUserSetClassLongPtr
         0x33a 0xf96000181ca0 win32k!NtUserSetWindowLongPtr
</pre></div>
</div>

<h1 id="svcscan" class="anchor">svcscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.svcscan.SvcScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan for Windows services</h2>
</div>



<p>Windows uses services for long running processes. Serivces are managed by the
&ldquo;services.exe&rdquo; process. The <strong>svcscan</strong> plugin scans the heap memory of the
&ldquo;services.exe&rdquo; process for <strong>_SERVICE_RECORD</strong> records). These records describe
the services which are loaded by the system, and even once the services are
unloaded, we might find <strong>_SERVICE_RECORD</strong> records.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Since loading kernel code is usually done by inserting a kernel driver, and
   kernel drivers are loaded through a service, this plugin will also show
   forensically significant kernel drivers loading.</p>
</li>
<li>
<p>This plugin relies on memory scanning and so it is not all that
   reliable. Often it will not reveal services which we know are
   running. However, it might also reveal services which have been deleted.</p>
</li>
<li>
<p>A better plugin is the <strong>services</strong> plugin which enumerates all services from
   the registry.</p>
</li>
</ol>
<h3>Sample output</h3>
<p>The below example shows a kernel driver being loaded as a service.</p>
<div class="highlight"><pre><span class="n">Offset</span><span class="o">:</span> <span class="mh">0x26f7d6a10</span>
<span class="n">Order</span><span class="o">:</span> <span class="mi">402</span>
<span class="n">Process</span> <span class="n">ID</span><span class="o">:</span> <span class="o">-</span>
<span class="n">Service</span> <span class="n">Name</span><span class="o">:</span> <span class="n">WFPLWFS</span>
<span class="n">Display</span> <span class="n">Name</span><span class="o">:</span> <span class="n">Microsoft</span> <span class="n">Windows</span> <span class="n">Filtering</span> <span class="n">Platform</span>
<span class="n">Service</span> <span class="n">Type</span><span class="o">:</span> <span class="n">SERVICE_KERNEL_DRIVER</span>
<span class="n">Service</span> <span class="n">State</span><span class="o">:</span> <span class="n">SERVICE_RUNNING</span>
<span class="n">Binary</span> <span class="n">Path</span><span class="o">:</span> <span class="o">\</span><span class="n">Driver</span><span class="o">\</span><span class="n">WFPLWFS</span>
</pre></div>
</div>

<h1 id="symlinkscan" class="anchor">symlinkscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.filescan.SymLinkScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan for symbolic link objects</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>A symbolic link is a kernel object which maps a device from one name in the
kernel object tree to another name. Often a driver will set up a symbolic link
to a &ldquo;dos device name&rdquo; to allow access to a kernel device from userspace.</p>
<p>For example, the pmem driver makes a symbolic link from <strong>\GLOBAL??\pmem</strong> to
<strong>\Devices\pmem</strong> so that a user space program can use the <strong>CreateFile</strong> API to
open a handle to <strong>\.\pmem</strong>.</p>
<p>This plugin scans for <strong>_OBJECT_SYMBOLIC_LINK</strong> objects using pool scanning techniques.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_OBJECT_SYMBOLIC_LINK</strong> structures out of
   memory. On the other hand, this plugin may reveal symlinks which have been
   closed or freed.</p>
</li>
<li>
<p>The interesting thing about a symlink is that it contains the timestamp of
   when it was created. This can be significant when determining when the system
   was compromised.</p>
</li>
<li>
<p>Since the <em>symlinkscan</em> plugin carves out <strong>_OBJECT_SYMBOLIC_LINK</strong> objects
   it has no context of where in the object tree the symlink exists. Hence it is
   unable to show parent object directories. A better plugin to use is the
   <a href="ObjectTree.html">object_tree</a> plugin.</p>
</li>
</ol>
<h3>Sample output</h3>
<p>Here we see the <strong>symlinkscan</strong> plugin detecting the pmem link.</p>
<div class="highlight"><pre>    Offset(P)      #Ptr   #Hnd Creation time            From To
- -------------- ------ ------ ------------------------ ---- ------------------------------------------------------------
  0x00000010d470      3      2 2014-01-24 22:07:29+0000 HDAUDIO#FUNC_01&amp;VEN_8384&amp;DEV_7680&amp;SUBSYS_83847680&amp;REV_1034#4&amp;136d1aa0&amp;0&amp;0001#{65e8773e-8f56-11d0-a3b9-00a0c9223196} \Device\0000001e

  0x00000040e940      1      0 2014-01-24 22:07:23+0000 Psched \Device\Psched
  0x0000004e9490      2      1 2014-01-24 22:07:32+0000 DISPLAY#Default_Monitor#4&amp;d9dcf0b&amp;0&amp;UID0#{e6f07b5f-ee97-4a90-b076-33f57bf4eaa7} \Device\00000021
...
  0x00002be706f0      2      1 2014-01-24 22:07:32+0000 AppContainerNamedObjects \Sessions\1\AppContainerNamedObjects
  0x00002bf89f20      2      1 2014-01-24 22:07:32+0000 Global \BaseNamedObjects
  0x00002c0b8270      2      1 2014-01-24 22:07:32+0000 1 \Sessions\1\BaseNamedObjects
  0x00002dbdbe00      1      0 2014-01-24 21:20:05+0000 pmem \Device\pmem
  0x00002f2b7240      1      0 2014-01-24 22:07:26+0000 HCD0 \Device\USBFDO-0
</pre></div>
</div>

<h1 id="thrdscan" class="anchor">thrdscan</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.modscan.ThrdScan-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Scan physical memory for _ETHREAD objects</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>scan_in_kernel</p></td><td><p>Scan in the kernel address space (type: Boolean)</p>
<ul>
<li>Default: False</li>
</ul></td></tr>
</tbody>
</table>
</div>


<p>Pool scanning is a technique for discovering kernel data structures based on
signatures. It is essentially the memory forensic equivalent of carving. The
<strong>thrdscan</strong> plugin carves for <strong>_KTHREAD</strong> structures in memory.</p>
<p>By default the plugin scans in the physical address space. Any hits are resolved
into the virtual address space by following the lists. If <strong>scan_in_kernel</strong> is
specified, the scanning occurs in kernel space.</p>
<h3>Notes</h3>
<ol>
<li>
<p>Like other pool scanning plugins, this plugin may produce false positives
   since it essentially carves <strong>_KTHREAD</strong> structures out of memory. On the
   other hand, this plugin may reveal files which have been closed or freed.</p>
</li>
<li>
<p>The plugin displays the physical address of the <strong>_KTHREAD</strong> found. It may be
   possible to derive their virtual address using the <a href="PtoV.html">ptov</a>
   plugin. Alternatively, specify the <em>scan_in_kernel</em> option, to ensure
   scanning occurs in the kernel address space.</p>
</li>
<li>
<p>This plugin is the pool scanning variant of the <a href="Threads.html">threads</a> plugin.</p>
</li>
</ol>
<h3>Sample output</h3>
<p>The below is an example of running <strong>thrdscan</strong> over a windows system. Note that
we can still see exited threads. Rekall resolves the start address of the thread
(i.e. the function which started running in this thread). This helps to identify
what the thread is supposed to be doing.</p>
<div class="highlight"><pre>win8.1.raw 18:52:26&gt; thrdscan
  Offset(P)       PID    TID Start Address  Create Time              Exit Time                Process          Symbol
-------------- ------ ------ -------------- ------------------------ ------------------------ ---------------- ------
0x0000001ab080   2332   3976 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x000000230880   2392   3212 0x7ff6670fd0bc -                        2014-01-24 21:18:44+0000 VBoxTray.exe     \Windows\System32\VBoxTray.exe!+0xd0bc
0x00000025e080   3644   1068 0x7ff7a4831070 -                        -                        conhost.exe      \Windows\System32\conhost.exe!+0x1070
0x000000261080    880   2440 0x7ff866dbaf44 -                        -                        svchost.exe      \Windows\System32\wuaueng.dll!+0x3af44
0x000000261880    880   3512 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x0000002d6080   3644   3688 0x7ff7a4833060 -                        -                        conhost.exe      \Windows\System32\conhost.exe!+0x3060
0x0000002e1080    976   3932 0x7ff877104924 -                        2014-01-24 21:18:37+0000 svchost.exe      \Windows\System32\sysmain.dll!+0x94924
0x0000002e1880    880   3324 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x00000035d080    880   1752 0x7ff866dbaf44 -                        -                        svchost.exe      \Windows\System32\wuaueng.dll!+0x3af44
0x000000558080    880   3524 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x000000613080    880   3496 0x7ff866dbaf44 -                        -                        svchost.exe      \Windows\System32\wuaueng.dll!+0x3af44
0x000000613880   3400   3648 0x7ff87f35b5c0 -                        -                        MpCmdRun.exe     \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x000000668080    880   3524 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x0000006c0080    880   3692 0x7ff8733911b0 -                        -                        svchost.exe      \Windows\System32\aelupsvc.dll!+0x11b0
0x0000006ce080    880   3180 0x7ff866d81f3c -                        -                        svchost.exe      \Windows\System32\wuaueng.dll!+0x1f3c
0x000002bd2080    880   3736 0x7ff866dbaf44 -                        -                        svchost.exe      \Windows\System32\wuaueng.dll!+0x3af44
0x00000370a080    976   3932 0x7ff877104924 -                        2014-01-24 21:18:37+0000 svchost.exe      \Windows\System32\sysmain.dll!+0x94924
0x00000370a880    880   3324 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x000004eef080    880   3692 0x7ff8733911b0 -                        -                        svchost.exe      \Windows\System32\aelupsvc.dll!+0x11b0
0x0000051a4874 2124654 30318413 0xffe800000000 -                        -                        ----------------
0x000005d8a080    880   3692 0x7ff8733911b0 -                        -                        svchost.exe      \Windows\System32\aelupsvc.dll!+0x11b0
0x000009f5d080   2332   3928 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x00000cbde080   2392   3880 0x7ff6670fd0bc -                        2014-01-24 21:18:24+0000 VBoxTray.exe     \Windows\System32\VBoxTray.exe!+0xd0bc
0x00000dbdb080   2392   4084 0x7ff6670fd0bc -                        2014-01-24 21:19:27+0000 VBoxTray.exe     \Windows\System32\VBoxTray.exe!+0xd0bc
0x00000f345080    880   1532 0x7ff866dbaf44 -                        -                        svchost.exe      \Windows\System32\wuaueng.dll!+0x3af44
0x00000f345880    880   2932 0x7ff87f35b5c0 -                        -                        svchost.exe      \Windows\System32\ntdll.dll!TpPostWork+0x4a0
0x00000f413080      4   3176 0xf802d3613418 -                        -                        System           nt!MiStoreEvictThread
</pre></div>
</div>

<h1 id="threads" class="anchor">threads</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.taskmods.Threads-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate threads.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>The <strong>threads</strong> plugin iterates over all processes and lists all threads in all
processes. This is the list walking version of the <a href="ThrdScan.html">thrdscan</a>
plugin.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>   _ETHREAD       PID    TID Start Address  Process          Symbol
-------------- ------ ------ -------------- ---------------- ------
0xe00000089880      4      8 0xf802d3509ec8 System           nt!Phase1Initialization
0xe0000011f040      4     12 0xf802d3154c04 System           nt!PopIrpWorkerControl
0xe0000011f880      4     16 0xf802d312f868 System           nt!PopIrpWorker
0xe0000011e040      4     20 0xf802d312f868 System           nt!PopIrpWorker
0xe0000011e880      4     24 0xf802d31551c0 System           nt!PopFxEmergencyWorker
0xe0000011d040      4     28 0xf802d3520f14 System           nt!ExpWorkerThreadBalanceManager
0xe0000011d880      4     32 0xf802d30533a8 System           nt!ExpWorkerThread
0xe0000011c880      4     36 0xf802d314cb04 System           nt!ExpWorkerFactoryManagerThread
0xe00000120040      4     40 0xf802d3146fdc System           nt!KiExecuteDpc
0xe00000120880      4     44 0xf802d314f764 System           nt!MiDereferenceSegmentThread
0xe00000124040      4     48 0xf802d3151a8c System           nt!MiModifiedPageWriter
0xe00000124880      4     52 0xf802d314de28 System           nt!KeBalanceSetManager
0xe00000123040      4     56 0xf802d314bc18 System           nt!KeSwapProcessOrStack
0xe00000122040      4     64 0xf802d314cd68 System           nt!CcQueueLazyWriteScanThread
0xe00000122880      4     68 0xf802d3154b9c System           nt!FsRtlWorkerThread
0xe00000121040      4     72 0xf802d3154b9c System           nt!FsRtlWorkerThread
0xe00000133040      4     76 0xf802d3492540 System           nt!EtwpLogger
0xe00000133880      4     80 0xf802d30533a8 System           nt!ExpWorkerThread
<span class="gh">0xe00000137040      4     84 0xf802d314c94c System           nt!MiMappedPageWriter</span>
<span class="gh">....</span>
</pre></div>
</div>

<h1 id="timers" class="anchor">timers</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.malware.timers.Timers-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print kernel timers and associated module DPCs.</h2>
<p>Ref:
http://computer.forensikblog.de/en/2011/10/timers-and-times.html</p>
</div>



<p>The windows kernel has a mechanism for drivers to schedule Deferred Procedure
Calls (DPCs) wither periodically or in a future time. This mechanism is useful
for malware which wants to remain persistant, but not necessarily run at all
times (This reduces the malware&rsquo;s footprint).</p>
<p>The kernel uses <strong>_KTIMER</strong> objects to keep track of these DPCs. Depending on
the exact OS version, the timers are arranged in slightly different data
structures:</p>
<ul>
<li>
<p>On Window XP there is a symbol <strong>KiTimerTableListHead</strong> which enumerates all
  timer hash tables.</p>
</li>
<li>
<p>On windows 7, the timer list is at <strong>_KPCR.PrcbData.TimerTable.TimerEntries</strong>.</p>
</li>
</ul>
<p>Since Windows 7, PatchGuard was introduced. This uses the timer table to
schedule periodic runs. Microsoft felt it was necessary to protect PatchGuard by
obfuscating all DPC pointers in the timer table. This unfortunately also
obfuscates all other timers, including ones possibly used by malware.</p>
<p>Rekall is able to de-obfuscate these DPC address and resolve them back to their
correct module. Rekall will also indicate when the timer is due to go off.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win8.1.raw 22:25:53&gt; timers
Table     Offset     DueTime(H) DueTime              Period(ms)   Signaled    Routine     Module
----- -------------- ---------- -------------------- ---------- ---------- -------------- --------------------
2   0xe00001a58708 0x0000000001f0df8a92 2014-01-24 21:21:14+0000       1000        Yes 0xf80000298480 wdf01000 + 0x8480
8   0xf802d32ecd00 0x0000000001c789ad30 2014-01-24 21:20:05+0000          0          - 0xf802d311b194 nt!CcScanDpc
9   0xf802d32bcce0 0x0000010c0d9d767529 2015-01-01 00:00:00+0000          0          - 0xf802d32467b4 nt!ExpNextYearDpcRoutine
9   0xf802d32ac920 0x0000000001e478b3c5 2014-01-24 21:20:53+0000          0          - 0xf802d3116abc nt!CmpLazyFlushDpcRoutine
13  0xf80002146660 0x0000000001f3302411 2014-01-24 21:21:18+0000      43348        Yes 0xf80002140c44 bowser + 0x3c44
15  0xf8000072e320 0x00000000c877502ee7 2014-01-25 21:02:20+0000          0          - 0xf80000719230 storport + 0x23230
17  0xf800024cbb28 0x0000000001fdfb093c 2014-01-24 21:21:36+0000      28348        Yes 0xf800024af550 tunnel + 0x1550
18  0xe0000127ff40 0x0000000002f06baf46 2014-01-24 21:28:23+0000          0          - 0xf80000b31394 volsnap + 0x2394
21  0xe0000137bb40 0x0000000001f0df8a92 2014-01-24 21:21:14+0000       1000        Yes 0xf8000194a860 usbport + 0x2860
24  0xe00000203b88 0x0000000002534bd8cd 2014-01-24 21:23:59+0000          0          - 0xf80001a930a4 battc + 0x10a4
38  0xe00001493278 0x0000000001f1249ec9 2014-01-24 21:21:14+0000          0          - 0xf80000c2ac30 ndis + 0x4c30
38  0xe00002327228 0x00000000024c651b42 2014-01-24 21:23:47+0000     944848          - 0xf8000249cbb4 mslldp + 0x4bb4
38  0xe000013f7ef8 0x00000000324d602123 2014-01-25 03:07:25+0000   21600000          - 0xf80001491cf0 dxgkrnl + 0x19cf0
38  0xf802d32ea250 0x0000000001d163bc04 2014-01-24 21:20:21+0000      60000        Yes 0xf802d3116bac nt!IopIrpStackProfilerTimer
40  0xf80000e981c0 0x0000000002840a55a8 2014-01-24 21:25:21+0000          0          - 0xf80000e94c9c mup + 0x1c9c
</pre></div>
</div>

<h1 id="tokens" class="anchor">tokens</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.registry.getsids.GetSIDs-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print the SIDs owning each process token.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>


<p>In windows a process runs with a set of <em>Tokens</em>. These tokens are used to
enforce Windows Mandatory ACL system. From a forensic point of view it is
interesting to see what tokens a process is running with.</p>
<p>For non system processes, the process will also possess the token of the user
who started it.</p>
<h3>Sample output</h3>
<p>In the below we can see that this cmd.exe process was started by the user <code>test</code>
with SID <code>S-1-5-21-1077689984-2177008626-1601812314-1001</code>.</p>
<div class="highlight"><pre>win8.1.raw 22:41:01&gt; tokens
-------------------&gt; tokens()
Process          Pid   Sid                                                Comment
---------------- ----- -------------------------------------------------- -------
...
cmd.exe          888   S-1-5-21-1077689984-2177008626-1601812314-1001     User: test
cmd.exe          888   S-1-5-21-1077689984-2177008626-1601812314-513      Domain Users
cmd.exe          888   S-1-1-0                                            Everyone
cmd.exe          888   S-1-5-114
cmd.exe          888   S-1-5-21-1077689984-2177008626-1601812314-1002
cmd.exe          888   S-1-5-32-544                                       Administrators
cmd.exe          888   S-1-5-32-545                                       Users
cmd.exe          888   S-1-5-4                                            Interactive
cmd.exe          888   S-1-2-1                                            Console Logon (Users who are logged onto the physical console)
cmd.exe          888   S-1-5-11                                           Authenticated Users
cmd.exe          888   S-1-5-15                                           This Organization
cmd.exe          888   S-1-5-113
cmd.exe          888   S-1-5-5-0-126935                                   Logon Session
cmd.exe          888   S-1-2-0                                            Local (Users with the ability to log in locally)
cmd.exe          888   S-1-5-64-10                                        NTLM Authentication
cmd.exe          888   S-1-16-12288                                       High Mandatory Level
...
</pre></div>
</div>

<h1 id="unloaded_modules" class="anchor">unloaded_modules</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.modules.UnloadedModules-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Print a list of recently unloaded modules.</h2>
<p>Ref:
http://volatility-labs.blogspot.de/2013/05/movp-ii-22-unloaded-windows-kernel_22.html</p>
</div>



<p>For debugging purposes windows keeps a list of the last few kernel modules to
have been unloaded. Sometimes if malware inserts a kernel component, and then
removes it this will leave traces in this list.</p>
<h3>Sample output</h3>
<p>The below sample shows that <code>win32dd</code> was used to acquire this sample, and that
the Honeynet project&rsquo;s <a href="https://projects.honeynet.org/capture-hpc/browser/capture-hpc/branches/dev/capture-client/KernelDrivers/CaptureKernelDrivers">capture
tools</a>
were used.</p>
<div class="highlight"><pre>130115b.w32 22:53:17&gt; unloaded_modules
INFO:root:Detected kernel base at 0x804D7000-
Name                   Start       End     Time
-------------------- ---------- ---------- ----
Sfloppy.SYS          0xf8383000 0xf8386000 2013-01-15 22:06:06+0000
Cdaudio.SYS          0xf89c2000 0xf89c7000 2013-01-15 22:06:06+0000
processr.sys         0xf88aa000 0xf88b3000 2013-01-15 22:06:06+0000
splitter.sys         0xf8bc6000 0xf8bc8000 2013-01-15 22:06:41+0000
aec.sys              0xb1be6000 0xb1c09000 2013-01-15 22:06:41+0000
swmidi.sys           0xb1d06000 0xb1d14000 2013-01-15 22:06:41+0000
DMusic.sys           0xb1cf6000 0xb1d03000 2013-01-15 22:06:41+0000
drmkaud.sys          0xf8c9f000 0xf8ca0000 2013-01-15 22:06:41+0000
kmixer.sys           0xb1b1b000 0xb1b46000 2013-01-15 22:06:51+0000
kmixer.sys           0xb14df000 0xb150a000 2013-01-15 22:08:04+0000
kmixer.sys           0xb14df000 0xb150a000 2013-01-15 22:09:21+0000
win32dd.sys          0xb160a000 0xb1616000 2013-01-15 22:27:39+0000
fastdumpx86.sys      0xf8942000 0xf8948000 2013-01-15 22:30:55+0000
CaptureFileMonitor.sys 0xb1c3a000 0xb1c3d000 2013-01-15 22:35:48+0000
CaptureRegistryMonitor.sys 0xf8c1e000 0xf8c20000 2013-01-15 22:39:51+0000
CaptureProcessMonitor.sys 0xf8c0e000 0xf8c10000 2013-01-15 22:39:52+0000
CaptureFileMonitor.sys 0xb15ba000 0xb15bd000 2013-01-15 22:39:52+0000
</pre></div>
</div>

<h1 id="vacbs" class="anchor">vacbs</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.cache.EnumerateVacbs-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Enumerate all blocks cached in the cache manager.</h2>
</div>




</div>

<h1 id="vad" class="anchor">vad</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.vadinfo.VAD-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Concise dump of the VAD.</h2>
<p>Similar to windbg&rsquo;s !vad.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>offset</p></td><td><p>Only print the vad corresponding to this offset. (type: IntParser)</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>regex</p></td><td><p>A regular expression to filter VAD filenames.</p></td></tr>
</tbody>
</table>
</div>


<p>The windows kernel manages process memory using the Virtual Address Descriptor
tree. The VAD is a tree of mapped memory regions into the process address
space. The VAD regions are used to manage the process address space (i.e. its
page tables).</p>
<p>The <strong>vad</strong> plugin displays all the vad regions in the process and their
properties.</p>
<h3>Notes</h3>
<ol>
<li>
<p>The <code>start</code> and <code>end</code> columns refer to the page number of the region. To
   convert from an address to page number simply multiply (or divide) by 0x1000.</p>
</li>
<li>
<p>If a memory region is mapped from a file (e.g. via the <strong>mmap</strong> call) the
   filename will be shown.</p>
</li>
<li>
<p>Most executables (e.g. dlls) are mapped with the EXECUTE_WRITECOPY
   permission. This is so that the executable pages are shared between all
   processes. As soon as a process attempts to write to that region the binary
   will be mapped EXECUTE_READWRITE.</p>
</li>
<li>
<p>When a dll is mapped into the vad, the PE header is placed at the vad&rsquo;s start
   address. This means that you can dump the dll by simply passing the vad&rsquo;s
   start address to <a href="PEDump.html">pedump</a> as the image base.</p>
</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win7_trial_64bit.dmp.E01 23:10:34&gt; vad 1232
**************************************************
Pid: 1232 grrservice.exe
     VAD       lev     start           end        com -       -      Protect              Filename
-------------- --- -------------- -------------- ---- ------- ------ -------------------- --------
0xfa80020877a0 1         0x73660        0x736bb    6 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\System32\wow64win.dll
0xfa8002083a50 2           0x400          0x427    8 Mapped  Exe    EXECUTE_WRITECOPY    \Python27\grrservice.exe
0xfa800207fd80 3           0x290          0x293    0 Mapped         READONLY             Pagefile-backed section
0xfa800205a6d0 4            0x50           0x8f    7 Private        READWRITE
0xfa80020848f0 5            0x40           0x40    0 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\System32\apisetschema.dll
0xfa800208b590 6            0x10           0x1f    0 Mapped         READWRITE            Pagefile-backed section
0xfa8002066300 5            0x90          0x28f    3 Private        READWRITE
0xfa800208acd0 4           0x2b0          0x316    0 Mapped         READONLY             \Windows\System32\locale.nls
0xfa8002082470 5           0x2a0          0x2a0    1 Private        READWRITE
0xfa80020aaad0 5           0x360          0x39f    7 Private        READWRITE
0xfa80020a0170 6           0x3a0          0x3df    7 Private        READWRITE
0xfa800207e180 3           0x830          0x92f   28 Private        READWRITE
0xfa800208aa30 4           0x580          0x58f    3 Private        READWRITE
0xfa800209f6d0 5           0x430          0x4af    1 Private        READWRITE
0xfa80020590f0 5           0x5f0          0x66f    6 Private        READWRITE
0xfa8001fea860 4         0x735d0        0x7361a    4 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\apphelp.dll
0xfa80020a01c0 5           0xb30          0xd2f    3 Private        READWRITE
0xfa800209f680 6           0xd30          0xf2f    3 Private        READWRITE
0xfa8002087f00 5         0x73650        0x73657    2 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\System32\wow64cpu.dll
0xfa80020838a0 2         0x7efb0        0x7efd2    0 Mapped         READONLY             Pagefile-backed section
0xfa8002087c00 3         0x760a0        0x7619f    3 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\kernel32.dll
0xfa800208af80 4         0x74b50        0x74b95    3 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\KernelBase.dll
0xfa8002087cb0 5         0x74a70        0x74a7b    2 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\cryptbase.dll
0xfa8002085e30 6         0x736c0        0x736fe    3 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\System32\wow64.dll
0xfa800208a900 6         0x74a80        0x74adf    2 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\sspicli.dll
0xfa800208b900 5         0x76000        0x7609f    5 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\advapi32.dll
0xfa8002086430 4         0x76ce0        0x76dfe    0 Private Exe    EXECUTE_READWRITE
0xfa80020874f0 5         0x767b0        0x7685b    8 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\msvcrt.dll
0xfa800208aaf0 6         0x763b0        0x7649f    2 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\rpcrt4.dll
0xfa800208b1d0 6         0x76860        0x76878    4 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\sechost.dll
0xfa80020839c0 5         0x771b0        0x7735b   12 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\System32\ntdll.dll
0xfa8001d47490 6         0x76f50        0x77049    0 Private Exe    EXECUTE_READWRITE
0xfa8002083930 6         0x77390        0x7750f    9 Mapped  Exe    EXECUTE_WRITECOPY    \Windows\SysWOW64\ntdll.dll
0xfa800209f5e0 7         0x7efad        0x7efaf    3 Private        READWRITE
0xfa800204f6b0 3         0x7f0e0        0x7ffdf    0 Private        READONLY
0xfa8002084980 4         0x7efde        0x7efde    1 Private        READWRITE
0xfa8002084350 5         0x7efdb        0x7efdd    3 Private        READWRITE
0xfa800209f9b0 6         0x7efd5        0x7efd7    3 Private        READWRITE
0xfa8002083800 5         0x7efdf        0x7efdf    1 Private        READWRITE
0xfa800208b260 6         0x7efe0        0x7f0df    0 Mapped         READONLY             Pagefile-backed section
0xfa800207c840 4         0x7ffe0        0x7ffef   -1 Private        READONLY
0xfa80020810b0 5         0x7fff0     0x7fffffef   -1 Private        READONLY
</pre></div>
</div>

<h1 id="vaddump" class="anchor">vaddump</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.vadinfo.VADDump-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dumps out the vad sections to a file</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>dump_dir</p></td><td><p>Path suitable for dumping files. (Default: Use current directory)</p></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>max_size</p></td><td><p>Maximum file size to dump. (type: IntParser)</p>
<ul>
<li>Default: 104857600</li>
</ul></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>offset</p></td><td><p>Only print the vad corresponding to this offset. (type: IntParser)</p></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>regex</p></td><td><p>A regular expression to filter VAD filenames.</p></td></tr>
</tbody>
</table>
</div>


<p>Although you can dump a process executable using the <a href="ProcDump.html">procdump</a>
plugin, this only dumps the main executable. For further analysis of a process
it is useful to dump its entire address space. Since the address space is
discontiguous it is best to dump it out one vad segment at a time.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win7_trial_64bit.dmp.E01 23:45:01&gt; vaddump pid=1232, dump_dir=&quot;/tmp&quot;
************* grrservice.exe (1232) *************
    Start           End           Length     Filename                                                     Comment
-------------- -------------- -------------- ------------------------------------------------------------ -------
0x000073660000 0x0000736bbfff        0x5bfff grrservice.exe.2f684a70.73660000-736bbfff.dmp                \Windows\System32\wow64win.dll
0x000000400000 0x000000427fff        0x27fff grrservice.exe.2f684a70.00400000-00427fff.dmp                \Python27\grrservice.exe
0x000000290000 0x000000293fff         0x3fff grrservice.exe.2f684a70.00290000-00293fff.dmp                Pagefile-backed section
0x000000050000 0x00000008ffff        0x3ffff grrservice.exe.2f684a70.00050000-0008ffff.dmp
0x000000040000 0x000000040fff          0xfff grrservice.exe.2f684a70.00040000-00040fff.dmp                \Windows\System32\apisetschema.dll
0x000000010000 0x00000001ffff         0xffff grrservice.exe.2f684a70.00010000-0001ffff.dmp                Pagefile-backed section
0x000000090000 0x00000028ffff       0x1fffff grrservice.exe.2f684a70.00090000-0028ffff.dmp
0x0000002b0000 0x000000316fff        0x66fff grrservice.exe.2f684a70.002b0000-00316fff.dmp                \Windows\System32\locale.nls
0x0000002a0000 0x0000002a0fff          0xfff grrservice.exe.2f684a70.002a0000-002a0fff.dmp
0x000000360000 0x00000039ffff        0x3ffff grrservice.exe.2f684a70.00360000-0039ffff.dmp
0x0000003a0000 0x0000003dffff        0x3ffff grrservice.exe.2f684a70.003a0000-003dffff.dmp
0x000000830000 0x00000092ffff        0xfffff grrservice.exe.2f684a70.00830000-0092ffff.dmp
0x000000580000 0x00000058ffff         0xffff grrservice.exe.2f684a70.00580000-0058ffff.dmp
0x000000430000 0x0000004affff        0x7ffff grrservice.exe.2f684a70.00430000-004affff.dmp
0x0000005f0000 0x00000066ffff        0x7ffff grrservice.exe.2f684a70.005f0000-0066ffff.dmp
0x0000735d0000 0x00007361afff        0x4afff grrservice.exe.2f684a70.735d0000-7361afff.dmp                \Windows\SysWOW64\apphelp.dll
0x000000b30000 0x000000d2ffff       0x1fffff grrservice.exe.2f684a70.00b30000-00d2ffff.dmp
0x000000d30000 0x000000f2ffff       0x1fffff grrservice.exe.2f684a70.00d30000-00f2ffff.dmp
0x000073650000 0x000073657fff         0x7fff grrservice.exe.2f684a70.73650000-73657fff.dmp                \Windows\System32\wow64cpu.dll
0x00007efb0000 0x00007efd2fff        0x22fff grrservice.exe.2f684a70.7efb0000-7efd2fff.dmp                Pagefile-backed section
0x0000760a0000 0x00007619ffff        0xfffff grrservice.exe.2f684a70.760a0000-7619ffff.dmp                \Windows\SysWOW64\kernel32.dll
0x000074b50000 0x000074b95fff        0x45fff grrservice.exe.2f684a70.74b50000-74b95fff.dmp                \Windows\SysWOW64\KernelBase.dll
0x000074a70000 0x000074a7bfff         0xbfff grrservice.exe.2f684a70.74a70000-74a7bfff.dmp                \Windows\SysWOW64\cryptbase.dll
0x0000736c0000 0x0000736fefff        0x3efff grrservice.exe.2f684a70.736c0000-736fefff.dmp                \Windows\System32\wow64.dll
0x000074a80000 0x000074adffff        0x5ffff grrservice.exe.2f684a70.74a80000-74adffff.dmp                \Windows\SysWOW64\sspicli.dll
0x000076000000 0x00007609ffff        0x9ffff grrservice.exe.2f684a70.76000000-7609ffff.dmp                \Windows\SysWOW64\advapi32.dll
0x000076ce0000 0x000076dfefff       0x11efff grrservice.exe.2f684a70.76ce0000-76dfefff.dmp
0x0000767b0000 0x00007685bfff        0xabfff grrservice.exe.2f684a70.767b0000-7685bfff.dmp                \Windows\SysWOW64\msvcrt.dll
0x0000763b0000 0x00007649ffff        0xeffff grrservice.exe.2f684a70.763b0000-7649ffff.dmp                \Windows\SysWOW64\rpcrt4.dll
0x000076860000 0x000076878fff        0x18fff grrservice.exe.2f684a70.76860000-76878fff.dmp                \Windows\SysWOW64\sechost.dll
0x0000771b0000 0x00007735bfff       0x1abfff grrservice.exe.2f684a70.771b0000-7735bfff.dmp                \Windows\System32\ntdll.dll
0x000076f50000 0x000077049fff        0xf9fff grrservice.exe.2f684a70.76f50000-77049fff.dmp
0x000077390000 0x00007750ffff       0x17ffff grrservice.exe.2f684a70.77390000-7750ffff.dmp                \Windows\SysWOW64\ntdll.dll
0x00007efad000 0x00007efaffff         0x2fff grrservice.exe.2f684a70.7efad000-7efaffff.dmp
0x00007f0e0000 0x00007ffdffff       0xefffff grrservice.exe.2f684a70.7f0e0000-7ffdffff.dmp
0x00007efde000 0x00007efdefff          0xfff grrservice.exe.2f684a70.7efde000-7efdefff.dmp
0x00007efdb000 0x00007efddfff         0x2fff grrservice.exe.2f684a70.7efdb000-7efddfff.dmp
0x00007efd5000 0x00007efd7fff         0x2fff grrservice.exe.2f684a70.7efd5000-7efd7fff.dmp
0x00007efdf000 0x00007efdffff          0xfff grrservice.exe.2f684a70.7efdf000-7efdffff.dmp
0x00007efe0000 0x00007f0dffff        0xfffff grrservice.exe.2f684a70.7efe0000-7f0dffff.dmp                Pagefile-backed section
0x00007ffe0000 0x00007ffeffff         0xffff grrservice.exe.2f684a70.7ffe0000-7ffeffff.dmp
0x00007fff0000 0x07fffffeffff  0x7ff7fffffff grrservice.exe.2f684a70.7fff0000-7fffffeffff.dmp
...
win7_trial_64bit.dmp.E01 23:45:13&gt; peinfo executable=&quot;/tmp/grrservice.exe.2f684a70.760a0000-7619ffff.dmp&quot;
Attribute            Value
-------------------- -----
Machine              IMAGE_FILE_MACHINE_I386
TimeDateStamp        2011-07-16 04:33:08+0000
Characteristics      IMAGE_FILE_32BIT_MACHINE, IMAGE_FILE_DLL,
                     IMAGE_FILE_EXECUTABLE_IMAGE
GUID/Age             0EB73428EC4E430FB8EDD94C5946855B2
PDB                  wkernel32.pdb
MajorOperatingSystemVersion 6
MinorOperatingSystemVersion 1
MajorImageVersion    6
MinorImageVersion    1
MajorSubsystemVersion 6
MinorSubsystemVersion 1

Sections (Relative to 0x760A0000):
Perm Name          VMA            Size
---- -------- -------------- --------------
xr-  .text    0x000000010000 0x0000000c0000
-rw  .data    0x0000000d0000 0x000000010000
-r-  .rsrc    0x0000000e0000 0x000000010000
-r-  .reloc   0x0000000f0000 0x000000010000

Data Directories:
-                                             VMA            Size
---------------------------------------- -------------- --------------
IMAGE_DIRECTORY_ENTRY_EXPORT             0x00007615f728 0x00000000aa1a
IMAGE_DIRECTORY_ENTRY_IMPORT             0x00007616a144 0x0000000001f4
IMAGE_DIRECTORY_ENTRY_RESOURCE           0x000076180000 0x000000000520
IMAGE_DIRECTORY_ENTRY_EXCEPTION          0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_SECURITY           0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_BASERELOC          0x000076190000 0x00000000ad3c
IMAGE_DIRECTORY_ENTRY_DEBUG              0x00007616feb8 0x000000000038
IMAGE_DIRECTORY_ENTRY_COPYRIGHT          0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_GLOBALPTR          0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_TLS                0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG        0x000076123330 0x000000000040
IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT       0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_IAT                0x0000760b0000 0x000000000ddc
IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT       0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR     0x000000000000 0x000000000000
IMAGE_DIRECTORY_ENTRY_RESERVED           0x000000000000 0x000000000000

Import Directory (Original):
Name                                               Ord
-------------------------------------------------- -----
API-MS-Win-Core-RtlSupport-L1-1-0.dll!RtlUnwind    3
API-MS-Win-Core-RtlSupport-L1-1-0.dll!RtlCaptureContext 0
API-MS-Win-Core-RtlSupport-L1-1-0.dll!RtlCaptureStackBackTrace 1
ntdll.dll!NtCreateEvent                            227
ntdll.dll!NtDuplicateObject                        275
ntdll.dll!RtlConvertSidToUnicodeString             686
ntdll.dll!NtNotifyChangeKey                        337
ntdll.dll!RtlRunOnceInitialize                     1151
</pre></div>
</div>

<h1 id="vadinfo" class="anchor">vadinfo</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.vadinfo.VADInfo-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Dump the VAD info</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="vadmap" class="anchor">vadmap</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.vadinfo.VADMap-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Inspect each page in the VAD and report its status.</h2>
<p>This allows us to see the address translation status of each page in the
VAD.</p>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>end</p></td><td><p>Stop reading at this offset. (type: IntParser)</p>
<ul>
<li>Default: 9223372036854775808</li>
</ul></td></tr><tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>start</p></td><td><p>Start reading from this page. (type: IntParser)</p>
<ul>
<li>Default: 0</li>
</ul></td></tr><tr><td><p>verbosity</p></td><td><p>An integer reflecting the amount of desired output: 0 = quiet, 10 = noisy. (type: IntParser)</p>
<ul>
<li>Default: 1</li>
</ul></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="vadtree" class="anchor">vadtree</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.vadinfo.VADTree-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Walk the VAD tree and display in tree format</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="vadwalk" class="anchor">vadwalk</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.vadinfo.VADWalk-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Walk the VAD tree</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr>
</tbody>
</table>
</div>



</div>

<h1 id="version_modules" class="anchor">version_modules</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.modules.ModVersions-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Try to determine the versions for all kernel drivers.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>name_regex</p></td><td><p>Filter module names by this regex.</p></td></tr>
</tbody>
</table>
</div>


<p>Each time a windows binary is built using the Microsoft Visual Studio compiler
suite a new unique GUID is generated for this file. The GUID is used to link the
executable and the pdb file (which contains debugging symbols).</p>
<p>The GUID is embedded in the executable in an <code>RSDS</code> record (i.e. the record has
a signature starting with the letters <code>RSDS</code>). Rekall can scan for this
signature in order to identify the executable version.</p>
<p>This plugin scans for the version string for each loaded kernel module. Use the
<a href="VersionScan.html">version_scan</a> module to search for RSDS signatures in
physical memory.</p>
<h3>Sample output</h3>
<div class="highlight"><pre>win7_trial_64bit.dmp.E01 23:48:26&gt; version_modules
  Offset (V)   Name                 GUID/Version                     PDB
-------------- -------------------- -------------------------------- ------------------------------
0xf800027f4b0c ntoskrnl.exe         C07170995AA8441B952E3B9AE3F3754B2 ntkrnlmp.pdb
0xf8000262deb4 hal.dll              0C72B43B8AC64E22AB88B564E69330372 hal.pdb
0xf88002d34af4 wanarp.sys           7BA2309F029F4DE7878AED80636C2D132 wanarp.pdb
0xf8800183eed4 TDI.SYS              C519554437F04B63BC39FF4E69578DC42 tdi.pdb
0xf88000d95b24 volmgrx.sys          C047BA32ABCB4A948CBB8930F352B1032 volmgrx.pdb
0xf88003de7c60 dump_dumpfve.sys     A2CC4DFB86424750871BCB8E1E841E3C1 dumpfve.pdb
0xf880019d4e00 watchdog.sys         79ACBD31D1BD428A8311AD9D5DCDEAA61 watchdog.pdb
0xf8800111004c cng.sys              F0AA00E320D4468A9D3F7078E2AE2BF52 cng.pdb
0xf88002c2e648 csc.sys              56B7C3B9040B47D9821E6A57E6A5AE4A1 csc.pdb
0xf88000c02f48 CI.dll               5F1BDC2205AC402CB0F09FC7CF17A3701 ci.pdb
0xf88003c3f2dc USBD.SYS             BE6200B21204452DADDF85CED51A5BDE1 usbd.pdb
0xf88002d0a1fc netbios.sys          084EB51DBDE844CF9EAD3B5FDFABDC721 netbios.pdb
0xf88000cc80a0 mcupdate.dll         8C7A27566CD54FB9A00AF26B5BF941651 mcupdate_GenuineIntel.pdb
0xf8800145c920 ndis.sys             40D6C85AC9F74887A652601839A1F56D2 ndis.pdb
0xf880019eb04c rdpencdd.sys         C299649119AC4CC888F37C32A216781A1 RDPENCDD.pdb
0xf88003814d08 srv.sys              20C4A475BE954C10997EAD2C623E40C32 srv.pdb
0xf88003a52c10 raspptp.sys          C9106AFB80474EFCAF9384DA26CC35622 raspptp.pdb
0xf880019b42ec VIDEOPRT.SYS         1B0FC2CC31FE41CEBEAC4ABB7375EA481 videoprt.pdb
0xf88000fda340 PCIIDEX.SYS          2C4F146DA2774ACEA1D5499284DDDB271 pciidex.pdb
0xf88003c2962c HIDCLASS.SYS         1815DD7E268B4BB9BCD5226204CFEC9C1 hidclass.pdb
0xf88000fd105c intelide.sys         B72598DF61A84806B7AC593BA128300C1 intelide.pdb
0xf88003a37320 raspppoe.sys         39B224364B9042649CA0CDB8270762931 raspppoe.pdb
0xf88000e040ec atapi.sys            4E82D8C0AB5A41799B979539D280167D1 atapi.pdb
0xf88002cba464 netbt.sys            840D3E3C828C4D60A905DC82D8CBF8FA2 netbt.pdb
0xf880011f647c kbdclass.sys         D5F7E088FAF44B60A3774197A9ADEEC01 kbdclass.pdb
0xf88000e361f0 amdxata.sys          8D1A5FFBAEEA4D388F8B7B3B9378C3671 amdxata.pdb
0xf880031abb04 srvnet.sys           608D364BC5524794BD70C89773BD51EF2 srvnet.pdb
0xf880028fa614 bowser.sys           26FAC99A52F8439E9A5B8B4B37F90D5B1 bowser.pdb
0xf88002ddb6f4 dfsc.sys             827F5D478C94478299C7FEC7FEE4DAFA1 dfsc.pdb
0xf880011bf9dc fvevol.sys           2FBEA7856251499B87C65A29FC51E6191 fvevol.pdb
0xf80000bc13b0 kdcom.dll            ACC6A823A2844D22B68CD5D48D42381F2 kdcom.pdb
0xf88000fbe5a4 volmgr.sys           39E92F60716140C38C723CDF21B956CD2 volmgr.pdb
0xf88000f5c108 msisadrv.sys         09A612E6691847ED98E4F36F3CC9EE641 msisadrv.pdb
0xf8800183127c tdx.sys              FB912A34EB1A44EC9F65E250879944B52 tdx.pdb
0xf8800119f10c rdyboost.sys         20E6E50C6F9B42589E18D96AD84608DB1 rdyboost.pdb
</pre></div>
</div>

<h1 id="virt_map" class="anchor">virt_map</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.misc.WinVirtualMap-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Prints the Windows Kernel Virtual Address Map.</h2>
<p>On 32 bit windows, the kernel virtual address space can be managed
dynamically. This plugin shows each region and what it is used for.</p>
<p>Note that on 64 bit windows the address space is large enough to not worry
about it. In that case, the offsets and regions are hard coded.</p>
<p>http://www.woodmann.com/forum/entry.php?219-Using-nt!_MiSystemVaType-to-navigate-dynamic-kernel-address-space-in-Windows7</p>
</div>




</div>

<h1 id="vtop" class="anchor">vtop</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.pfn.VtoP-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Prints information about the virtual to physical translation.</h2>
</div>


<h3>Plugin Arguments</h3>
<div class="plugins_args">
<table class='table table-condensed'>
<tbody>
<tr><td><p>eprocess</p></td><td><p>Kernel addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>method</p></td><td><p>Method to list processes. (type: ChoiceArray)</p>
<ul>
<li>
<p>Valid Choices:</p>
<ul>
<li>PsActiveProcessHead</li>
<li>CSRSS</li>
<li>PspCidTable</li>
<li>Sessions</li>
<li>Handles</li>
</ul>
</li>
<li>
<p>Default: PsActiveProcessHead, CSRSS, PspCidTable, Sessions, Handles</p>
</li>
</ul></td></tr><tr><td><p>phys_eprocess</p></td><td><p>Physical addresses of eprocess structs. (type: ArrayIntParser)</p></td></tr><tr><td><p>pid</p></td><td><p>One or more pids of processes to select. (type: ArrayIntParser)</p></td></tr><tr><td><p>proc_regex</p></td><td><p>A regex to select a process by name. (type: RegEx)</p></td></tr><tr><td><p>virtual_address</p></td><td><p>The Virtual Address to examine. (type: SymbolAddress)</p></td></tr>
</tbody>
</table>
</div>


<p>This plugin displays all the page translation steps needed to resolve a virtual
address to a physical address.</p>
<h3>Notes</h3>
<ol>
<li>The plugin uses the current default address space to calculate the
   mapping. If you want to resolve the virtual address in a process space you
   will need to switch the process context first (i.e. use the
   <a href="SetProcessContext.html">cc</a> plugin.</li>
</ol>
<h3>Sample output</h3>
<div class="highlight"><pre>win7_trial_64bit.dmp.E01 23:52:53&gt; vtop 0xfa8000a2d060
Virtual 0xfa8000a2d060 Page Directory 0x00187000
pml4e@ 0x187fa8 = 0x3c00863
pdpte@ 0x3c00000 = 0x3c01863
pde@ 0x3c01028 = 0x30c009e3
Large page mapped 0x30e2d060
Physical Address 0x30c2d060
</pre></div>
</div>

<h1 id="win32k_autodetect" class="anchor">win32k_autodetect</h1>

<a class="btn btn-default epydoc_link"
   href="/epydocs/rekall.plugins.windows.gui.autodetect.Win32kAutodetect-class.html">View Source</a>


<div class="plugin_description">
<div class="abstract">
<h2>Automatically detect win32k struct layout.</h2>
</div>




</div>

  </div>
</div>
</div>
  <div class="footer">
    <div class="container">
      <p class="text-muted">
        &copy; 2015 Google Inc.
        Rekall is licensed under the The GPL License.
        Pmem is licensed under the Apache license.
        <a href="#" class="pull-right text-muted">Back to top</a>
      </p>
    </div>
  </div>

  <script>
   $(".activate_tooltip").tooltip();
   $("body").scrollspy({
     target: ".bs-docs-sidebar",
     offset: 40
   });
  </script>
  </div>
 </body>
</html>

